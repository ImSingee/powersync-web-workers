var kh=Object.create;var os=Object.defineProperty;var Ph=Object.getOwnPropertyDescriptor;var Mh=Object.getOwnPropertyNames;var Qh=Object.getPrototypeOf,$h=Object.prototype.hasOwnProperty;var ar=(r,e)=>()=>(r&&(e=r(r=0)),e);var ne=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),as=(r,e)=>{for(var t in e)os(r,t,{get:e[t],enumerable:!0})},zh=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Mh(e))!$h.call(r,s)&&s!==t&&os(r,s,{get:()=>e[s],enumerable:!(n=Ph(e,s))||n.enumerable});return r};var Ie=(r,e,t)=>(t=r!=null?kh(Qh(r)):{},zh(e||!r||!r.__esModule?os(t,"default",{value:r,enumerable:!0}):t,r));var at=ne((bl,Yn)=>{(function(r){"use strict";var e={};e.VERSION="1.6.1";var t,n={},s=function(u,p){return function(){return p.apply(u,arguments)}},o=function(){var u=arguments,p=u[0],_,I;for(I=1;I<u.length;I++)for(_ in u[I])!(_ in p)&&u[I].hasOwnProperty(_)&&(p[_]=u[I][_]);return p},l=function(u,p){return{value:u,name:p}};e.TRACE=l(1,"TRACE"),e.DEBUG=l(2,"DEBUG"),e.INFO=l(3,"INFO"),e.TIME=l(4,"TIME"),e.WARN=l(5,"WARN"),e.ERROR=l(8,"ERROR"),e.OFF=l(99,"OFF");var d=function(u){this.context=u,this.setLevel(u.filterLevel),this.log=this.info};d.prototype={setLevel:function(u){u&&"value"in u&&(this.context.filterLevel=u)},getLevel:function(){return this.context.filterLevel},enabledFor:function(u){var p=this.context.filterLevel;return u.value>=p.value},trace:function(){this.invoke(e.TRACE,arguments)},debug:function(){this.invoke(e.DEBUG,arguments)},info:function(){this.invoke(e.INFO,arguments)},warn:function(){this.invoke(e.WARN,arguments)},error:function(){this.invoke(e.ERROR,arguments)},time:function(u){typeof u=="string"&&u.length>0&&this.invoke(e.TIME,[u,"start"])},timeEnd:function(u){typeof u=="string"&&u.length>0&&this.invoke(e.TIME,[u,"end"])},invoke:function(u,p){t&&this.enabledFor(u)&&t(p,o({level:u},this.context))}};var f=new d({filterLevel:e.OFF});(function(){var u=e;u.enabledFor=s(f,f.enabledFor),u.trace=s(f,f.trace),u.debug=s(f,f.debug),u.time=s(f,f.time),u.timeEnd=s(f,f.timeEnd),u.info=s(f,f.info),u.warn=s(f,f.warn),u.error=s(f,f.error),u.log=u.info})(),e.setHandler=function(u){t=u},e.setLevel=function(u){f.setLevel(u);for(var p in n)n.hasOwnProperty(p)&&n[p].setLevel(u)},e.getLevel=function(){return f.getLevel()},e.get=function(u){return n[u]||(n[u]=new d(o({name:u},f.context)))},e.createDefaultHandler=function(u){u=u||{},u.formatter=u.formatter||function(R,L){L.name&&R.unshift("["+L.name+"]")};var p={},_=function(I,R){Function.prototype.apply.call(I,console,R)};return typeof console>"u"?function(){}:function(I,R){I=Array.prototype.slice.call(I);var L=console.log,g;R.level===e.TIME?(g=(R.name?"["+R.name+"] ":"")+I[0],I[1]==="start"?console.time?console.time(g):p[g]=new Date().getTime():console.timeEnd?console.timeEnd(g):_(L,[g+": "+(new Date().getTime()-p[g])+"ms"])):(R.level===e.WARN&&console.warn?L=console.warn:R.level===e.ERROR&&console.error?L=console.error:R.level===e.INFO&&console.info?L=console.info:R.level===e.DEBUG&&console.debug?L=console.debug:R.level===e.TRACE&&console.trace&&(L=console.trace),u.formatter(I,R),_(L,I))}},e.useDefaults=function(u){e.setLevel(u&&u.defaultLevel||e.DEBUG),e.setHandler(e.createDefaultHandler(u))},e.setDefaults=e.useDefaults,typeof define=="function"&&define.amd?define(e):typeof Yn<"u"&&Yn.exports?Yn.exports=e:(e._prevLogger=r.Logger,e.noConflict=function(){return r.Logger=e._prevLogger,e},r.Logger=e)})(bl)});var Il=ne(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});var hs=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(let e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,s)=>{this.pullQueue.push({resolve:n,reject:s})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},Zn=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let s=new hs;s.highWaterMark=t,s.lowWaterMark=n,s.removeCallback=e({push:o=>s.push(o),stop:()=>s.stop(),fail:o=>s.fail(o),on:(o,l)=>{s.eventHandlers[o]=l}})||(()=>{}),this[Symbol.asyncIterator]=()=>s[Symbol.asyncIterator](),Object.freeze(this)}};ei.EventIterator=Zn;ei.default=Zn});var Rl=ne(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});var ds=Il();fn.EventIterator=ds.EventIterator;function nd(r,e,t){return new ds.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}fn.subscribe=nd;fn.default=ds.EventIterator});var ti=ne((oy,vl)=>{function id(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}vl.exports=id});var Ol=ne((ay,Ll)=>{var sd=typeof global=="object"&&global&&global.Object===Object&&global;Ll.exports=sd});var ps=ne((ly,xl)=>{var od=Ol(),ad=typeof self=="object"&&self&&self.Object===Object&&self,ld=od||ad||Function("return this")();xl.exports=ld});var Nl=ne((cy,Al)=>{var cd=ps(),ud=function(){return cd.Date.now()};Al.exports=ud});var Cl=ne((uy,Fl)=>{var fd=/\s/;function hd(r){for(var e=r.length;e--&&fd.test(r.charAt(e)););return e}Fl.exports=hd});var ql=ne((fy,Bl)=>{var dd=Cl(),pd=/^\s+/;function _d(r){return r&&r.slice(0,dd(r)+1).replace(pd,"")}Bl.exports=_d});var _s=ne((hy,Dl)=>{var md=ps(),gd=md.Symbol;Dl.exports=gd});var Ml=ne((dy,Pl)=>{var Ul=_s(),kl=Object.prototype,yd=kl.hasOwnProperty,Ed=kl.toString,hn=Ul?Ul.toStringTag:void 0;function wd(r){var e=yd.call(r,hn),t=r[hn];try{r[hn]=void 0;var n=!0}catch{}var s=Ed.call(r);return n&&(e?r[hn]=t:delete r[hn]),s}Pl.exports=wd});var $l=ne((py,Ql)=>{var Sd=Object.prototype,Td=Sd.toString;function bd(r){return Td.call(r)}Ql.exports=bd});var Hl=ne((_y,Vl)=>{var zl=_s(),Id=Ml(),Rd=$l(),vd="[object Null]",Ld="[object Undefined]",jl=zl?zl.toStringTag:void 0;function Od(r){return r==null?r===void 0?Ld:vd:jl&&jl in Object(r)?Id(r):Rd(r)}Vl.exports=Od});var Kl=ne((my,Wl)=>{function xd(r){return r!=null&&typeof r=="object"}Wl.exports=xd});var Xl=ne((gy,Gl)=>{var Ad=Hl(),Nd=Kl(),Fd="[object Symbol]";function Cd(r){return typeof r=="symbol"||Nd(r)&&Ad(r)==Fd}Gl.exports=Cd});var ec=ne((yy,Zl)=>{var Bd=ql(),Jl=ti(),qd=Xl(),Yl=NaN,Dd=/^[-+]0x[0-9a-f]+$/i,Ud=/^0b[01]+$/i,kd=/^0o[0-7]+$/i,Pd=parseInt;function Md(r){if(typeof r=="number")return r;if(qd(r))return Yl;if(Jl(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=Jl(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=Bd(r);var t=Ud.test(r);return t||kd.test(r)?Pd(r.slice(2),t?2:8):Dd.test(r)?Yl:+r}Zl.exports=Md});var nc=ne((Ey,rc)=>{var Qd=ti(),ms=Nl(),tc=ec(),$d="Expected a function",zd=Math.max,jd=Math.min;function Vd(r,e,t){var n,s,o,l,d,f,u=0,p=!1,_=!1,I=!0;if(typeof r!="function")throw new TypeError($d);e=tc(e)||0,Qd(t)&&(p=!!t.leading,_="maxWait"in t,o=_?zd(tc(t.maxWait)||0,e):o,I="trailing"in t?!!t.trailing:I);function R(Q){var N=n,K=s;return n=s=void 0,u=Q,l=r.apply(K,N),l}function L(Q){return u=Q,d=setTimeout(y,e),p?R(Q):l}function g(Q){var N=Q-f,K=Q-u,G=e-N;return _?jd(G,o-K):G}function w(Q){var N=Q-f,K=Q-u;return f===void 0||N>=e||N<0||_&&K>=o}function y(){var Q=ms();if(w(Q))return b(Q);d=setTimeout(y,g(Q))}function b(Q){return d=void 0,I&&n?R(Q):(n=s=void 0,l)}function A(){d!==void 0&&clearTimeout(d),u=0,n=f=s=d=void 0}function v(){return d===void 0?l:b(ms())}function k(){var Q=ms(),N=w(Q);if(n=arguments,s=this,f=Q,N){if(d===void 0)return L(f);if(_)return clearTimeout(d),d=setTimeout(y,e),R(f)}return d===void 0&&(d=setTimeout(y,e)),l}return k.cancel=A,k.flush=v,k}rc.exports=Vd});var gs=ne((wy,ic)=>{var Hd=nc(),Wd=ti(),Kd="Expected a function";function Gd(r,e,t){var n=!0,s=!0;if(typeof r!="function")throw new TypeError(Kd);return Wd(t)&&(n="leading"in t?!!t.leading:n,s="trailing"in t?!!t.trailing:s),Hd(r,e,{leading:n,maxWait:e,trailing:s})}ic.exports=Gd});var Tc=ne(($t,Sc)=>{var ci=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global,ui=function(){function r(){this.fetch=!1,this.DOMException=ci.DOMException}return r.prototype=ci,new r}();(function(r){var e=function(t){var n=typeof r<"u"&&r||typeof self<"u"&&self||typeof n<"u"&&n,s={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};function o(S){return S&&DataView.prototype.isPrototypeOf(S)}if(s.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(S){return S&&l.indexOf(Object.prototype.toString.call(S))>-1};function f(S){if(typeof S!="string"&&(S=String(S)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(S)||S==="")throw new TypeError('Invalid character in header field name: "'+S+'"');return S.toLowerCase()}function u(S){return typeof S!="string"&&(S=String(S)),S}function p(S){var O={next:function(){var $=S.shift();return{done:$===void 0,value:$}}};return s.iterable&&(O[Symbol.iterator]=function(){return O}),O}function _(S){this.map={},S instanceof _?S.forEach(function(O,$){this.append($,O)},this):Array.isArray(S)?S.forEach(function(O){this.append(O[0],O[1])},this):S&&Object.getOwnPropertyNames(S).forEach(function(O){this.append(O,S[O])},this)}_.prototype.append=function(S,O){S=f(S),O=u(O);var $=this.map[S];this.map[S]=$?$+", "+O:O},_.prototype.delete=function(S){delete this.map[f(S)]},_.prototype.get=function(S){return S=f(S),this.has(S)?this.map[S]:null},_.prototype.has=function(S){return this.map.hasOwnProperty(f(S))},_.prototype.set=function(S,O){this.map[f(S)]=u(O)},_.prototype.forEach=function(S,O){for(var $ in this.map)this.map.hasOwnProperty($)&&S.call(O,this.map[$],$,this)},_.prototype.keys=function(){var S=[];return this.forEach(function(O,$){S.push($)}),p(S)},_.prototype.values=function(){var S=[];return this.forEach(function(O){S.push(O)}),p(S)},_.prototype.entries=function(){var S=[];return this.forEach(function(O,$){S.push([$,O])}),p(S)},s.iterable&&(_.prototype[Symbol.iterator]=_.prototype.entries);function I(S){if(S.bodyUsed)return Promise.reject(new TypeError("Already read"));S.bodyUsed=!0}function R(S){return new Promise(function(O,$){S.onload=function(){O(S.result)},S.onerror=function(){$(S.error)}})}function L(S){var O=new FileReader,$=R(O);return O.readAsArrayBuffer(S),$}function g(S){var O=new FileReader,$=R(O);return O.readAsText(S),$}function w(S){for(var O=new Uint8Array(S),$=new Array(O.length),Y=0;Y<O.length;Y++)$[Y]=String.fromCharCode(O[Y]);return $.join("")}function y(S){if(S.slice)return S.slice(0);var O=new Uint8Array(S.byteLength);return O.set(new Uint8Array(S)),O.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(S){this.bodyUsed=this.bodyUsed,this._bodyInit=S,S?typeof S=="string"?this._bodyText=S:s.blob&&Blob.prototype.isPrototypeOf(S)?this._bodyBlob=S:s.formData&&FormData.prototype.isPrototypeOf(S)?this._bodyFormData=S:s.searchParams&&URLSearchParams.prototype.isPrototypeOf(S)?this._bodyText=S.toString():s.arrayBuffer&&s.blob&&o(S)?(this._bodyArrayBuffer=y(S.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(S)||d(S))?this._bodyArrayBuffer=y(S):this._bodyText=S=Object.prototype.toString.call(S):this._bodyText="",this.headers.get("content-type")||(typeof S=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s.searchParams&&URLSearchParams.prototype.isPrototypeOf(S)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s.blob&&(this.blob=function(){var S=I(this);if(S)return S;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var S=I(this);return S||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(L)}),this.text=function(){var S=I(this);if(S)return S;if(this._bodyBlob)return g(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(w(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(Q)}),this.json=function(){return this.text().then(JSON.parse)},this}var A=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(S){var O=S.toUpperCase();return A.indexOf(O)>-1?O:S}function k(S,O){if(!(this instanceof k))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');O=O||{};var $=O.body;if(S instanceof k){if(S.bodyUsed)throw new TypeError("Already read");this.url=S.url,this.credentials=S.credentials,O.headers||(this.headers=new _(S.headers)),this.method=S.method,this.mode=S.mode,this.signal=S.signal,!$&&S._bodyInit!=null&&($=S._bodyInit,S.bodyUsed=!0)}else this.url=String(S);if(this.credentials=O.credentials||this.credentials||"same-origin",(O.headers||!this.headers)&&(this.headers=new _(O.headers)),this.method=v(O.method||this.method||"GET"),this.mode=O.mode||this.mode||null,this.signal=O.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&$)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody($),(this.method==="GET"||this.method==="HEAD")&&(O.cache==="no-store"||O.cache==="no-cache")){var Y=/([?&])_=[^&]*/;if(Y.test(this.url))this.url=this.url.replace(Y,"$1_="+new Date().getTime());else{var ae=/\?/;this.url+=(ae.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})};function Q(S){var O=new FormData;return S.trim().split("&").forEach(function($){if($){var Y=$.split("="),ae=Y.shift().replace(/\+/g," "),ie=Y.join("=").replace(/\+/g," ");O.append(decodeURIComponent(ae),decodeURIComponent(ie))}}),O}function N(S){var O=new _,$=S.replace(/\r?\n[\t ]+/g," ");return $.split("\r").map(function(Y){return Y.indexOf(`
`)===0?Y.substr(1,Y.length):Y}).forEach(function(Y){var ae=Y.split(":"),ie=ae.shift().trim();if(ie){var Ce=ae.join(":").trim();O.append(ie,Ce)}}),O}b.call(k.prototype);function K(S,O){if(!(this instanceof K))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');O||(O={}),this.type="default",this.status=O.status===void 0?200:O.status,this.ok=this.status>=200&&this.status<300,this.statusText=O.statusText===void 0?"":""+O.statusText,this.headers=new _(O.headers),this.url=O.url||"",this._initBody(S)}b.call(K.prototype),K.prototype.clone=function(){return new K(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _(this.headers),url:this.url})},K.error=function(){var S=new K(null,{status:0,statusText:""});return S.type="error",S};var G=[301,302,303,307,308];K.redirect=function(S,O){if(G.indexOf(O)===-1)throw new RangeError("Invalid status code");return new K(null,{status:O,headers:{location:S}})},t.DOMException=n.DOMException;try{new t.DOMException}catch{t.DOMException=function(O,$){this.message=O,this.name=$;var Y=Error(O);this.stack=Y.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function W(S,O){return new Promise(function($,Y){var ae=new k(S,O);if(ae.signal&&ae.signal.aborted)return Y(new t.DOMException("Aborted","AbortError"));var ie=new XMLHttpRequest;function Ce(){ie.abort()}ie.onload=function(){var Se={status:ie.status,statusText:ie.statusText,headers:N(ie.getAllResponseHeaders()||"")};Se.url="responseURL"in ie?ie.responseURL:Se.headers.get("X-Request-URL");var Te="response"in ie?ie.response:ie.responseText;setTimeout(function(){$(new K(Te,Se))},0)},ie.onerror=function(){setTimeout(function(){Y(new TypeError("Network request failed"))},0)},ie.ontimeout=function(){setTimeout(function(){Y(new TypeError("Network request failed"))},0)},ie.onabort=function(){setTimeout(function(){Y(new t.DOMException("Aborted","AbortError"))},0)};function ft(Se){try{return Se===""&&n.location.href?n.location.href:Se}catch{return Se}}ie.open(ae.method,ft(ae.url),!0),ae.credentials==="include"?ie.withCredentials=!0:ae.credentials==="omit"&&(ie.withCredentials=!1),"responseType"in ie&&(s.blob?ie.responseType="blob":s.arrayBuffer&&ae.headers.get("Content-Type")&&ae.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(ie.responseType="arraybuffer")),O&&typeof O.headers=="object"&&!(O.headers instanceof _)?Object.getOwnPropertyNames(O.headers).forEach(function(Se){ie.setRequestHeader(Se,u(O.headers[Se]))}):ae.headers.forEach(function(Se,Te){ie.setRequestHeader(Te,Se)}),ae.signal&&(ae.signal.addEventListener("abort",Ce),ie.onreadystatechange=function(){ie.readyState===4&&ae.signal.removeEventListener("abort",Ce)}),ie.send(typeof ae._bodyInit>"u"?null:ae._bodyInit)})}return W.polyfill=!0,n.fetch||(n.fetch=W,n.Headers=_,n.Request=k,n.Response=K),t.Headers=_,t.Request=k,t.Response=K,t.fetch=W,t}({})})(ui);ui.fetch.ponyfill=!0;delete ui.fetch.polyfill;var Br=ci.fetch?ci:ui;$t=Br.fetch;$t.default=Br.fetch;$t.fetch=Br.fetch;$t.Headers=Br.Headers;$t.Request=Br.Request;$t.Response=Br.Response;Sc.exports=$t});var vc=ne((g0,Rc)=>{Rc.exports={}});var Oc=ne((y0,Lc)=>{"use strict";var np=vc(),ip=function(r){var e,t=!1;return new ReadableStream({start:function(n){var s=r.getReader();e=s;var o=new TextDecoder,l="";s.read().then(function d(f){if(f.done){if(t)return;if(l=l.trim(),l.length!==0)try{var u=JSON.parse(l);n.enqueue(u)}catch(g){n.error(g);return}n.close();return}var p=o.decode(f.value,{stream:!0});l+=p;for(var _=l.split(`
`),I=0;I<_.length-1;++I){var R=_[I].trim();if(R.length>0)try{var L=JSON.parse(R);n.enqueue(L)}catch(g){n.error(g),t=!0,s.cancel();return}}return l=_[_.length-1],s.read().then(d)})},cancel:function(n){console.log("Cancel registered due to ",n),t=!0,e.cancel()}})};Lc.exports=np.ndjsonStream=ip});var rt=ne(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.Frame=Be.Lengths=Be.Flags=Be.FrameTypes=void 0;var Is;(function(r){r[r.RESERVED=0]="RESERVED",r[r.SETUP=1]="SETUP",r[r.LEASE=2]="LEASE",r[r.KEEPALIVE=3]="KEEPALIVE",r[r.REQUEST_RESPONSE=4]="REQUEST_RESPONSE",r[r.REQUEST_FNF=5]="REQUEST_FNF",r[r.REQUEST_STREAM=6]="REQUEST_STREAM",r[r.REQUEST_CHANNEL=7]="REQUEST_CHANNEL",r[r.REQUEST_N=8]="REQUEST_N",r[r.CANCEL=9]="CANCEL",r[r.PAYLOAD=10]="PAYLOAD",r[r.ERROR=11]="ERROR",r[r.METADATA_PUSH=12]="METADATA_PUSH",r[r.RESUME=13]="RESUME",r[r.RESUME_OK=14]="RESUME_OK",r[r.EXT=63]="EXT"})(Is=Be.FrameTypes||(Be.FrameTypes={}));var xc;(function(r){r[r.NONE=0]="NONE",r[r.COMPLETE=64]="COMPLETE",r[r.FOLLOWS=128]="FOLLOWS",r[r.IGNORE=512]="IGNORE",r[r.LEASE=64]="LEASE",r[r.METADATA=256]="METADATA",r[r.NEXT=32]="NEXT",r[r.RESPOND=128]="RESPOND",r[r.RESUME_ENABLE=128]="RESUME_ENABLE"})(xc=Be.Flags||(Be.Flags={}));(function(r){function e(u){return(u&r.METADATA)===r.METADATA}r.hasMetadata=e;function t(u){return(u&r.COMPLETE)===r.COMPLETE}r.hasComplete=t;function n(u){return(u&r.NEXT)===r.NEXT}r.hasNext=n;function s(u){return(u&r.FOLLOWS)===r.FOLLOWS}r.hasFollows=s;function o(u){return(u&r.IGNORE)===r.IGNORE}r.hasIgnore=o;function l(u){return(u&r.RESPOND)===r.RESPOND}r.hasRespond=l;function d(u){return(u&r.LEASE)===r.LEASE}r.hasLease=d;function f(u){return(u&r.RESUME_ENABLE)===r.RESUME_ENABLE}r.hasResume=f})(xc=Be.Flags||(Be.Flags={}));var sp;(function(r){r[r.FRAME=3]="FRAME",r[r.HEADER=6]="HEADER",r[r.METADATA=3]="METADATA",r[r.REQUEST=3]="REQUEST"})(sp=Be.Lengths||(Be.Lengths={}));var op;(function(r){function e(n){return n.streamId===0}r.isConnection=e;function t(n){return Is.REQUEST_RESPONSE<=n.type&&n.type<=Is.REQUEST_CHANNEL}r.isRequest=t})(op=Be.Frame||(Be.Frame={}))});var vs=ne(J=>{"use strict";var ap=J&&J.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(u){return function(p){return f([u,p])}}function f(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(o=u[0]&2?s.return:u[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,u[1])).done)return o;switch(s=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],s=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(J,"__esModule",{value:!0});J.Deserializer=J.sizeOfFrame=J.serializeFrame=J.deserializeFrame=J.serializeFrameWithLength=J.deserializeFrames=J.deserializeFrameWithLength=J.writeUInt64BE=J.readUInt64BE=J.writeUInt24BE=J.readUInt24BE=J.MAX_VERSION=J.MAX_TTL=J.MAX_STREAM_ID=J.MAX_RESUME_LENGTH=J.MAX_REQUEST_N=J.MAX_REQUEST_COUNT=J.MAX_MIME_LENGTH=J.MAX_METADATA_LENGTH=J.MAX_LIFETIME=J.MAX_KEEPALIVE=J.MAX_CODE=J.FRAME_TYPE_OFFFSET=J.FLAGS_MASK=void 0;var X=rt();J.FLAGS_MASK=1023;J.FRAME_TYPE_OFFFSET=10;J.MAX_CODE=2147483647;J.MAX_KEEPALIVE=2147483647;J.MAX_LIFETIME=2147483647;J.MAX_METADATA_LENGTH=16777215;J.MAX_MIME_LENGTH=255;J.MAX_REQUEST_COUNT=2147483647;J.MAX_REQUEST_N=2147483647;J.MAX_RESUME_LENGTH=65535;J.MAX_STREAM_ID=2147483647;J.MAX_TTL=2147483647;J.MAX_VERSION=65535;var Rs=4294967296;function hi(r,e){var t=r.readUInt8(e)<<16,n=r.readUInt8(e+1)<<8,s=r.readUInt8(e+2);return t|n|s}J.readUInt24BE=hi;function fi(r,e,t){return t=r.writeUInt8(e>>>16,t),t=r.writeUInt8(e>>>8&255,t),r.writeUInt8(e&255,t)}J.writeUInt24BE=fi;function mn(r,e){var t=r.readUInt32BE(e),n=r.readUInt32BE(e+4);return t*Rs+n}J.readUInt64BE=mn;function gn(r,e,t){var n=e/Rs|0,s=e%Rs;return t=r.writeUInt32BE(n,t),r.writeUInt32BE(s,t)}J.writeUInt64BE=gn;var le=6,zt=3;function Ac(r){var e=hi(r,0);return di(r.slice(zt,zt+e))}J.deserializeFrameWithLength=Ac;function Nc(r){var e,t,n,s,o,l;return ap(this,function(d){switch(d.label){case 0:e=0,d.label=1;case 1:return e+zt<r.length?(t=hi(r,e),n=e+zt,s=n+t,s>r.length?[3,3]:(o=r.slice(n,s),l=di(o),e=s,[4,[l,e]])):[3,3];case 2:return d.sent(),[3,1];case 3:return[2]}})}J.deserializeFrames=Nc;function lp(r){var e=Fc(r),t=Buffer.allocUnsafe(e.length+zt);return fi(t,e.length,0),e.copy(t,zt),t}J.serializeFrameWithLength=lp;function di(r){var e=0,t=r.readInt32BE(e);e+=4;var n=r.readUInt16BE(e);e+=2;var s=n>>>J.FRAME_TYPE_OFFFSET,o=n&J.FLAGS_MASK;switch(s){case X.FrameTypes.SETUP:return hp(r,t,o);case X.FrameTypes.PAYLOAD:return Qp(r,t,o);case X.FrameTypes.ERROR:return _p(r,t,o);case X.FrameTypes.KEEPALIVE:return yp(r,t,o);case X.FrameTypes.REQUEST_FNF:return vp(r,t,o);case X.FrameTypes.REQUEST_RESPONSE:return Lp(r,t,o);case X.FrameTypes.REQUEST_STREAM:return Np(r,t,o);case X.FrameTypes.REQUEST_CHANNEL:return Fp(r,t,o);case X.FrameTypes.METADATA_PUSH:return Op(r,t,o);case X.FrameTypes.REQUEST_N:return qp(r,t,o);case X.FrameTypes.RESUME:return jp(r,t,o);case X.FrameTypes.RESUME_OK:return Wp(r,t,o);case X.FrameTypes.CANCEL:return kp(r,t,o);case X.FrameTypes.LEASE:return Sp(r,t,o);default:}}J.deserializeFrame=di;function Fc(r){switch(r.type){case X.FrameTypes.SETUP:return up(r);case X.FrameTypes.PAYLOAD:return Pp(r);case X.FrameTypes.ERROR:return dp(r);case X.FrameTypes.KEEPALIVE:return mp(r);case X.FrameTypes.REQUEST_FNF:case X.FrameTypes.REQUEST_RESPONSE:return Tp(r);case X.FrameTypes.REQUEST_STREAM:case X.FrameTypes.REQUEST_CHANNEL:return xp(r);case X.FrameTypes.METADATA_PUSH:return Ip(r);case X.FrameTypes.REQUEST_N:return Cp(r);case X.FrameTypes.RESUME:return $p(r);case X.FrameTypes.RESUME_OK:return Vp(r);case X.FrameTypes.CANCEL:return Dp(r);case X.FrameTypes.LEASE:return Ep(r);default:}}J.serializeFrame=Fc;function cp(r){switch(r.type){case X.FrameTypes.SETUP:return fp(r);case X.FrameTypes.PAYLOAD:return Mp(r);case X.FrameTypes.ERROR:return pp(r);case X.FrameTypes.KEEPALIVE:return gp(r);case X.FrameTypes.REQUEST_FNF:case X.FrameTypes.REQUEST_RESPONSE:return bp(r);case X.FrameTypes.REQUEST_STREAM:case X.FrameTypes.REQUEST_CHANNEL:return Ap(r);case X.FrameTypes.METADATA_PUSH:return Rp(r);case X.FrameTypes.REQUEST_N:return Bp(r);case X.FrameTypes.RESUME:return zp(r);case X.FrameTypes.RESUME_OK:return Hp(r);case X.FrameTypes.CANCEL:return Up(r);case X.FrameTypes.LEASE:return wp(r);default:}}J.sizeOfFrame=cp;var Cc=14,Bc=2;function up(r){var e=r.resumeToken!=null?r.resumeToken.byteLength:0,t=r.metadataMimeType!=null?Buffer.byteLength(r.metadataMimeType,"ascii"):0,n=r.dataMimeType!=null?Buffer.byteLength(r.dataMimeType,"ascii"):0,s=jt(r),o=Buffer.allocUnsafe(le+Cc+(e?Bc+e:0)+t+n+s),l=Ye(r,o);return l=o.writeUInt16BE(r.majorVersion,l),l=o.writeUInt16BE(r.minorVersion,l),l=o.writeUInt32BE(r.keepAlive,l),l=o.writeUInt32BE(r.lifetime,l),r.flags&X.Flags.RESUME_ENABLE&&(l=o.writeUInt16BE(e,l),r.resumeToken!=null&&(l+=r.resumeToken.copy(o,l))),l=o.writeUInt8(t,l),r.metadataMimeType!=null&&(l+=o.write(r.metadataMimeType,l,l+t,"ascii")),l=o.writeUInt8(n,l),r.dataMimeType!=null&&(l+=o.write(r.dataMimeType,l,l+n,"ascii")),pi(r,o,l),o}function fp(r){var e=r.resumeToken!=null?r.resumeToken.byteLength:0,t=r.metadataMimeType!=null?Buffer.byteLength(r.metadataMimeType,"ascii"):0,n=r.dataMimeType!=null?Buffer.byteLength(r.dataMimeType,"ascii"):0,s=jt(r);return le+Cc+(e?Bc+e:0)+t+n+s}function hp(r,e,t){var n=r.length,s=le,o=r.readUInt16BE(s);s+=2;var l=r.readUInt16BE(s);s+=2;var d=r.readInt32BE(s);s+=4;var f=r.readInt32BE(s);s+=4;var u=null;if(t&X.Flags.RESUME_ENABLE){var p=r.readInt16BE(s);s+=2,u=r.slice(s,s+p),s+=p}var _=r.readUInt8(s);s+=1;var I=r.toString("ascii",s,s+_);s+=_;var R=r.readUInt8(s);s+=1;var L=r.toString("ascii",s,s+R);s+=R;var g={data:null,dataMimeType:L,flags:t,keepAlive:d,lifetime:f,majorVersion:o,metadata:null,metadataMimeType:I,minorVersion:l,resumeToken:u,streamId:0,type:X.FrameTypes.SETUP};return qr(r,g,s),g}var qc=4;function dp(r){var e=r.message!=null?Buffer.byteLength(r.message,"utf8"):0,t=Buffer.allocUnsafe(le+qc+e),n=Ye(r,t);return n=t.writeUInt32BE(r.code,n),r.message!=null&&t.write(r.message,n,n+e,"utf8"),t}function pp(r){var e=r.message!=null?Buffer.byteLength(r.message,"utf8"):0;return le+qc+e}function _p(r,e,t){var n=r.length,s=le,o=r.readInt32BE(s);s+=4;var l=r.length-s,d="";return l>0&&(d=r.toString("utf8",s,s+l),s+=l),{code:o,flags:t,message:d,streamId:e,type:X.FrameTypes.ERROR}}var Dc=8;function mp(r){var e=r.data!=null?r.data.byteLength:0,t=Buffer.allocUnsafe(le+Dc+e),n=Ye(r,t);return n=gn(t,r.lastReceivedPosition,n),r.data!=null&&r.data.copy(t,n),t}function gp(r){var e=r.data!=null?r.data.byteLength:0;return le+Dc+e}function yp(r,e,t){var n=r.length,s=le,o=mn(r,s);s+=8;var l=null;return s<r.length&&(l=r.slice(s,r.length)),{data:l,flags:t,lastReceivedPosition:o,streamId:0,type:X.FrameTypes.KEEPALIVE}}var Uc=8;function Ep(r){var e=r.metadata!=null?r.metadata.byteLength:0,t=Buffer.allocUnsafe(le+Uc+e),n=Ye(r,t);return n=t.writeUInt32BE(r.ttl,n),n=t.writeUInt32BE(r.requestCount,n),r.metadata!=null&&r.metadata.copy(t,n),t}function wp(r){var e=r.metadata!=null?r.metadata.byteLength:0;return le+Uc+e}function Sp(r,e,t){var n=le,s=r.readUInt32BE(n);n+=4;var o=r.readUInt32BE(n);n+=4;var l=null;return n<r.length&&(l=r.slice(n,r.length)),{flags:t,metadata:l,requestCount:o,streamId:0,ttl:s,type:X.FrameTypes.LEASE}}function Tp(r){var e=jt(r),t=Buffer.allocUnsafe(le+e),n=Ye(r,t);return pi(r,t,n),t}function bp(r){var e=jt(r);return le+e}function Ip(r){var e=r.metadata;if(e!=null){var t=Buffer.allocUnsafe(le+e.byteLength),n=Ye(r,t);return e.copy(t,n),t}else{var t=Buffer.allocUnsafe(le);return Ye(r,t),t}}function Rp(r){return le+(r.metadata!=null?r.metadata.byteLength:0)}function vp(r,e,t){var n=r.length,s={data:null,flags:t,metadata:null,streamId:e,type:X.FrameTypes.REQUEST_FNF};return qr(r,s,le),s}function Lp(r,e,t){var n={data:null,flags:t,metadata:null,streamId:e,type:X.FrameTypes.REQUEST_RESPONSE};return qr(r,n,le),n}function Op(r,e,t){return{flags:t,metadata:length===le?null:r.slice(le,length),streamId:0,type:X.FrameTypes.METADATA_PUSH}}var kc=4;function xp(r){var e=jt(r),t=Buffer.allocUnsafe(le+kc+e),n=Ye(r,t);return n=t.writeUInt32BE(r.requestN,n),pi(r,t,n),t}function Ap(r){var e=jt(r);return le+kc+e}function Np(r,e,t){var n=r.length,s=le,o=r.readInt32BE(s);s+=4;var l={data:null,flags:t,metadata:null,requestN:o,streamId:e,type:X.FrameTypes.REQUEST_STREAM};return qr(r,l,s),l}function Fp(r,e,t){var n=r.length,s=le,o=r.readInt32BE(s);s+=4;var l={data:null,flags:t,metadata:null,requestN:o,streamId:e,type:X.FrameTypes.REQUEST_CHANNEL};return qr(r,l,s),l}var Pc=4;function Cp(r){var e=Buffer.allocUnsafe(le+Pc),t=Ye(r,e);return e.writeUInt32BE(r.requestN,t),e}function Bp(r){return le+Pc}function qp(r,e,t){var n=r.length,s=r.readInt32BE(le);return{flags:t,requestN:s,streamId:e,type:X.FrameTypes.REQUEST_N}}function Dp(r){var e=Buffer.allocUnsafe(le);return Ye(r,e),e}function Up(r){return le}function kp(r,e,t){var n=r.length;return{flags:t,streamId:e,type:X.FrameTypes.CANCEL}}function Pp(r){var e=jt(r),t=Buffer.allocUnsafe(le+e),n=Ye(r,t);return pi(r,t,n),t}function Mp(r){var e=jt(r);return le+e}function Qp(r,e,t){var n=r.length,s={data:null,flags:t,metadata:null,streamId:e,type:X.FrameTypes.PAYLOAD};return qr(r,s,le),s}var Mc=22;function $p(r){var e=r.resumeToken.byteLength,t=Buffer.allocUnsafe(le+Mc+e),n=Ye(r,t);return n=t.writeUInt16BE(r.majorVersion,n),n=t.writeUInt16BE(r.minorVersion,n),n=t.writeUInt16BE(e,n),n+=r.resumeToken.copy(t,n),n=gn(t,r.serverPosition,n),gn(t,r.clientPosition,n),t}function zp(r){var e=r.resumeToken.byteLength;return le+Mc+e}function jp(r,e,t){var n=r.length,s=le,o=r.readUInt16BE(s);s+=2;var l=r.readUInt16BE(s);s+=2;var d=r.readInt16BE(s);s+=2;var f=r.slice(s,s+d);s+=d;var u=mn(r,s);s+=8;var p=mn(r,s);return s+=8,{clientPosition:p,flags:t,majorVersion:o,minorVersion:l,resumeToken:f,serverPosition:u,streamId:0,type:X.FrameTypes.RESUME}}var Qc=8;function Vp(r){var e=Buffer.allocUnsafe(le+Qc),t=Ye(r,e);return gn(e,r.clientPosition,t),e}function Hp(r){return le+Qc}function Wp(r,e,t){var n=r.length,s=mn(r,le);return{clientPosition:s,flags:t,streamId:0,type:X.FrameTypes.RESUME_OK}}function Ye(r,e){var t=e.writeInt32BE(r.streamId,0);return e.writeUInt16BE(r.type<<J.FRAME_TYPE_OFFFSET|r.flags&J.FLAGS_MASK,t)}function jt(r){var e=0;return r.data!=null&&(e+=r.data.byteLength),X.Flags.hasMetadata(r.flags)&&(e+=zt,r.metadata!=null&&(e+=r.metadata.byteLength)),e}function pi(r,e,t){if(X.Flags.hasMetadata(r.flags))if(r.metadata!=null){var n=r.metadata.byteLength;t=fi(e,n,t),t+=r.metadata.copy(e,t)}else t=fi(e,0,t);r.data!=null&&r.data.copy(e,t)}function qr(r,e,t){if(X.Flags.hasMetadata(e.flags)){var n=hi(r,t);t+=zt,n>0&&(e.metadata=r.slice(t,t+n),t+=n)}t<r.length&&(e.data=r.slice(t,r.length))}var Kp=function(){function r(){}return r.prototype.deserializeFrame=function(e){return di(e)},r.prototype.deserializeFrameWithLength=function(e){return Ac(e)},r.prototype.deserializeFrames=function(e){return Nc(e)},r}();J.Deserializer=Kp});var zc=ne($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0})});var Ls=ne(Dr=>{"use strict";var jc=Dr&&Dr.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Dr,"__esModule",{value:!0});Dr.Deferred=void 0;var Gp=function(){function r(){this._done=!1,this.onCloseCallbacks=[]}return Object.defineProperty(r.prototype,"done",{get:function(){return this._done},enumerable:!1,configurable:!0}),r.prototype.close=function(e){var t,n,s,o;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}if(this._done=!0,this._error=e,e){try{for(var l=jc(this.onCloseCallbacks),d=l.next();!d.done;d=l.next()){var f=d.value;f(e)}}catch(_){t={error:_}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return}try{for(var u=jc(this.onCloseCallbacks),p=u.next();!p.done;p=u.next()){var f=p.value;f()}}catch(_){s={error:_}}finally{try{p&&!p.done&&(o=u.return)&&o.call(u)}finally{if(s)throw s.error}}},r.prototype.onClose=function(e){if(this._done){e(this._error);return}this.onCloseCallbacks.push(e)},r}();Dr.Deferred=Gp});var Lt=ne(vt=>{"use strict";var Xp=vt&&vt.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(vt,"__esModule",{value:!0});vt.ErrorCodes=vt.RSocketError=void 0;var Jp=function(r){Xp(e,r);function e(t,n){var s=r.call(this,n)||this;return s.code=t,s}return e}(Error);vt.RSocketError=Jp;var Yp;(function(r){r[r.RESERVED=0]="RESERVED",r[r.INVALID_SETUP=1]="INVALID_SETUP",r[r.UNSUPPORTED_SETUP=2]="UNSUPPORTED_SETUP",r[r.REJECTED_SETUP=3]="REJECTED_SETUP",r[r.REJECTED_RESUME=4]="REJECTED_RESUME",r[r.CONNECTION_CLOSE=258]="CONNECTION_CLOSE",r[r.CONNECTION_ERROR=257]="CONNECTION_ERROR",r[r.APPLICATION_ERROR=513]="APPLICATION_ERROR",r[r.REJECTED=514]="REJECTED",r[r.CANCELED=515]="CANCELED",r[r.INVALID=516]="INVALID",r[r.RESERVED_EXTENSION=4294967295]="RESERVED_EXTENSION"})(Yp=vt.ErrorCodes||(vt.ErrorCodes={}))});var Hc=ne(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0})});var Os=ne(Ae=>{"use strict";var Wc=Ae&&Ae.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Zp=Ae&&Ae.__awaiter||function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},e_=Ae&&Ae.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(u){return function(p){return f([u,p])}}function f(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(o=u[0]&2?s.return:u[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,u[1])).done)return o;switch(s=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],s=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer=Ae.ResumableClientServerInputMultiplexerDemultiplexer=Ae.ClientServerInputMultiplexerDemultiplexer=Ae.StreamIdGenerator=void 0;var ye=Ur(),Kc=Ls(),_i=Lt(),mi=rt(),t_;(function(r){function e(n){return new t(n)}r.create=e;var t=function(){function n(s){this.currentId=s}return n.prototype.next=function(s){var o=this.currentId+2;s(o)&&(this.currentId=o)},n}()})(t_=Ae.StreamIdGenerator||(Ae.StreamIdGenerator={}));var Gc=function(r){Wc(e,r);function e(t,n,s){var o=r.call(this)||this;return o.streamIdSupplier=t,o.outbound=n,o.closeable=s,o.registry={},s.onClose(o.close.bind(o)),o}return e.prototype.handle=function(t){if(mi.Frame.isConnection(t)){if(t.type===ye.FrameTypes.RESERVED)return;this.connectionFramesHandler.handle(t)}else if(mi.Frame.isRequest(t)){if(this.registry[t.streamId])return;this.requestFramesHandler.handle(t,this)}else{var n=this.registry[t.streamId];if(!n)return;n.handle(t)}},e.prototype.connectionInbound=function(t){if(this.connectionFramesHandler)throw new Error("Connection frame handler has already been installed");this.connectionFramesHandler=t},e.prototype.handleRequestStream=function(t){if(this.requestFramesHandler)throw new Error("Stream handler has already been installed");this.requestFramesHandler=t},e.prototype.send=function(t){this.outbound.send(t)},Object.defineProperty(e.prototype,"connectionOutbound",{get:function(){return this},enumerable:!1,configurable:!0}),e.prototype.createRequestStream=function(t){var n=this;if(this.done){t.handleReject(new Error("Already closed"));return}var s=this.registry;this.streamIdSupplier.next(function(o){return t.handleReady(o,n)},Object.keys(s))},e.prototype.connect=function(t){this.registry[t.streamId]=t},e.prototype.disconnect=function(t){delete this.registry[t.streamId]},e.prototype.close=function(t){if(this.done){r.prototype.close.call(this,t);return}for(var n in this.registry){var s=this.registry[n];s.close(new Error("Closed. ".concat(t?"Original cause [".concat(t,"]."):"")))}r.prototype.close.call(this,t)},e}(Kc.Deferred);Ae.ClientServerInputMultiplexerDemultiplexer=Gc;var r_=function(r){Wc(e,r);function e(t,n,s,o,l,d,f){var u=r.call(this,t,n,new Kc.Deferred)||this;return u.frameStore=o,u.token=l,u.sessionTimeout=f,d instanceof Function?u.reconnector=d:u.sessionStore=d,s.onClose(u.handleConnectionClose.bind(u)),u}return e.prototype.send=function(t){if(mi.Frame.isConnection(t)){if(t.type===ye.FrameTypes.KEEPALIVE)t.lastReceivedPosition=this.frameStore.lastReceivedFramePosition;else if(t.type===ye.FrameTypes.ERROR){this.outbound.send(t),this.sessionStore&&delete this.sessionStore[this.token],r.prototype.close.call(this,new _i.RSocketError(t.code,t.message));return}}else this.frameStore.store(t);this.outbound.send(t)},e.prototype.handle=function(t){if(mi.Frame.isConnection(t)){if(t.type===ye.FrameTypes.KEEPALIVE)try{this.frameStore.dropTo(t.lastReceivedPosition)}catch(n){this.outbound.send({type:ye.FrameTypes.ERROR,streamId:0,flags:ye.Flags.NONE,code:n.code,message:n.message}),this.close(n)}else if(t.type===ye.FrameTypes.ERROR){r.prototype.handle.call(this,t),this.sessionStore&&delete this.sessionStore[this.token],r.prototype.close.call(this,new _i.RSocketError(t.code,t.message));return}}else this.frameStore.record(t);r.prototype.handle.call(this,t)},e.prototype.resume=function(t,n,s){switch(this.outbound=n,t.type){case ye.FrameTypes.RESUME:{if(clearTimeout(this.timeoutId),this.frameStore.lastReceivedFramePosition<t.clientPosition){var o=new _i.RSocketError(ye.ErrorCodes.REJECTED_RESUME,"Impossible to resume since first available client frame position is greater than last received server frame position");this.outbound.send({type:ye.FrameTypes.ERROR,streamId:0,flags:ye.Flags.NONE,code:o.code,message:o.message}),this.close(o);return}try{this.frameStore.dropTo(t.serverPosition)}catch(l){this.outbound.send({type:ye.FrameTypes.ERROR,streamId:0,flags:ye.Flags.NONE,code:l.code,message:l.message}),this.close(l);return}this.outbound.send({type:ye.FrameTypes.RESUME_OK,streamId:0,flags:ye.Flags.NONE,clientPosition:this.frameStore.lastReceivedFramePosition});break}case ye.FrameTypes.RESUME_OK:{try{this.frameStore.dropTo(t.clientPosition)}catch(l){this.outbound.send({type:ye.FrameTypes.ERROR,streamId:0,flags:ye.Flags.NONE,code:l.code,message:l.message}),this.close(l)}break}}this.frameStore.drain(this.outbound.send.bind(this.outbound)),s.onClose(this.handleConnectionClose.bind(this)),this.connectionFramesHandler.resume()},e.prototype.handleConnectionClose=function(t){return Zp(this,void 0,void 0,function(){var n;return e_(this,function(s){switch(s.label){case 0:if(this.connectionFramesHandler.pause(),!this.reconnector)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.reconnector(this,this.frameStore)];case 2:return s.sent(),[3,4];case 3:return n=s.sent(),this.close(n),[3,4];case 4:return[3,6];case 5:this.timeoutId=setTimeout(this.close.bind(this),this.sessionTimeout),s.label=6;case 6:return[2]}})})},e}(Gc);Ae.ResumableClientServerInputMultiplexerDemultiplexer=r_;var n_=function(){function r(e,t,n){this.outbound=e,this.closeable=t,this.delegate=n,this.resumed=!1}return r.prototype.close=function(){this.delegate.close()},r.prototype.onClose=function(e){this.delegate.onClose(e)},Object.defineProperty(r.prototype,"connectionOutbound",{get:function(){return this.delegate.connectionOutbound},enumerable:!1,configurable:!0}),r.prototype.createRequestStream=function(e){this.delegate.createRequestStream(e)},r.prototype.connectionInbound=function(e){this.delegate.connectionInbound(e)},r.prototype.handleRequestStream=function(e){this.delegate.handleRequestStream(e)},r.prototype.handle=function(e){var t=this;if(!this.resumed){if(e.type===ye.FrameTypes.RESUME_OK){this.resumed=!0,this.delegate.resume(e,this.outbound,this.closeable);return}else this.outbound.send({type:ye.FrameTypes.ERROR,streamId:0,code:ye.ErrorCodes.CONNECTION_ERROR,message:"Incomplete RESUME handshake. Unexpected frame ".concat(e.type," received"),flags:ye.Flags.NONE}),this.closeable.close(),this.closeable.onClose(function(){return t.delegate.close(new _i.RSocketError(ye.ErrorCodes.CONNECTION_ERROR,"Incomplete RESUME handshake. Unexpected frame ".concat(e.type," received")))});return}this.delegate.handle(e)},r}();Ae.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer=n_});var yn=ne(yt=>{"use strict";var Xc=yt&&yt.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(u){return function(p){return f([u,p])}}function f(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(o=u[0]&2?s.return:u[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,u[1])).done)return o;switch(s=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],s=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(yt,"__esModule",{value:!0});yt.fragmentWithRequestN=yt.fragment=yt.isFragmentable=void 0;var te=rt();function i_(r,e,t){return e===0?!1:r.data.byteLength+(r.metadata?r.metadata.byteLength+te.Lengths.METADATA:0)+(t==te.FrameTypes.REQUEST_STREAM||t==te.FrameTypes.REQUEST_CHANNEL?te.Lengths.REQUEST:0)>e}yt.isFragmentable=i_;function s_(r,e,t,n,s){var o,l,d,f,u,p,_,_,I,R,L,L,g,w;return s===void 0&&(s=!1),Xc(this,function(y){switch(y.label){case 0:return o=(w=(g=e.data)===null||g===void 0?void 0:g.byteLength)!==null&&w!==void 0?w:0,l=n!==te.FrameTypes.PAYLOAD,d=t,e.metadata?(u=e.metadata.byteLength,u!==0?[3,1]:(d-=te.Lengths.METADATA,f=Buffer.allocUnsafe(0),[3,6])):[3,6];case 1:return p=0,l?(d-=te.Lengths.METADATA,_=Math.min(u,p+d),f=e.metadata.slice(p,_),d-=f.byteLength,p=_,d!==0?[3,3]:(l=!1,[4,{type:n,flags:te.Flags.FOLLOWS|te.Flags.METADATA,data:void 0,metadata:f,streamId:r}])):[3,3];case 2:y.sent(),f=void 0,d=t,y.label=3;case 3:return p<u?(d-=te.Lengths.METADATA,_=Math.min(u,p+d),f=e.metadata.slice(p,_),d-=f.byteLength,p=_,d===0||o===0?[4,{type:te.FrameTypes.PAYLOAD,flags:te.Flags.NEXT|te.Flags.METADATA|(p===u&&s&&o===0?te.Flags.COMPLETE:te.Flags.FOLLOWS),data:void 0,metadata:f,streamId:r}]:[3,5]):[3,6];case 4:y.sent(),f=void 0,d=t,y.label=5;case 5:return[3,3];case 6:return I=0,l?(L=Math.min(o,I+d),R=e.data.slice(I,L),d-=R.byteLength,I=L,[4,{type:n,flags:te.Flags.FOLLOWS|(f?te.Flags.METADATA:te.Flags.NONE),data:R,metadata:f,streamId:r}]):[3,8];case 7:y.sent(),f=void 0,R=void 0,d=t,y.label=8;case 8:return I<o?(L=Math.min(o,I+d),R=e.data.slice(I,L),d-=R.byteLength,I=L,[4,{type:te.FrameTypes.PAYLOAD,flags:I===o?(s?te.Flags.COMPLETE:te.Flags.NONE)|te.Flags.NEXT|(f?te.Flags.METADATA:0):te.Flags.FOLLOWS|te.Flags.NEXT|(f?te.Flags.METADATA:0),data:R,metadata:f,streamId:r}]):[3,10];case 9:return y.sent(),f=void 0,R=void 0,d=t,[3,8];case 10:return[2]}})}yt.fragment=s_;function o_(r,e,t,n,s,o){var l,d,f,u,p,_,I,I,R,L,g,g,w,y;return o===void 0&&(o=!1),Xc(this,function(b){switch(b.label){case 0:return l=(y=(w=e.data)===null||w===void 0?void 0:w.byteLength)!==null&&y!==void 0?y:0,d=!0,f=t,e.metadata?(p=e.metadata.byteLength,p!==0?[3,1]:(f-=te.Lengths.METADATA,u=Buffer.allocUnsafe(0),[3,6])):[3,6];case 1:return _=0,d?(f-=te.Lengths.METADATA+te.Lengths.REQUEST,I=Math.min(p,_+f),u=e.metadata.slice(_,I),f-=u.byteLength,_=I,f!==0?[3,3]:(d=!1,[4,{type:n,flags:te.Flags.FOLLOWS|te.Flags.METADATA,data:void 0,requestN:s,metadata:u,streamId:r}])):[3,3];case 2:b.sent(),u=void 0,f=t,b.label=3;case 3:return _<p?(f-=te.Lengths.METADATA,I=Math.min(p,_+f),u=e.metadata.slice(_,I),f-=u.byteLength,_=I,f===0||l===0?[4,{type:te.FrameTypes.PAYLOAD,flags:te.Flags.NEXT|te.Flags.METADATA|(_===p&&o&&l===0?te.Flags.COMPLETE:te.Flags.FOLLOWS),data:void 0,metadata:u,streamId:r}]:[3,5]):[3,6];case 4:b.sent(),u=void 0,f=t,b.label=5;case 5:return[3,3];case 6:return R=0,d?(f-=te.Lengths.REQUEST,g=Math.min(l,R+f),L=e.data.slice(R,g),f-=L.byteLength,R=g,[4,{type:n,flags:te.Flags.FOLLOWS|(u?te.Flags.METADATA:te.Flags.NONE),data:L,requestN:s,metadata:u,streamId:r}]):[3,8];case 7:b.sent(),u=void 0,L=void 0,f=t,b.label=8;case 8:return R<l?(g=Math.min(l,R+f),L=e.data.slice(R,g),f-=L.byteLength,R=g,[4,{type:te.FrameTypes.PAYLOAD,flags:R===l?(o?te.Flags.COMPLETE:te.Flags.NONE)|te.Flags.NEXT|(u?te.Flags.METADATA:0):te.Flags.FOLLOWS|te.Flags.NEXT|(u?te.Flags.METADATA:0),data:L,metadata:u,streamId:r}]):[3,10];case 9:return b.sent(),u=void 0,L=void 0,f=t,[3,8];case 10:return[2]}})}yt.fragmentWithRequestN=o_});var En=ne(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.cancel=Vt.reassemble=Vt.add=void 0;function a_(r,e,t){return r.hasFragments?(r.data=r.data?Buffer.concat([r.data,e]):e,r.metadata&&t&&(r.metadata=Buffer.concat([r.metadata,t])),!0):(r.hasFragments=!0,r.data=e,t&&(r.metadata=t),!0)}Vt.add=a_;function l_(r,e,t){r.hasFragments=!1;var n=r.data?Buffer.concat([r.data,e]):e;if(r.data=void 0,r.metadata){var s=t?Buffer.concat([r.metadata,t]):r.metadata;return r.metadata=void 0,{data:n,metadata:s}}return{data:n}}Vt.reassemble=l_;function c_(r){r.hasFragments=!1,r.data=void 0,r.metadata=void 0}Vt.cancel=c_});var Jc=ne($e=>{"use strict";var u_=$e&&$e.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),f_=$e&&$e.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),h_=$e&&$e.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&u_(e,r,t);return f_(e,r),e},xs=$e&&$e.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty($e,"__esModule",{value:!0});$e.RequestChannelResponderStream=$e.RequestChannelRequesterStream=void 0;var Qe=Lt(),kr=yn(),V=rt(),Et=h_(En()),d_=function(){function r(e,t,n,s,o,l){this.payload=e,this.isComplete=t,this.receiver=n,this.fragmentSize=s,this.initialRequestN=o,this.leaseManager=l,this.streamType=V.FrameTypes.REQUEST_CHANNEL}return r.prototype.handleReady=function(e,t){var n,s;if(this.outboundDone)return!1;this.streamId=e,this.stream=t,t.connect(this);var o=this.isComplete;if(o&&(this.outboundDone=o),(0,kr.isFragmentable)(this.payload,this.fragmentSize,V.FrameTypes.REQUEST_CHANNEL))try{for(var l=xs((0,kr.fragmentWithRequestN)(e,this.payload,this.fragmentSize,V.FrameTypes.REQUEST_CHANNEL,this.initialRequestN,o)),d=l.next();!d.done;d=l.next()){var f=d.value;this.stream.send(f)}}catch(u){n={error:u}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(n)throw n.error}}else this.stream.send({type:V.FrameTypes.REQUEST_CHANNEL,data:this.payload.data,metadata:this.payload.metadata,requestN:this.initialRequestN,flags:(this.payload.metadata!==void 0?V.Flags.METADATA:V.Flags.NONE)|(o?V.Flags.COMPLETE:V.Flags.NONE),streamId:e});return this.hasExtension&&this.stream.send({type:V.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},r.prototype.handleReject=function(e){this.inboundDone||(this.inboundDone=!0,this.outboundDone=!0,this.receiver.onError(e))},r.prototype.handle=function(e){var t,n=e.type;switch(n){case V.FrameTypes.PAYLOAD:{var s=V.Flags.hasComplete(e.flags),o=V.Flags.hasNext(e.flags);if(s||!V.Flags.hasFollows(e.flags)){if(s&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this),!o)){this.receiver.onComplete();return}var l=this.hasFragments?Et.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};this.receiver.onNext(l,s);return}if(Et.add(this,e.data,e.metadata))return;t="Unexpected frame size";break}case V.FrameTypes.CANCEL:{if(this.outboundDone)return;this.outboundDone=!0,this.inboundDone&&this.stream.disconnect(this),this.receiver.cancel();return}case V.FrameTypes.REQUEST_N:{if(this.outboundDone)return;if(this.hasFragments){t="Unexpected frame type [".concat(n,"] during reassembly");break}this.receiver.request(e.requestN);return}case V.FrameTypes.ERROR:{var d=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,this.stream.disconnect(this),Et.cancel(this),d||this.receiver.cancel(),this.receiver.onError(new Qe.RSocketError(e.code,e.message));return}case V.FrameTypes.EXT:this.receiver.onExtension(e.extendedType,e.extendedContent,V.Flags.hasIgnore(e.flags));return;default:t="Unexpected frame type [".concat(n,"]")}this.close(new Qe.RSocketError(Qe.ErrorCodes.CANCELED,t)),this.stream.send({type:V.FrameTypes.CANCEL,streamId:this.streamId,flags:V.Flags.NONE}),this.stream.disconnect(this)},r.prototype.request=function(e){if(!this.inboundDone){if(!this.streamId){this.initialRequestN+=e;return}this.stream.send({type:V.FrameTypes.REQUEST_N,flags:V.Flags.NONE,requestN:e,streamId:this.streamId})}},r.prototype.cancel=function(){var e,t=this.inboundDone,n=this.outboundDone;if(!(t&&n)){if(this.inboundDone=!0,this.outboundDone=!0,n||this.receiver.cancel(),!this.streamId){(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this);return}this.stream.send({type:t?V.FrameTypes.ERROR:V.FrameTypes.CANCEL,flags:V.Flags.NONE,streamId:this.streamId,code:Qe.ErrorCodes.CANCELED,message:"Cancelled"}),this.stream.disconnect(this),Et.cancel(this)}},r.prototype.onNext=function(e,t){var n,s;if(!this.outboundDone)if(t&&(this.outboundDone=!0,this.inboundDone&&this.stream.disconnect(this)),(0,kr.isFragmentable)(e,this.fragmentSize,V.FrameTypes.PAYLOAD))try{for(var o=xs((0,kr.fragment)(this.streamId,e,this.fragmentSize,V.FrameTypes.PAYLOAD,t)),l=o.next();!l.done;l=o.next()){var d=l.value;this.stream.send(d)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}else this.stream.send({type:V.FrameTypes.PAYLOAD,streamId:this.streamId,flags:V.Flags.NEXT|(e.metadata?V.Flags.METADATA:V.Flags.NONE)|(t?V.Flags.COMPLETE:V.Flags.NONE),data:e.data,metadata:e.metadata})},r.prototype.onComplete=function(){if(!this.streamId){this.isComplete=!0;return}this.outboundDone||(this.outboundDone=!0,this.stream.send({type:V.FrameTypes.PAYLOAD,streamId:this.streamId,flags:V.Flags.COMPLETE,data:null,metadata:null}),this.inboundDone&&this.stream.disconnect(this))},r.prototype.onError=function(e){if(!this.outboundDone){var t=this.inboundDone;this.outboundDone=!0,this.inboundDone=!0,this.stream.send({type:V.FrameTypes.ERROR,streamId:this.streamId,flags:V.Flags.NONE,code:e instanceof Qe.RSocketError?e.code:Qe.ErrorCodes.APPLICATION_ERROR,message:e.message}),this.stream.disconnect(this),t||this.receiver.onError(e)}},r.prototype.onExtension=function(e,t,n){if(!this.outboundDone){if(!this.streamId){this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,this.flags=n?V.Flags.IGNORE:V.Flags.NONE;return}this.stream.send({streamId:this.streamId,type:V.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:n?V.Flags.IGNORE:V.Flags.NONE})}},r.prototype.close=function(e){if(!(this.inboundDone&&this.outboundDone)){var t=this.inboundDone,n=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,Et.cancel(this),n||this.receiver.cancel(),t||(e?this.receiver.onError(e):this.receiver.onComplete())}},r}();$e.RequestChannelRequesterStream=d_;var p_=function(){function r(e,t,n,s,o){if(this.streamId=e,this.stream=t,this.fragmentSize=n,this.handler=s,this.streamType=V.FrameTypes.REQUEST_CHANNEL,t.connect(this),V.Flags.hasFollows(o.flags)){Et.add(this,o.data,o.metadata),this.initialRequestN=o.requestN,this.isComplete=V.Flags.hasComplete(o.flags);return}var l={data:o.data,metadata:o.metadata},d=V.Flags.hasComplete(o.flags);this.inboundDone=d;try{this.receiver=s(l,o.requestN,d,this),this.outboundDone&&this.defferedError&&this.receiver.onError(this.defferedError)}catch(f){this.outboundDone&&!this.inboundDone?this.cancel():this.inboundDone=!0,this.onError(f)}}return r.prototype.handle=function(e){var t,n=e.type;switch(n){case V.FrameTypes.PAYLOAD:{if(V.Flags.hasFollows(e.flags)){if(Et.add(this,e.data,e.metadata))return;t="Unexpected frame size";break}var s=this.hasFragments?Et.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata},o=V.Flags.hasComplete(e.flags);if(this.receiver){if(o&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this),!V.Flags.hasNext(e.flags))){this.receiver.onComplete();return}this.receiver.onNext(s,o)}else{var l=this.isComplete||o;l&&(this.inboundDone=!0,this.outboundDone&&this.stream.disconnect(this));try{this.receiver=this.handler(s,this.initialRequestN,l,this),this.outboundDone&&this.defferedError}catch(u){this.outboundDone&&!this.inboundDone?this.cancel():this.inboundDone=!0,this.onError(u)}}return}case V.FrameTypes.REQUEST_N:{if(!this.receiver||this.hasFragments){t="Unexpected frame type [".concat(n,"] during reassembly");break}this.receiver.request(e.requestN);return}case V.FrameTypes.ERROR:case V.FrameTypes.CANCEL:{var l=this.inboundDone,d=this.outboundDone;if(this.inboundDone=!0,this.outboundDone=!0,this.stream.disconnect(this),Et.cancel(this),!this.receiver)return;if(d||this.receiver.cancel(),!l){var f=n===V.FrameTypes.CANCEL?new Qe.RSocketError(Qe.ErrorCodes.CANCELED,"Cancelled"):new Qe.RSocketError(e.code,e.message);this.receiver.onError(f)}return}case V.FrameTypes.EXT:{if(!this.receiver||this.hasFragments){t="Unexpected frame type [".concat(n,"] during reassembly");break}this.receiver.onExtension(e.extendedType,e.extendedContent,V.Flags.hasIgnore(e.flags));return}default:t="Unexpected frame type [".concat(n,"]")}this.stream.send({type:V.FrameTypes.ERROR,flags:V.Flags.NONE,code:Qe.ErrorCodes.CANCELED,message:t,streamId:this.streamId}),this.stream.disconnect(this),this.close(new Qe.RSocketError(Qe.ErrorCodes.CANCELED,t))},r.prototype.onError=function(e){if(this.outboundDone){console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}var t=this.inboundDone;this.outboundDone=!0,this.inboundDone=!0,this.stream.send({type:V.FrameTypes.ERROR,flags:V.Flags.NONE,code:e instanceof Qe.RSocketError?e.code:Qe.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this),t||(this.receiver?this.receiver.onError(e):this.defferedError=e)},r.prototype.onNext=function(e,t){var n,s;if(!this.outboundDone){if(t&&(this.outboundDone=!0),(0,kr.isFragmentable)(e,this.fragmentSize,V.FrameTypes.PAYLOAD))try{for(var o=xs((0,kr.fragment)(this.streamId,e,this.fragmentSize,V.FrameTypes.PAYLOAD,t)),l=o.next();!l.done;l=o.next()){var d=l.value;this.stream.send(d)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}else this.stream.send({type:V.FrameTypes.PAYLOAD,flags:V.Flags.NEXT|(t?V.Flags.COMPLETE:V.Flags.NONE)|(e.metadata?V.Flags.METADATA:V.Flags.NONE),data:e.data,metadata:e.metadata,streamId:this.streamId});t&&this.inboundDone&&this.stream.disconnect(this)}},r.prototype.onComplete=function(){this.outboundDone||(this.outboundDone=!0,this.stream.send({type:V.FrameTypes.PAYLOAD,flags:V.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.inboundDone&&this.stream.disconnect(this))},r.prototype.onExtension=function(e,t,n){this.outboundDone&&this.inboundDone||this.stream.send({type:V.FrameTypes.EXT,streamId:this.streamId,flags:n?V.Flags.IGNORE:V.Flags.NONE,extendedType:e,extendedContent:t})},r.prototype.request=function(e){this.inboundDone||this.stream.send({type:V.FrameTypes.REQUEST_N,flags:V.Flags.NONE,streamId:this.streamId,requestN:e})},r.prototype.cancel=function(){this.inboundDone||(this.inboundDone=!0,this.stream.send({type:V.FrameTypes.CANCEL,flags:V.Flags.NONE,streamId:this.streamId}),this.outboundDone&&this.stream.disconnect(this))},r.prototype.close=function(e){if(this.inboundDone&&this.outboundDone){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}var t=this.inboundDone,n=this.outboundDone;this.inboundDone=!0,this.outboundDone=!0,Et.cancel(this);var s=this.receiver;s&&(n||s.cancel(),t||(e?s.onError(e):s.onComplete()))},r}();$e.RequestChannelResponderStream=p_});var Zc=ne(je=>{"use strict";var __=je&&je.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),m_=je&&je.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),g_=je&&je.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&__(e,r,t);return m_(e,r),e},y_=je&&je.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(je,"__esModule",{value:!0});je.RequestFnfResponderStream=je.RequestFnFRequesterStream=void 0;var gi=Lt(),Yc=yn(),ze=rt(),wn=g_(En()),E_=function(){function r(e,t,n,s){this.payload=e,this.receiver=t,this.fragmentSize=n,this.leaseManager=s,this.streamType=ze.FrameTypes.REQUEST_FNF}return r.prototype.handleReady=function(e,t){var n,s;if(this.done)return!1;if(this.streamId=e,(0,Yc.isFragmentable)(this.payload,this.fragmentSize,ze.FrameTypes.REQUEST_FNF))try{for(var o=y_((0,Yc.fragment)(e,this.payload,this.fragmentSize,ze.FrameTypes.REQUEST_FNF)),l=o.next();!l.done;l=o.next()){var d=l.value;t.send(d)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}else t.send({type:ze.FrameTypes.REQUEST_FNF,data:this.payload.data,metadata:this.payload.metadata,flags:this.payload.metadata?ze.Flags.METADATA:0,streamId:e});return this.done=!0,this.receiver.onComplete(),!0},r.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},r.prototype.cancel=function(){var e;this.done||(this.done=!0,(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this))},r.prototype.handle=function(e){if(e.type==ze.FrameTypes.ERROR){this.close(new gi.RSocketError(e.code,e.message));return}this.close(new gi.RSocketError(gi.ErrorCodes.CANCELED,"Received invalid frame"))},r.prototype.close=function(e){if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}e?this.receiver.onError(e):this.receiver.onComplete()},r}();je.RequestFnFRequesterStream=E_;var w_=function(){function r(e,t,n,s){if(this.streamId=e,this.stream=t,this.handler=n,this.streamType=ze.FrameTypes.REQUEST_FNF,ze.Flags.hasFollows(s.flags)){wn.add(this,s.data,s.metadata),t.connect(this);return}var o={data:s.data,metadata:s.metadata};try{this.cancellable=n(o,this)}catch{}}return r.prototype.handle=function(e){var t;if(e.type==ze.FrameTypes.PAYLOAD)if(ze.Flags.hasFollows(e.flags)){if(wn.add(this,e.data,e.metadata))return;t="Unexpected fragment size"}else{this.stream.disconnect(this);var n=wn.reassemble(this,e.data,e.metadata);try{this.cancellable=this.handler(n,this)}catch{}return}else t="Unexpected frame type [".concat(e.type,"]");this.done=!0,e.type!=ze.FrameTypes.CANCEL&&e.type!=ze.FrameTypes.ERROR&&this.stream.send({type:ze.FrameTypes.ERROR,streamId:this.streamId,flags:ze.Flags.NONE,code:gi.ErrorCodes.CANCELED,message:t}),this.stream.disconnect(this),wn.cancel(this)},r.prototype.close=function(e){var t;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}this.done=!0,wn.cancel(this),(t=this.cancellable)===null||t===void 0||t.cancel()},r.prototype.onError=function(e){},r.prototype.onComplete=function(){},r}();je.RequestFnfResponderStream=w_});var tu=ne(Ve=>{"use strict";var S_=Ve&&Ve.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),T_=Ve&&Ve.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),b_=Ve&&Ve.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&S_(e,r,t);return T_(e,r),e},eu=Ve&&Ve.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.RequestResponseResponderStream=Ve.RequestResponseRequesterStream=void 0;var Pr=Lt(),yi=yn(),se=rt(),wt=b_(En()),I_=function(){function r(e,t,n,s){this.payload=e,this.receiver=t,this.fragmentSize=n,this.leaseManager=s,this.streamType=se.FrameTypes.REQUEST_RESPONSE}return r.prototype.handleReady=function(e,t){var n,s;if(this.done)return!1;if(this.streamId=e,this.stream=t,t.connect(this),(0,yi.isFragmentable)(this.payload,this.fragmentSize,se.FrameTypes.REQUEST_RESPONSE))try{for(var o=eu((0,yi.fragment)(e,this.payload,this.fragmentSize,se.FrameTypes.REQUEST_RESPONSE)),l=o.next();!l.done;l=o.next()){var d=l.value;this.stream.send(d)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}else this.stream.send({type:se.FrameTypes.REQUEST_RESPONSE,data:this.payload.data,metadata:this.payload.metadata,flags:this.payload.metadata?se.Flags.METADATA:0,streamId:e});return this.hasExtension&&this.stream.send({type:se.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},r.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},r.prototype.handle=function(e){var t,n=e.type;switch(n){case se.FrameTypes.PAYLOAD:{var s=se.Flags.hasComplete(e.flags),o=se.Flags.hasNext(e.flags);if(s||!se.Flags.hasFollows(e.flags)){if(this.done=!0,this.stream.disconnect(this),!o){this.receiver.onComplete();return}var l=this.hasFragments?wt.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};this.receiver.onNext(l,!0);return}if(!wt.add(this,e.data,e.metadata)){t="Unexpected fragment size";break}return}case se.FrameTypes.ERROR:{this.done=!0,this.stream.disconnect(this),wt.cancel(this),this.receiver.onError(new Pr.RSocketError(e.code,e.message));return}case se.FrameTypes.EXT:{if(this.hasFragments){t="Unexpected frame type [".concat(n,"] during reassembly");break}this.receiver.onExtension(e.extendedType,e.extendedContent,se.Flags.hasIgnore(e.flags));return}default:t="Unexpected frame type [".concat(n,"]")}this.close(new Pr.RSocketError(Pr.ErrorCodes.CANCELED,t)),this.stream.send({type:se.FrameTypes.CANCEL,streamId:this.streamId,flags:se.Flags.NONE}),this.stream.disconnect(this)},r.prototype.cancel=function(){var e;if(!this.done){if(this.done=!0,!this.streamId){(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this);return}this.stream.send({type:se.FrameTypes.CANCEL,flags:se.Flags.NONE,streamId:this.streamId}),this.stream.disconnect(this),wt.cancel(this)}},r.prototype.onExtension=function(e,t,n){if(!this.done){if(!this.streamId){this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,this.flags=n?se.Flags.IGNORE:se.Flags.NONE;return}this.stream.send({streamId:this.streamId,type:se.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:n?se.Flags.IGNORE:se.Flags.NONE})}},r.prototype.close=function(e){this.done||(this.done=!0,wt.cancel(this),e?this.receiver.onError(e):this.receiver.onComplete())},r}();Ve.RequestResponseRequesterStream=I_;var R_=function(){function r(e,t,n,s,o){if(this.streamId=e,this.stream=t,this.fragmentSize=n,this.handler=s,this.streamType=se.FrameTypes.REQUEST_RESPONSE,t.connect(this),se.Flags.hasFollows(o.flags)){wt.add(this,o.data,o.metadata);return}var l={data:o.data,metadata:o.metadata};try{this.receiver=s(l,this)}catch(d){this.onError(d)}}return r.prototype.handle=function(e){var t,n;if(!this.receiver||this.hasFragments)if(e.type===se.FrameTypes.PAYLOAD)if(se.Flags.hasFollows(e.flags)){if(wt.add(this,e.data,e.metadata))return;n="Unexpected fragment size"}else{var s=wt.reassemble(this,e.data,e.metadata);try{this.receiver=this.handler(s,this)}catch(o){this.onError(o)}return}else n="Unexpected frame type [".concat(e.type,"] during reassembly");else if(e.type===se.FrameTypes.EXT){this.receiver.onExtension(e.extendedType,e.extendedContent,se.Flags.hasIgnore(e.flags));return}else n="Unexpected frame type [".concat(e.type,"]");this.done=!0,(t=this.receiver)===null||t===void 0||t.cancel(),e.type!==se.FrameTypes.CANCEL&&e.type!==se.FrameTypes.ERROR&&this.stream.send({type:se.FrameTypes.ERROR,flags:se.Flags.NONE,code:Pr.ErrorCodes.CANCELED,message:n,streamId:this.streamId}),this.stream.disconnect(this),wt.cancel(this)},r.prototype.onError=function(e){if(this.done){console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}this.done=!0,this.stream.send({type:se.FrameTypes.ERROR,flags:se.Flags.NONE,code:e instanceof Pr.RSocketError?e.code:Pr.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this)},r.prototype.onNext=function(e,t){var n,s;if(!this.done){if(this.done=!0,(0,yi.isFragmentable)(e,this.fragmentSize,se.FrameTypes.PAYLOAD))try{for(var o=eu((0,yi.fragment)(this.streamId,e,this.fragmentSize,se.FrameTypes.PAYLOAD,!0)),l=o.next();!l.done;l=o.next()){var d=l.value;this.stream.send(d)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}else this.stream.send({type:se.FrameTypes.PAYLOAD,flags:se.Flags.NEXT|se.Flags.COMPLETE|(e.metadata?se.Flags.METADATA:0),data:e.data,metadata:e.metadata,streamId:this.streamId});this.stream.disconnect(this)}},r.prototype.onComplete=function(){this.done||(this.done=!0,this.stream.send({type:se.FrameTypes.PAYLOAD,flags:se.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.stream.disconnect(this))},r.prototype.onExtension=function(e,t,n){this.done||this.stream.send({type:se.FrameTypes.EXT,streamId:this.streamId,flags:n?se.Flags.IGNORE:se.Flags.NONE,extendedType:e,extendedContent:t})},r.prototype.close=function(e){var t;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}wt.cancel(this),(t=this.receiver)===null||t===void 0||t.cancel()},r}();Ve.RequestResponseResponderStream=R_});var nu=ne(He=>{"use strict";var v_=He&&He.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),L_=He&&He.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),O_=He&&He.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&v_(e,r,t);return L_(e,r),e},ru=He&&He.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(He,"__esModule",{value:!0});He.RequestStreamResponderStream=He.RequestStreamRequesterStream=void 0;var Mr=Lt(),Ei=yn(),ee=rt(),St=O_(En()),x_=function(){function r(e,t,n,s,o){this.payload=e,this.receiver=t,this.fragmentSize=n,this.initialRequestN=s,this.leaseManager=o,this.streamType=ee.FrameTypes.REQUEST_STREAM}return r.prototype.handleReady=function(e,t){var n,s;if(this.done)return!1;if(this.streamId=e,this.stream=t,t.connect(this),(0,Ei.isFragmentable)(this.payload,this.fragmentSize,ee.FrameTypes.REQUEST_STREAM))try{for(var o=ru((0,Ei.fragmentWithRequestN)(e,this.payload,this.fragmentSize,ee.FrameTypes.REQUEST_STREAM,this.initialRequestN)),l=o.next();!l.done;l=o.next()){var d=l.value;this.stream.send(d)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}else this.stream.send({type:ee.FrameTypes.REQUEST_STREAM,data:this.payload.data,metadata:this.payload.metadata,requestN:this.initialRequestN,flags:this.payload.metadata!==void 0?ee.Flags.METADATA:0,streamId:e});return this.hasExtension&&this.stream.send({type:ee.FrameTypes.EXT,streamId:e,extendedContent:this.extendedContent,extendedType:this.extendedType,flags:this.flags}),!0},r.prototype.handleReject=function(e){this.done||(this.done=!0,this.receiver.onError(e))},r.prototype.handle=function(e){var t,n=e.type;switch(n){case ee.FrameTypes.PAYLOAD:{var s=ee.Flags.hasComplete(e.flags),o=ee.Flags.hasNext(e.flags);if(s||!ee.Flags.hasFollows(e.flags)){if(s&&(this.done=!0,this.stream.disconnect(this),!o)){this.receiver.onComplete();return}var l=this.hasFragments?St.reassemble(this,e.data,e.metadata):{data:e.data,metadata:e.metadata};this.receiver.onNext(l,s);return}if(!St.add(this,e.data,e.metadata)){t="Unexpected fragment size";break}return}case ee.FrameTypes.ERROR:{this.done=!0,this.stream.disconnect(this),St.cancel(this),this.receiver.onError(new Mr.RSocketError(e.code,e.message));return}case ee.FrameTypes.EXT:{if(this.hasFragments){t="Unexpected frame type [".concat(n,"] during reassembly");break}this.receiver.onExtension(e.extendedType,e.extendedContent,ee.Flags.hasIgnore(e.flags));return}default:t="Unexpected frame type [".concat(n,"]")}this.close(new Mr.RSocketError(Mr.ErrorCodes.CANCELED,t)),this.stream.send({type:ee.FrameTypes.CANCEL,streamId:this.streamId,flags:ee.Flags.NONE}),this.stream.disconnect(this)},r.prototype.request=function(e){if(!this.done){if(!this.streamId){this.initialRequestN+=e;return}this.stream.send({type:ee.FrameTypes.REQUEST_N,flags:ee.Flags.NONE,requestN:e,streamId:this.streamId})}},r.prototype.cancel=function(){var e;if(!this.done){if(this.done=!0,!this.streamId){(e=this.leaseManager)===null||e===void 0||e.cancelRequest(this);return}this.stream.send({type:ee.FrameTypes.CANCEL,flags:ee.Flags.NONE,streamId:this.streamId}),this.stream.disconnect(this),St.cancel(this)}},r.prototype.onExtension=function(e,t,n){if(!this.done){if(!this.streamId){this.hasExtension=!0,this.extendedType=e,this.extendedContent=t,this.flags=n?ee.Flags.IGNORE:ee.Flags.NONE;return}this.stream.send({streamId:this.streamId,type:ee.FrameTypes.EXT,extendedType:e,extendedContent:t,flags:n?ee.Flags.IGNORE:ee.Flags.NONE})}},r.prototype.close=function(e){this.done||(this.done=!0,St.cancel(this),e?this.receiver.onError(e):this.receiver.onComplete())},r}();He.RequestStreamRequesterStream=x_;var A_=function(){function r(e,t,n,s,o){if(this.streamId=e,this.stream=t,this.fragmentSize=n,this.handler=s,this.streamType=ee.FrameTypes.REQUEST_STREAM,t.connect(this),ee.Flags.hasFollows(o.flags)){this.initialRequestN=o.requestN,St.add(this,o.data,o.metadata);return}var l={data:o.data,metadata:o.metadata};try{this.receiver=s(l,o.requestN,this)}catch(d){this.onError(d)}}return r.prototype.handle=function(e){var t,n;if(!this.receiver||this.hasFragments)if(e.type===ee.FrameTypes.PAYLOAD)if(ee.Flags.hasFollows(e.flags)){if(St.add(this,e.data,e.metadata))return;n="Unexpected frame size"}else{var s=St.reassemble(this,e.data,e.metadata);try{this.receiver=this.handler(s,this.initialRequestN,this)}catch(o){this.onError(o)}return}else n="Unexpected frame type [".concat(e.type,"] during reassembly");else if(e.type===ee.FrameTypes.REQUEST_N){this.receiver.request(e.requestN);return}else if(e.type===ee.FrameTypes.EXT){this.receiver.onExtension(e.extendedType,e.extendedContent,ee.Flags.hasIgnore(e.flags));return}else n="Unexpected frame type [".concat(e.type,"]");this.done=!0,St.cancel(this),(t=this.receiver)===null||t===void 0||t.cancel(),e.type!==ee.FrameTypes.CANCEL&&e.type!==ee.FrameTypes.ERROR&&this.stream.send({type:ee.FrameTypes.ERROR,flags:ee.Flags.NONE,code:Mr.ErrorCodes.CANCELED,message:n,streamId:this.streamId}),this.stream.disconnect(this)},r.prototype.onError=function(e){if(this.done){console.warn("Trying to error for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}this.done=!0,this.stream.send({type:ee.FrameTypes.ERROR,flags:ee.Flags.NONE,code:e instanceof Mr.RSocketError?e.code:Mr.ErrorCodes.APPLICATION_ERROR,message:e.message,streamId:this.streamId}),this.stream.disconnect(this)},r.prototype.onNext=function(e,t){var n,s;if(!this.done){if(t&&(this.done=!0),(0,Ei.isFragmentable)(e,this.fragmentSize,ee.FrameTypes.PAYLOAD))try{for(var o=ru((0,Ei.fragment)(this.streamId,e,this.fragmentSize,ee.FrameTypes.PAYLOAD,t)),l=o.next();!l.done;l=o.next()){var d=l.value;this.stream.send(d)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}else this.stream.send({type:ee.FrameTypes.PAYLOAD,flags:ee.Flags.NEXT|(t?ee.Flags.COMPLETE:ee.Flags.NONE)|(e.metadata?ee.Flags.METADATA:ee.Flags.NONE),data:e.data,metadata:e.metadata,streamId:this.streamId});t&&this.stream.disconnect(this)}},r.prototype.onComplete=function(){this.done||(this.done=!0,this.stream.send({type:ee.FrameTypes.PAYLOAD,flags:ee.Flags.COMPLETE,streamId:this.streamId,data:null,metadata:null}),this.stream.disconnect(this))},r.prototype.onExtension=function(e,t,n){this.done||this.stream.send({type:ee.FrameTypes.EXT,streamId:this.streamId,flags:n?ee.Flags.IGNORE:ee.Flags.NONE,extendedType:e,extendedContent:t})},r.prototype.close=function(e){var t;if(this.done){console.warn("Trying to close for the second time. ".concat(e?"Dropping error [".concat(e,"]."):""));return}St.cancel(this),(t=this.receiver)===null||t===void 0||t.cancel()},r}();He.RequestStreamResponderStream=A_});var As=ne(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.KeepAliveSender=We.KeepAliveHandler=We.DefaultConnectionFrameHandler=We.DefaultStreamRequestHandler=We.LeaseHandler=We.RSocketRequester=void 0;var Sn=Lt(),Ne=rt(),iu=Jc(),su=Zc(),ou=tu(),au=nu(),N_=function(){function r(e,t,n){this.connection=e,this.fragmentSize=t,this.leaseManager=n}return r.prototype.fireAndForget=function(e,t){var n=new su.RequestFnFRequesterStream(e,t,this.fragmentSize,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(n):this.connection.multiplexerDemultiplexer.createRequestStream(n),n},r.prototype.requestResponse=function(e,t){var n=new ou.RequestResponseRequesterStream(e,t,this.fragmentSize,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(n):this.connection.multiplexerDemultiplexer.createRequestStream(n),n},r.prototype.requestStream=function(e,t,n){var s=new au.RequestStreamRequesterStream(e,n,this.fragmentSize,t,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(s):this.connection.multiplexerDemultiplexer.createRequestStream(s),s},r.prototype.requestChannel=function(e,t,n,s){var o=new iu.RequestChannelRequesterStream(e,n,s,this.fragmentSize,t,this.leaseManager);return this.leaseManager?this.leaseManager.requestLease(o):this.connection.multiplexerDemultiplexer.createRequestStream(o),o},r.prototype.metadataPush=function(e,t){throw new Error("Method not implemented.")},r.prototype.close=function(e){this.connection.close(e)},r.prototype.onClose=function(e){this.connection.onClose(e)},r}();We.RSocketRequester=N_;var F_=function(){function r(e,t){this.maxPendingRequests=e,this.multiplexer=t,this.pendingRequests=[],this.expirationTime=0,this.availableLease=0}return r.prototype.handle=function(e){for(this.expirationTime=e.ttl+Date.now(),this.availableLease=e.requestCount;this.availableLease>0&&this.pendingRequests.length>0;){var t=this.pendingRequests.shift();this.availableLease--,this.multiplexer.createRequestStream(t)}},r.prototype.requestLease=function(e){var t=this.availableLease;if(t>0&&Date.now()<this.expirationTime){this.availableLease=t-1,this.multiplexer.createRequestStream(e);return}if(this.pendingRequests.length>=this.maxPendingRequests){e.handleReject(new Sn.RSocketError(Sn.ErrorCodes.REJECTED,"No available lease given"));return}this.pendingRequests.push(e)},r.prototype.cancelRequest=function(e){var t=this.pendingRequests.indexOf(e);t>-1&&this.pendingRequests.splice(t,1)},r}();We.LeaseHandler=F_;var C_=function(){function r(e,t){this.rsocket=e,this.fragmentSize=t}return r.prototype.handle=function(e,t){switch(e.type){case Ne.FrameTypes.REQUEST_FNF:this.rsocket.fireAndForget&&new su.RequestFnfResponderStream(e.streamId,t,this.rsocket.fireAndForget.bind(this.rsocket),e);return;case Ne.FrameTypes.REQUEST_RESPONSE:if(this.rsocket.requestResponse){new ou.RequestResponseResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestResponse.bind(this.rsocket),e);return}this.rejectRequest(e.streamId,t);return;case Ne.FrameTypes.REQUEST_STREAM:if(this.rsocket.requestStream){new au.RequestStreamResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestStream.bind(this.rsocket),e);return}this.rejectRequest(e.streamId,t);return;case Ne.FrameTypes.REQUEST_CHANNEL:if(this.rsocket.requestChannel){new iu.RequestChannelResponderStream(e.streamId,t,this.fragmentSize,this.rsocket.requestChannel.bind(this.rsocket),e);return}this.rejectRequest(e.streamId,t);return}},r.prototype.rejectRequest=function(e,t){t.send({type:Ne.FrameTypes.ERROR,streamId:e,flags:Ne.Flags.NONE,code:Sn.ErrorCodes.REJECTED,message:"No available handler found"})},r.prototype.close=function(){},r}();We.DefaultStreamRequestHandler=C_;var B_=function(){function r(e,t,n,s,o){this.connection=e,this.keepAliveHandler=t,this.keepAliveSender=n,this.leaseHandler=s,this.rsocket=o}return r.prototype.handle=function(e){switch(e.type){case Ne.FrameTypes.KEEPALIVE:this.keepAliveHandler.handle(e);return;case Ne.FrameTypes.LEASE:if(this.leaseHandler){this.leaseHandler.handle(e);return}return;case Ne.FrameTypes.ERROR:this.connection.close(new Sn.RSocketError(e.code,e.message));return;case Ne.FrameTypes.METADATA_PUSH:this.rsocket.metadataPush;return;default:this.connection.multiplexerDemultiplexer.connectionOutbound.send({type:Ne.FrameTypes.ERROR,streamId:0,flags:Ne.Flags.NONE,message:"Received unknown frame type",code:Sn.ErrorCodes.CONNECTION_ERROR})}},r.prototype.pause=function(){var e;this.keepAliveHandler.pause(),(e=this.keepAliveSender)===null||e===void 0||e.pause()},r.prototype.resume=function(){var e;this.keepAliveHandler.start(),(e=this.keepAliveSender)===null||e===void 0||e.start()},r.prototype.close=function(e){var t;this.keepAliveHandler.close(),(t=this.rsocket.close)===null||t===void 0||t.call(this.rsocket,e)},r}();We.DefaultConnectionFrameHandler=B_;var Ht;(function(r){r[r.Paused=0]="Paused",r[r.Running=1]="Running",r[r.Closed=2]="Closed"})(Ht||(Ht={}));var q_=function(){function r(e,t){this.connection=e,this.keepAliveTimeoutDuration=t,this.state=Ht.Paused,this.outbound=e.multiplexerDemultiplexer.connectionOutbound}return r.prototype.handle=function(e){this.keepAliveLastReceivedMillis=Date.now(),Ne.Flags.hasRespond(e.flags)&&this.outbound.send({type:Ne.FrameTypes.KEEPALIVE,streamId:0,data:e.data,flags:e.flags^Ne.Flags.RESPOND,lastReceivedPosition:0})},r.prototype.start=function(){this.state===Ht.Paused&&(this.keepAliveLastReceivedMillis=Date.now(),this.state=Ht.Running,this.activeTimeout=setTimeout(this.timeoutCheck.bind(this),this.keepAliveTimeoutDuration))},r.prototype.pause=function(){this.state===Ht.Running&&(this.state=Ht.Paused,clearTimeout(this.activeTimeout))},r.prototype.close=function(){this.state=Ht.Closed,clearTimeout(this.activeTimeout)},r.prototype.timeoutCheck=function(){var e=Date.now(),t=e-this.keepAliveLastReceivedMillis;t>=this.keepAliveTimeoutDuration?this.connection.close(new Error("No keep-alive acks for ".concat(this.keepAliveTimeoutDuration," millis"))):this.activeTimeout=setTimeout(this.timeoutCheck.bind(this),Math.max(100,this.keepAliveTimeoutDuration-t))},r}();We.KeepAliveHandler=q_;var Wt;(function(r){r[r.Paused=0]="Paused",r[r.Running=1]="Running",r[r.Closed=2]="Closed"})(Wt||(Wt={}));var D_=function(){function r(e,t){this.outbound=e,this.keepAlivePeriodDuration=t,this.state=Wt.Paused}return r.prototype.sendKeepAlive=function(){this.outbound.send({type:Ne.FrameTypes.KEEPALIVE,streamId:0,data:void 0,flags:Ne.Flags.RESPOND,lastReceivedPosition:0})},r.prototype.start=function(){this.state===Wt.Paused&&(this.state=Wt.Running,this.activeInterval=setInterval(this.sendKeepAlive.bind(this),this.keepAlivePeriodDuration))},r.prototype.pause=function(){this.state===Wt.Running&&(this.state=Wt.Paused,clearInterval(this.activeInterval))},r.prototype.close=function(){this.state=Wt.Closed,clearInterval(this.activeInterval)},r}();We.KeepAliveSender=D_});var Fs=ne(Qr=>{"use strict";var U_=Qr&&Qr.__values||function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.FrameStore=void 0;var lu=Ur(),Ns=vs(),k_=function(){function r(){this.storedFrames=[],this._lastReceivedFramePosition=0,this._firstAvailableFramePosition=0,this._lastSentFramePosition=0}return Object.defineProperty(r.prototype,"lastReceivedFramePosition",{get:function(){return this._lastReceivedFramePosition},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"firstAvailableFramePosition",{get:function(){return this._firstAvailableFramePosition},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastSentFramePosition",{get:function(){return this._lastSentFramePosition},enumerable:!1,configurable:!0}),r.prototype.store=function(e){this._lastSentFramePosition+=(0,Ns.sizeOfFrame)(e),this.storedFrames.push(e)},r.prototype.record=function(e){this._lastReceivedFramePosition+=(0,Ns.sizeOfFrame)(e)},r.prototype.dropTo=function(e){for(var t=e-this._firstAvailableFramePosition;t>0&&this.storedFrames.length>0;){var n=this.storedFrames.shift();t-=(0,Ns.sizeOfFrame)(n)}if(t!==0)throw new lu.RSocketError(lu.ErrorCodes.CONNECTION_ERROR,"State inconsistency. Expected bytes to drop ".concat(e-this._firstAvailableFramePosition," but actual ").concat(t));this._firstAvailableFramePosition=e},r.prototype.drain=function(e){var t,n;try{for(var s=U_(this.storedFrames),o=s.next();!o.done;o=s.next()){var l=o.value;e(l)}}catch(d){t={error:d}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},r}();Qr.FrameStore=k_});var fu=ne(Kt=>{"use strict";var cu=Kt&&Kt.__awaiter||function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},uu=Kt&&Kt.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(u){return function(p){return f([u,p])}}function f(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(o=u[0]&2?s.return:u[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,u[1])).done)return o;switch(s=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],s=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.RSocketConnector=void 0;var Tn=Os(),Ot=rt(),$r=As(),P_=Fs(),M_=function(){function r(e){this.config=e}return r.prototype.connect=function(){var e,t,n,s,o,l,d,f,u,p,_,I,R,L,g,w,y,b,A,v;return cu(this,void 0,void 0,function(){var k,Q,N,K,G,W,S,O,$,Y=this;return uu(this,function(ae){switch(ae.label){case 0:return k=this.config,Q={type:Ot.FrameTypes.SETUP,dataMimeType:(t=(e=k.setup)===null||e===void 0?void 0:e.dataMimeType)!==null&&t!==void 0?t:"application/octet-stream",metadataMimeType:(s=(n=k.setup)===null||n===void 0?void 0:n.metadataMimeType)!==null&&s!==void 0?s:"application/octet-stream",keepAlive:(l=(o=k.setup)===null||o===void 0?void 0:o.keepAlive)!==null&&l!==void 0?l:6e4,lifetime:(f=(d=k.setup)===null||d===void 0?void 0:d.lifetime)!==null&&f!==void 0?f:3e5,metadata:(p=(u=k.setup)===null||u===void 0?void 0:u.payload)===null||p===void 0?void 0:p.metadata,data:(I=(_=k.setup)===null||_===void 0?void 0:_.payload)===null||I===void 0?void 0:I.data,resumeToken:(L=(R=k.resume)===null||R===void 0?void 0:R.tokenGenerator())!==null&&L!==void 0?L:null,streamId:0,majorVersion:1,minorVersion:0,flags:(!((w=(g=k.setup)===null||g===void 0?void 0:g.payload)===null||w===void 0)&&w.metadata?Ot.Flags.METADATA:Ot.Flags.NONE)|(k.lease?Ot.Flags.LEASE:Ot.Flags.NONE)|(k.resume?Ot.Flags.RESUME_ENABLE:Ot.Flags.NONE)},[4,k.transport.connect(function(ie){return k.resume?new Tn.ResumableClientServerInputMultiplexerDemultiplexer(Tn.StreamIdGenerator.create(-1),ie,ie,new P_.FrameStore,Q.resumeToken.toString(),function(Ce,ft){return cu(Y,void 0,void 0,function(){var Se,Te,br;return uu(this,function(ht){switch(ht.label){case 0:return Se=function(Ir){return Ir.send({type:Ot.FrameTypes.RESUME,streamId:0,flags:Ot.Flags.NONE,clientPosition:ft.firstAvailableFramePosition,serverPosition:ft.lastReceivedFramePosition,majorVersion:Q.minorVersion,minorVersion:Q.majorVersion,resumeToken:Q.resumeToken}),new Tn.ResumeOkAwaitingResumableClientServerInputMultiplexerDemultiplexer(Ir,Ir,Ce)},Te=-1,br=function(){return Te++,k.resume.reconnectFunction(Te).then(function(){return k.transport.connect(Se).catch(br)})},[4,br()];case 1:return ht.sent(),[2]}})})}):new Tn.ClientServerInputMultiplexerDemultiplexer(Tn.StreamIdGenerator.create(-1),ie,ie)})];case 1:return N=ae.sent(),K=new $r.KeepAliveSender(N.multiplexerDemultiplexer.connectionOutbound,Q.keepAlive),G=new $r.KeepAliveHandler(N,Q.lifetime),W=k.lease?new $r.LeaseHandler((y=k.lease.maxPendingRequests)!==null&&y!==void 0?y:256,N.multiplexerDemultiplexer):void 0,S=(b=k.responder)!==null&&b!==void 0?b:{},O=new $r.DefaultConnectionFrameHandler(N,G,K,W,S),$=new $r.DefaultStreamRequestHandler(S,0),N.onClose(function(ie){K.close(),G.close(),O.close(ie)}),N.multiplexerDemultiplexer.connectionInbound(O),N.multiplexerDemultiplexer.handleRequestStream($),N.multiplexerDemultiplexer.connectionOutbound.send(Q),G.start(),K.start(),[2,new $r.RSocketRequester(N,(v=(A=k.fragmentation)===null||A===void 0?void 0:A.maxOutboundFragmentSize)!==null&&v!==void 0?v:0,W)]}})})},r}();Kt.RSocketConnector=M_});var pu=ne(Gt=>{"use strict";var hu=Gt&&Gt.__awaiter||function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},du=Gt&&Gt.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(u){return function(p){return f([u,p])}}function f(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(o=u[0]&2?s.return:u[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,u[1])).done)return o;switch(s=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],s=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.RSocketServer=void 0;var wi=Os(),Ue=Lt(),Ee=rt(),zr=As(),Q_=Fs(),$_=function(){function r(e){var t,n;this.acceptor=e.acceptor,this.transport=e.transport,this.lease=e.lease,this.serverSideKeepAlive=e.serverSideKeepAlive,this.sessionStore=e.resume?{}:void 0,this.sessionTimeout=(n=(t=e.resume)===null||t===void 0?void 0:t.sessionTimeout)!==null&&n!==void 0?n:void 0}return r.prototype.bind=function(){return hu(this,void 0,void 0,function(){var e=this;return du(this,function(t){switch(t.label){case 0:return[4,this.transport.bind(function(n,s){return hu(e,void 0,void 0,function(){var o,l,l,d,f,u,p,_,I,R,L,g,w,y,b;return du(this,function(A){switch(A.label){case 0:switch(o=n.type,o){case Ee.FrameTypes.SETUP:return[3,1];case Ee.FrameTypes.RESUME:return[3,5]}return[3,6];case 1:return A.trys.push([1,3,,4]),this.lease&&!Ee.Flags.hasLease(n.flags)?(l=new Ue.RSocketError(Ue.ErrorCodes.REJECTED_SETUP,"Lease has to be enabled"),s.multiplexerDemultiplexer.connectionOutbound.send({type:Ee.FrameTypes.ERROR,streamId:0,flags:Ee.Flags.NONE,code:l.code,message:l.message}),s.close(l),[2]):Ee.Flags.hasLease(n.flags)&&!this.lease?(l=new Ue.RSocketError(Ue.ErrorCodes.REJECTED_SETUP,"Lease has to be disabled"),s.multiplexerDemultiplexer.connectionOutbound.send({type:Ee.FrameTypes.ERROR,streamId:0,flags:Ee.Flags.NONE,code:l.code,message:l.message}),s.close(l),[2]):(d=Ee.Flags.hasLease(n.flags)?new zr.LeaseHandler((g=this.lease.maxPendingRequests)!==null&&g!==void 0?g:256,s.multiplexerDemultiplexer):void 0,f=new zr.RSocketRequester(s,(y=(w=this.fragmentation)===null||w===void 0?void 0:w.maxOutboundFragmentSize)!==null&&y!==void 0?y:0,d),[4,this.acceptor.accept({data:n.data,dataMimeType:n.dataMimeType,metadata:n.metadata,metadataMimeType:n.metadataMimeType,flags:n.flags,keepAliveMaxLifetime:n.lifetime,keepAliveInterval:n.keepAlive,resumeToken:n.resumeToken},f)]);case 2:return u=A.sent(),p=new zr.KeepAliveHandler(s,n.lifetime),_=this.serverSideKeepAlive?new zr.KeepAliveSender(s.multiplexerDemultiplexer.connectionOutbound,n.keepAlive):void 0,I=new zr.DefaultConnectionFrameHandler(s,p,_,d,u),R=new zr.DefaultStreamRequestHandler(u,0),s.onClose(function(v){_?.close(),p.close(),I.close(v)}),s.multiplexerDemultiplexer.connectionInbound(I),s.multiplexerDemultiplexer.handleRequestStream(R),p.start(),_?.start(),[3,4];case 3:return L=A.sent(),s.multiplexerDemultiplexer.connectionOutbound.send({type:Ee.FrameTypes.ERROR,streamId:0,code:Ue.ErrorCodes.REJECTED_SETUP,message:(b=L.message)!==null&&b!==void 0?b:"",flags:Ee.Flags.NONE}),s.close(L instanceof Ue.RSocketError?L:new Ue.RSocketError(Ue.ErrorCodes.REJECTED_SETUP,L.message)),[3,4];case 4:return[2];case 5:return[2];case 6:s.multiplexerDemultiplexer.connectionOutbound.send({type:Ee.FrameTypes.ERROR,streamId:0,code:Ue.ErrorCodes.UNSUPPORTED_SETUP,message:"Unsupported setup",flags:Ee.Flags.NONE}),s.close(new Ue.RSocketError(Ue.ErrorCodes.UNSUPPORTED_SETUP)),A.label=7;case 7:return[2]}})})},function(n,s){if(n.type===Ee.FrameTypes.RESUME){if(e.sessionStore){var o=e.sessionStore[n.resumeToken.toString()];if(!o){s.send({type:Ee.FrameTypes.ERROR,streamId:0,code:Ue.ErrorCodes.REJECTED_RESUME,message:"No session found for the given resume token",flags:Ee.Flags.NONE}),s.close();return}return o.resume(n,s,s),o}s.send({type:Ee.FrameTypes.ERROR,streamId:0,code:Ue.ErrorCodes.REJECTED_RESUME,message:"Resume is not enabled",flags:Ee.Flags.NONE}),s.close();return}else if(n.type===Ee.FrameTypes.SETUP&&Ee.Flags.hasResume(n.flags)){if(!e.sessionStore){var l=new Ue.RSocketError(Ue.ErrorCodes.REJECTED_SETUP,"No resume support");s.send({type:Ee.FrameTypes.ERROR,streamId:0,flags:Ee.Flags.NONE,code:l.code,message:l.message}),s.close(l);return}var d=new wi.ResumableClientServerInputMultiplexerDemultiplexer(wi.StreamIdGenerator.create(0),s,s,new Q_.FrameStore,n.resumeToken.toString(),e.sessionStore,e.sessionTimeout);return e.sessionStore[n.resumeToken.toString()]=d,d}return new wi.ClientServerInputMultiplexerDemultiplexer(wi.StreamIdGenerator.create(0),s,s)})];case 1:return[2,t.sent()]}})})},r}();Gt.RSocketServer=$_});var mu=ne(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0})});var Ur=ne(ke=>{"use strict";var z_=ke&&ke.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),xt=ke&&ke.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&z_(e,r,t)};Object.defineProperty(ke,"__esModule",{value:!0});xt(vs(),ke);xt(zc(),ke);xt(Ls(),ke);xt(Lt(),ke);xt(rt(),ke);xt(Hc(),ke);xt(fu(),ke);xt(pu(),ke);xt(mu(),ke)});var yu=ne(jr=>{"use strict";var j_=jr&&jr.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();Object.defineProperty(jr,"__esModule",{value:!0});jr.WebsocketDuplexConnection=void 0;var gu=Ur(),V_=function(r){j_(e,r);function e(t,n,s){var o=r.call(this)||this;return o.websocket=t,o.deserializer=n,o.handleClosed=function(l){o.close(new Error(l.reason||"WebsocketDuplexConnection: Socket closed unexpectedly."))},o.handleError=function(l){o.close(l.error)},o.handleMessage=function(l){try{var d=Buffer.from(l.data),f=o.deserializer.deserializeFrame(d);o.multiplexerDemultiplexer.handle(f)}catch(u){o.close(u)}},t.addEventListener("close",o.handleClosed),t.addEventListener("error",o.handleError),t.addEventListener("message",o.handleMessage),o.multiplexerDemultiplexer=s(o),o}return Object.defineProperty(e.prototype,"availability",{get:function(){return this.done?0:1},enumerable:!1,configurable:!0}),e.prototype.close=function(t){if(this.done){r.prototype.close.call(this,t);return}this.websocket.removeEventListener("close",this.handleClosed),this.websocket.removeEventListener("error",this.handleError),this.websocket.removeEventListener("message",this.handleMessage),this.websocket.close(),delete this.websocket,r.prototype.close.call(this,t)},e.prototype.send=function(t){if(!this.done){var n=(0,gu.serializeFrame)(t);this.websocket.send(n)}},e}(gu.Deferred);jr.WebsocketDuplexConnection=V_});var Eu=ne(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});Si.WebsocketClientTransport=void 0;var H_=Ur(),W_=yu(),K_=function(){function r(e){var t;this.url=e.url,this.factory=(t=e.wsCreator)!==null&&t!==void 0?t:function(n){return new WebSocket(n)}}return r.prototype.connect=function(e){var t=this;return new Promise(function(n,s){var o=t.factory(t.url);o.binaryType="arraybuffer";var l=function(){o.removeEventListener("open",l),o.removeEventListener("error",d),n(new W_.WebsocketDuplexConnection(o,new H_.Deserializer,e))},d=function(f){o.removeEventListener("open",l),o.removeEventListener("error",d),s(f.error)};o.addEventListener("open",l),o.addEventListener("error",d)})},r}();Si.WebsocketClientTransport=K_});var wu=ne(fr=>{"use strict";var G_=fr&&fr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),X_=fr&&fr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&G_(e,r,t)};Object.defineProperty(fr,"__esModule",{value:!0});X_(Eu(),fr)});var bu=ne(Ti=>{"use strict";Ti.byteLength=Y_;Ti.toByteArray=em;Ti.fromByteArray=nm;var Tt=[],nt=[],J_=typeof Uint8Array<"u"?Uint8Array:Array,Cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(hr=0,Su=Cs.length;hr<Su;++hr)Tt[hr]=Cs[hr],nt[Cs.charCodeAt(hr)]=hr;var hr,Su;nt[45]=62;nt[95]=63;function Tu(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Y_(r){var e=Tu(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Z_(r,e,t){return(e+t)*3/4-t}function em(r){var e,t=Tu(r),n=t[0],s=t[1],o=new J_(Z_(r,n,s)),l=0,d=s>0?n-4:n,f;for(f=0;f<d;f+=4)e=nt[r.charCodeAt(f)]<<18|nt[r.charCodeAt(f+1)]<<12|nt[r.charCodeAt(f+2)]<<6|nt[r.charCodeAt(f+3)],o[l++]=e>>16&255,o[l++]=e>>8&255,o[l++]=e&255;return s===2&&(e=nt[r.charCodeAt(f)]<<2|nt[r.charCodeAt(f+1)]>>4,o[l++]=e&255),s===1&&(e=nt[r.charCodeAt(f)]<<10|nt[r.charCodeAt(f+1)]<<4|nt[r.charCodeAt(f+2)]>>2,o[l++]=e>>8&255,o[l++]=e&255),o}function tm(r){return Tt[r>>18&63]+Tt[r>>12&63]+Tt[r>>6&63]+Tt[r&63]}function rm(r,e,t){for(var n,s=[],o=e;o<t;o+=3)n=(r[o]<<16&16711680)+(r[o+1]<<8&65280)+(r[o+2]&255),s.push(tm(n));return s.join("")}function nm(r){for(var e,t=r.length,n=t%3,s=[],o=16383,l=0,d=t-n;l<d;l+=o)s.push(rm(r,l,l+o>d?d:l+o));return n===1?(e=r[t-1],s.push(Tt[e>>2]+Tt[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(Tt[e>>10]+Tt[e>>4&63]+Tt[e<<2&63]+"=")),s.join("")}});var Iu=ne(Bs=>{Bs.read=function(r,e,t,n,s){var o,l,d=s*8-n-1,f=(1<<d)-1,u=f>>1,p=-7,_=t?s-1:0,I=t?-1:1,R=r[e+_];for(_+=I,o=R&(1<<-p)-1,R>>=-p,p+=d;p>0;o=o*256+r[e+_],_+=I,p-=8);for(l=o&(1<<-p)-1,o>>=-p,p+=n;p>0;l=l*256+r[e+_],_+=I,p-=8);if(o===0)o=1-u;else{if(o===f)return l?NaN:(R?-1:1)*(1/0);l=l+Math.pow(2,n),o=o-u}return(R?-1:1)*l*Math.pow(2,o-n)};Bs.write=function(r,e,t,n,s,o){var l,d,f,u=o*8-s-1,p=(1<<u)-1,_=p>>1,I=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=n?0:o-1,L=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(d=isNaN(e)?1:0,l=p):(l=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-l))<1&&(l--,f*=2),l+_>=1?e+=I/f:e+=I*Math.pow(2,1-_),e*f>=2&&(l++,f/=2),l+_>=p?(d=0,l=p):l+_>=1?(d=(e*f-1)*Math.pow(2,s),l=l+_):(d=e*Math.pow(2,_-1)*Math.pow(2,s),l=0));s>=8;r[t+R]=d&255,R+=L,d/=256,s-=8);for(l=l<<s|d,u+=s;u>0;r[t+R]=l&255,R+=L,l/=256,u-=8);r[t+R-L]|=g*128}});var zs=ne(Kr=>{"use strict";var qs=bu(),Hr=Iu(),Ru=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Kr.Buffer=B;Kr.SlowBuffer=cm;Kr.INSPECT_MAX_BYTES=50;var bi=2147483647;Kr.kMaxLength=bi;B.TYPED_ARRAY_SUPPORT=im();!B.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function im(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(B.prototype,"parent",{enumerable:!0,get:function(){if(B.isBuffer(this))return this.buffer}});Object.defineProperty(B.prototype,"offset",{enumerable:!0,get:function(){if(B.isBuffer(this))return this.byteOffset}});function At(r){if(r>bi)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,B.prototype),e}function B(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Ps(r)}return xu(r,e,t)}B.poolSize=8192;function xu(r,e,t){if(typeof r=="string")return om(r,e);if(ArrayBuffer.isView(r))return am(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(bt(r,ArrayBuffer)||r&&bt(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(bt(r,SharedArrayBuffer)||r&&bt(r.buffer,SharedArrayBuffer)))return Us(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return B.from(n,e,t);let s=lm(r);if(s)return s;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return B.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}B.from=function(r,e,t){return xu(r,e,t)};Object.setPrototypeOf(B.prototype,Uint8Array.prototype);Object.setPrototypeOf(B,Uint8Array);function Au(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function sm(r,e,t){return Au(r),r<=0?At(r):e!==void 0?typeof t=="string"?At(r).fill(e,t):At(r).fill(e):At(r)}B.alloc=function(r,e,t){return sm(r,e,t)};function Ps(r){return Au(r),At(r<0?0:Ms(r)|0)}B.allocUnsafe=function(r){return Ps(r)};B.allocUnsafeSlow=function(r){return Ps(r)};function om(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!B.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=Nu(r,e)|0,n=At(t),s=n.write(r,e);return s!==t&&(n=n.slice(0,s)),n}function Ds(r){let e=r.length<0?0:Ms(r.length)|0,t=At(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function am(r){if(bt(r,Uint8Array)){let e=new Uint8Array(r);return Us(e.buffer,e.byteOffset,e.byteLength)}return Ds(r)}function Us(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,B.prototype),n}function lm(r){if(B.isBuffer(r)){let e=Ms(r.length)|0,t=At(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||$s(r.length)?At(0):Ds(r);if(r.type==="Buffer"&&Array.isArray(r.data))return Ds(r.data)}function Ms(r){if(r>=bi)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+bi.toString(16)+" bytes");return r|0}function cm(r){return+r!=r&&(r=0),B.alloc(+r)}B.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==B.prototype};B.compare=function(e,t){if(bt(e,Uint8Array)&&(e=B.from(e,e.offset,e.byteLength)),bt(t,Uint8Array)&&(t=B.from(t,t.offset,t.byteLength)),!B.isBuffer(e)||!B.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,s=t.length;for(let o=0,l=Math.min(n,s);o<l;++o)if(e[o]!==t[o]){n=e[o],s=t[o];break}return n<s?-1:s<n?1:0};B.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};B.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return B.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let s=B.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){let l=e[n];if(bt(l,Uint8Array))o+l.length>s.length?(B.isBuffer(l)||(l=B.from(l)),l.copy(s,o)):Uint8Array.prototype.set.call(s,l,o);else if(B.isBuffer(l))l.copy(s,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=l.length}return s};function Nu(r,e){if(B.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||bt(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let s=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return ks(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return Mu(r).length;default:if(s)return n?-1:ks(r).length;e=(""+e).toLowerCase(),s=!0}}B.byteLength=Nu;function um(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return wm(this,e,t);case"utf8":case"utf-8":return Cu(this,e,t);case"ascii":return ym(this,e,t);case"latin1":case"binary":return Em(this,e,t);case"base64":return mm(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Sm(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}B.prototype._isBuffer=!0;function dr(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}B.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)dr(this,t,t+1);return this};B.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)dr(this,t,t+3),dr(this,t+1,t+2);return this};B.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)dr(this,t,t+7),dr(this,t+1,t+6),dr(this,t+2,t+5),dr(this,t+3,t+4);return this};B.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?Cu(this,0,e):um.apply(this,arguments)};B.prototype.toLocaleString=B.prototype.toString;B.prototype.equals=function(e){if(!B.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:B.compare(this,e)===0};B.prototype.inspect=function(){let e="",t=Kr.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};Ru&&(B.prototype[Ru]=B.prototype.inspect);B.prototype.compare=function(e,t,n,s,o){if(bt(e,Uint8Array)&&(e=B.from(e,e.offset,e.byteLength)),!B.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),s===void 0&&(s=0),o===void 0&&(o=this.length),t<0||n>e.length||s<0||o>this.length)throw new RangeError("out of range index");if(s>=o&&t>=n)return 0;if(s>=o)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,s>>>=0,o>>>=0,this===e)return 0;let l=o-s,d=n-t,f=Math.min(l,d),u=this.slice(s,o),p=e.slice(t,n);for(let _=0;_<f;++_)if(u[_]!==p[_]){l=u[_],d=p[_];break}return l<d?-1:d<l?1:0};function Fu(r,e,t,n,s){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,$s(t)&&(t=s?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(s)return-1;t=r.length-1}else if(t<0)if(s)t=0;else return-1;if(typeof e=="string"&&(e=B.from(e,n)),B.isBuffer(e))return e.length===0?-1:vu(r,e,t,n,s);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?s?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):vu(r,[e],t,n,s);throw new TypeError("val must be string, number or Buffer")}function vu(r,e,t,n,s){let o=1,l=r.length,d=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;o=2,l/=2,d/=2,t/=2}function f(p,_){return o===1?p[_]:p.readUInt16BE(_*o)}let u;if(s){let p=-1;for(u=t;u<l;u++)if(f(r,u)===f(e,p===-1?0:u-p)){if(p===-1&&(p=u),u-p+1===d)return p*o}else p!==-1&&(u-=u-p),p=-1}else for(t+d>l&&(t=l-d),u=t;u>=0;u--){let p=!0;for(let _=0;_<d;_++)if(f(r,u+_)!==f(e,_)){p=!1;break}if(p)return u}return-1}B.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};B.prototype.indexOf=function(e,t,n){return Fu(this,e,t,n,!0)};B.prototype.lastIndexOf=function(e,t,n){return Fu(this,e,t,n,!1)};function fm(r,e,t,n){t=Number(t)||0;let s=r.length-t;n?(n=Number(n),n>s&&(n=s)):n=s;let o=e.length;n>o/2&&(n=o/2);let l;for(l=0;l<n;++l){let d=parseInt(e.substr(l*2,2),16);if($s(d))return l;r[t+l]=d}return l}function hm(r,e,t,n){return Ii(ks(e,r.length-t),r,t,n)}function dm(r,e,t,n){return Ii(Rm(e),r,t,n)}function pm(r,e,t,n){return Ii(Mu(e),r,t,n)}function _m(r,e,t,n){return Ii(vm(e,r.length-t),r,t,n)}B.prototype.write=function(e,t,n,s){if(t===void 0)s="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")s=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,s===void 0&&(s="utf8")):(s=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let o=this.length-t;if((n===void 0||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let l=!1;for(;;)switch(s){case"hex":return fm(this,e,t,n);case"utf8":case"utf-8":return hm(this,e,t,n);case"ascii":case"latin1":case"binary":return dm(this,e,t,n);case"base64":return pm(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _m(this,e,t,n);default:if(l)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),l=!0}};B.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function mm(r,e,t){return e===0&&t===r.length?qs.fromByteArray(r):qs.fromByteArray(r.slice(e,t))}function Cu(r,e,t){t=Math.min(r.length,t);let n=[],s=e;for(;s<t;){let o=r[s],l=null,d=o>239?4:o>223?3:o>191?2:1;if(s+d<=t){let f,u,p,_;switch(d){case 1:o<128&&(l=o);break;case 2:f=r[s+1],(f&192)===128&&(_=(o&31)<<6|f&63,_>127&&(l=_));break;case 3:f=r[s+1],u=r[s+2],(f&192)===128&&(u&192)===128&&(_=(o&15)<<12|(f&63)<<6|u&63,_>2047&&(_<55296||_>57343)&&(l=_));break;case 4:f=r[s+1],u=r[s+2],p=r[s+3],(f&192)===128&&(u&192)===128&&(p&192)===128&&(_=(o&15)<<18|(f&63)<<12|(u&63)<<6|p&63,_>65535&&_<1114112&&(l=_))}}l===null?(l=65533,d=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|l&1023),n.push(l),s+=d}return gm(n)}var Lu=4096;function gm(r){let e=r.length;if(e<=Lu)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=Lu));return t}function ym(r,e,t){let n="";t=Math.min(r.length,t);for(let s=e;s<t;++s)n+=String.fromCharCode(r[s]&127);return n}function Em(r,e,t){let n="";t=Math.min(r.length,t);for(let s=e;s<t;++s)n+=String.fromCharCode(r[s]);return n}function wm(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let s="";for(let o=e;o<t;++o)s+=Lm[r[o]];return s}function Sm(r,e,t){let n=r.slice(e,t),s="";for(let o=0;o<n.length-1;o+=2)s+=String.fromCharCode(n[o]+n[o+1]*256);return s}B.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let s=this.subarray(e,t);return Object.setPrototypeOf(s,B.prototype),s};function Oe(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}B.prototype.readUintLE=B.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||Oe(e,t,this.length);let s=this[e],o=1,l=0;for(;++l<t&&(o*=256);)s+=this[e+l]*o;return s};B.prototype.readUintBE=B.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||Oe(e,t,this.length);let s=this[e+--t],o=1;for(;t>0&&(o*=256);)s+=this[e+--t]*o;return s};B.prototype.readUint8=B.prototype.readUInt8=function(e,t){return e=e>>>0,t||Oe(e,1,this.length),this[e]};B.prototype.readUint16LE=B.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||Oe(e,2,this.length),this[e]|this[e+1]<<8};B.prototype.readUint16BE=B.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||Oe(e,2,this.length),this[e]<<8|this[e+1]};B.prototype.readUint32LE=B.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||Oe(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};B.prototype.readUint32BE=B.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||Oe(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};B.prototype.readBigUInt64LE=Xt(function(e){e=e>>>0,Wr(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&bn(e,this.length-8);let s=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,o=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(s)+(BigInt(o)<<BigInt(32))});B.prototype.readBigUInt64BE=Xt(function(e){e=e>>>0,Wr(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&bn(e,this.length-8);let s=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],o=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(s)<<BigInt(32))+BigInt(o)});B.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||Oe(e,t,this.length);let s=this[e],o=1,l=0;for(;++l<t&&(o*=256);)s+=this[e+l]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*t)),s};B.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||Oe(e,t,this.length);let s=t,o=1,l=this[e+--s];for(;s>0&&(o*=256);)l+=this[e+--s]*o;return o*=128,l>=o&&(l-=Math.pow(2,8*t)),l};B.prototype.readInt8=function(e,t){return e=e>>>0,t||Oe(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};B.prototype.readInt16LE=function(e,t){e=e>>>0,t||Oe(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};B.prototype.readInt16BE=function(e,t){e=e>>>0,t||Oe(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};B.prototype.readInt32LE=function(e,t){return e=e>>>0,t||Oe(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};B.prototype.readInt32BE=function(e,t){return e=e>>>0,t||Oe(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};B.prototype.readBigInt64LE=Xt(function(e){e=e>>>0,Wr(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&bn(e,this.length-8);let s=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(s)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});B.prototype.readBigInt64BE=Xt(function(e){e=e>>>0,Wr(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&bn(e,this.length-8);let s=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(s)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});B.prototype.readFloatLE=function(e,t){return e=e>>>0,t||Oe(e,4,this.length),Hr.read(this,e,!0,23,4)};B.prototype.readFloatBE=function(e,t){return e=e>>>0,t||Oe(e,4,this.length),Hr.read(this,e,!1,23,4)};B.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||Oe(e,8,this.length),Hr.read(this,e,!0,52,8)};B.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||Oe(e,8,this.length),Hr.read(this,e,!1,52,8)};function Ke(r,e,t,n,s,o){if(!B.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}B.prototype.writeUintLE=B.prototype.writeUIntLE=function(e,t,n,s){if(e=+e,t=t>>>0,n=n>>>0,!s){let d=Math.pow(2,8*n)-1;Ke(this,e,t,n,d,0)}let o=1,l=0;for(this[t]=e&255;++l<n&&(o*=256);)this[t+l]=e/o&255;return t+n};B.prototype.writeUintBE=B.prototype.writeUIntBE=function(e,t,n,s){if(e=+e,t=t>>>0,n=n>>>0,!s){let d=Math.pow(2,8*n)-1;Ke(this,e,t,n,d,0)}let o=n-1,l=1;for(this[t+o]=e&255;--o>=0&&(l*=256);)this[t+o]=e/l&255;return t+n};B.prototype.writeUint8=B.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,1,255,0),this[t]=e&255,t+1};B.prototype.writeUint16LE=B.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};B.prototype.writeUint16BE=B.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};B.prototype.writeUint32LE=B.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};B.prototype.writeUint32BE=B.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Bu(r,e,t,n,s){Pu(e,n,s,r,t,7);let o=Number(e&BigInt(4294967295));r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o;let l=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=l,l=l>>8,r[t++]=l,l=l>>8,r[t++]=l,l=l>>8,r[t++]=l,t}function qu(r,e,t,n,s){Pu(e,n,s,r,t,7);let o=Number(e&BigInt(4294967295));r[t+7]=o,o=o>>8,r[t+6]=o,o=o>>8,r[t+5]=o,o=o>>8,r[t+4]=o;let l=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=l,l=l>>8,r[t+2]=l,l=l>>8,r[t+1]=l,l=l>>8,r[t]=l,t+8}B.prototype.writeBigUInt64LE=Xt(function(e,t=0){return Bu(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});B.prototype.writeBigUInt64BE=Xt(function(e,t=0){return qu(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});B.prototype.writeIntLE=function(e,t,n,s){if(e=+e,t=t>>>0,!s){let f=Math.pow(2,8*n-1);Ke(this,e,t,n,f-1,-f)}let o=0,l=1,d=0;for(this[t]=e&255;++o<n&&(l*=256);)e<0&&d===0&&this[t+o-1]!==0&&(d=1),this[t+o]=(e/l>>0)-d&255;return t+n};B.prototype.writeIntBE=function(e,t,n,s){if(e=+e,t=t>>>0,!s){let f=Math.pow(2,8*n-1);Ke(this,e,t,n,f-1,-f)}let o=n-1,l=1,d=0;for(this[t+o]=e&255;--o>=0&&(l*=256);)e<0&&d===0&&this[t+o+1]!==0&&(d=1),this[t+o]=(e/l>>0)-d&255;return t+n};B.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};B.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};B.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};B.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};B.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||Ke(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};B.prototype.writeBigInt64LE=Xt(function(e,t=0){return Bu(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});B.prototype.writeBigInt64BE=Xt(function(e,t=0){return qu(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Du(r,e,t,n,s,o){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Uu(r,e,t,n,s){return e=+e,t=t>>>0,s||Du(r,e,t,4,34028234663852886e22,-34028234663852886e22),Hr.write(r,e,t,n,23,4),t+4}B.prototype.writeFloatLE=function(e,t,n){return Uu(this,e,t,!0,n)};B.prototype.writeFloatBE=function(e,t,n){return Uu(this,e,t,!1,n)};function ku(r,e,t,n,s){return e=+e,t=t>>>0,s||Du(r,e,t,8,17976931348623157e292,-17976931348623157e292),Hr.write(r,e,t,n,52,8),t+8}B.prototype.writeDoubleLE=function(e,t,n){return ku(this,e,t,!0,n)};B.prototype.writeDoubleBE=function(e,t,n){return ku(this,e,t,!1,n)};B.prototype.copy=function(e,t,n,s){if(!B.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!s&&s!==0&&(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<n&&(s=n),s===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-n&&(s=e.length-t+n);let o=s-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,s):Uint8Array.prototype.set.call(e,this.subarray(n,s),t),o};B.prototype.fill=function(e,t,n,s){if(typeof e=="string"){if(typeof t=="string"?(s=t,t=0,n=this.length):typeof n=="string"&&(s=n,n=this.length),s!==void 0&&typeof s!="string")throw new TypeError("encoding must be a string");if(typeof s=="string"&&!B.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(e.length===1){let l=e.charCodeAt(0);(s==="utf8"&&l<128||s==="latin1")&&(e=l)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let o;if(typeof e=="number")for(o=t;o<n;++o)this[o]=e;else{let l=B.isBuffer(e)?e:B.from(e,s),d=l.length;if(d===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=l[o%d]}return this};var Vr={};function Qs(r,e,t){Vr[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(s){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:s,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}Qs("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);Qs("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);Qs("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,s=t;return Number.isInteger(t)&&Math.abs(t)>2**32?s=Ou(String(t)):typeof t=="bigint"&&(s=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(s=Ou(s)),s+="n"),n+=` It must be ${e}. Received ${s}`,n},RangeError);function Ou(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function Tm(r,e,t){Wr(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&bn(e,r.length-(t+1))}function Pu(r,e,t,n,s,o){if(r>t||r<e){let l=typeof e=="bigint"?"n":"",d;throw o>3?e===0||e===BigInt(0)?d=`>= 0${l} and < 2${l} ** ${(o+1)*8}${l}`:d=`>= -(2${l} ** ${(o+1)*8-1}${l}) and < 2 ** ${(o+1)*8-1}${l}`:d=`>= ${e}${l} and <= ${t}${l}`,new Vr.ERR_OUT_OF_RANGE("value",d,r)}Tm(n,s,o)}function Wr(r,e){if(typeof r!="number")throw new Vr.ERR_INVALID_ARG_TYPE(e,"number",r)}function bn(r,e,t){throw Math.floor(r)!==r?(Wr(r,t),new Vr.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new Vr.ERR_BUFFER_OUT_OF_BOUNDS:new Vr.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var bm=/[^+/0-9A-Za-z-_]/g;function Im(r){if(r=r.split("=")[0],r=r.trim().replace(bm,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function ks(r,e){e=e||1/0;let t,n=r.length,s=null,o=[];for(let l=0;l<n;++l){if(t=r.charCodeAt(l),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(l+1===n){(e-=3)>-1&&o.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&o.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function Rm(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function vm(r,e){let t,n,s,o=[];for(let l=0;l<r.length&&!((e-=2)<0);++l)t=r.charCodeAt(l),n=t>>8,s=t%256,o.push(s),o.push(n);return o}function Mu(r){return qs.toByteArray(Im(r))}function Ii(r,e,t,n){let s;for(s=0;s<n&&!(s+t>=e.length||s>=r.length);++s)e[s+t]=r[s];return s}function bt(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function $s(r){return r!==r}var Lm=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let s=0;s<16;++s)e[n+s]=r[t]+r[s]}return e}();function Xt(r){return typeof BigInt>"u"?Om:r}function Om(){throw new Error("BigInt not supported")}});var Qf={};as(Qf,{BSON:()=>bg,BSONError:()=>q,BSONOffsetError:()=>st,BSONRegExp:()=>Dt,BSONRuntimeError:()=>tn,BSONSymbol:()=>wr,BSONType:()=>If,BSONValue:()=>qe,BSONVersionError:()=>Ft,Binary:()=>pe,Code:()=>Bt,DBRef:()=>It,Decimal128:()=>gr,Double:()=>Zt,EJSON:()=>Sr,Int32:()=>er,Long:()=>z,MaxKey:()=>yr,MinKey:()=>Er,ObjectId:()=>qt,Timestamp:()=>tr,UUID:()=>Ct,calculateObjectSize:()=>Pf,deserialize:()=>kf,deserializeStream:()=>Mf,onDemand:()=>rn,serialize:()=>Df,serializeWithBufferAndIndex:()=>Uf,setInternalBufferSize:()=>qf});function mo(r){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(r))}function Xr(r){return Object.prototype.toString.call(r)==="[object Uint8Array]"}function Jr(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function go(r){return Object.prototype.toString.call(r)==="[object Map]"}function Yr(r){return Object.prototype.toString.call(r)==="[object Date]"}function Ze(r,e){return JSON.stringify(r,(t,n)=>typeof n=="bigint"?{$numberLong:`${n}`}:go(n)?Object.fromEntries(n):n)}function Dm(r){if(r!=null&&typeof r=="object"&&"stylize"in r&&typeof r.stylize=="function")return r.stylize}function Rf(r,e,t,n){if(n){Vu??=new TextDecoder("utf8",{fatal:!0});try{return Vu.decode(r.subarray(e,t))}catch(s){throw new q("Invalid UTF-8 string in BSON document",{cause:s})}}return Hu??=new TextDecoder("utf8",{fatal:!1}),Hu.decode(r.subarray(e,t))}function vf(r,e,t){if(r.length===0)return"";let n=t-e;if(n===0)return"";if(n>20)return null;if(n===1&&r[e]<128)return String.fromCharCode(r[e]);if(n===2&&r[e]<128&&r[e+1]<128)return String.fromCharCode(r[e])+String.fromCharCode(r[e+1]);if(n===3&&r[e]<128&&r[e+1]<128&&r[e+2]<128)return String.fromCharCode(r[e])+String.fromCharCode(r[e+1])+String.fromCharCode(r[e+2]);let s=[];for(let o=e;o<t;o++){let l=r[o];if(l>127)return null;s.push(l)}return String.fromCharCode(...s)}function Mm(r,e,t){if(e.length===0)return 0;if(e.length>25||r.length-t<e.length)return null;for(let n=0,s=t;n<e.length;n++,s++){let o=e.charCodeAt(n);if(o>127)return null;r[s]=o}return e.length}function Qm(r){return Jt.fromNumberArray(Array.from({length:r},()=>Math.floor(Math.random()*256)))}function zm(){let{navigator:r}=globalThis;return typeof r=="object"&&r.product==="ReactNative"}function jm(r){if(r<0)throw new RangeError(`The argument 'byteLength' is invalid. Received ${r}`);return On.fromNumberArray(Array.from({length:r},()=>Math.floor(Math.random()*256)))}function Lf(r){return r!=null&&typeof r=="object"&&"$id"in r&&r.$id!=null&&"$ref"in r&&typeof r.$ref=="string"&&(!("$db"in r)||"$db"in r&&typeof r.$db=="string")}function Of(r){if(r==="")return r;let e=0,t=r[e]==="-",n=r[e]==="+";(n||t)&&(e+=1);let s=!1;for(;e<r.length&&r[e]==="0";++e)s=!0;return s?`${t?"-":""}${r.length===e?"0":r.slice(e)}`:n?r.slice(1):r}function Gm(r,e){e=e??10;let t="0123456789abcdefghijklmnopqrstuvwxyz".slice(0,e);return new RegExp(`[^-+${t}]`,"i").test(r)?!1:r}function nf(r){return!isNaN(parseInt(r,10))}function og(r){let e=z.fromNumber(1e9),t=z.fromNumber(0);if(!r.parts[0]&&!r.parts[1]&&!r.parts[2]&&!r.parts[3])return{quotient:r,rem:t};for(let n=0;n<=3;n++)t=t.shiftLeft(32),t=t.add(new z(r.parts[n],0)),r.parts[n]=t.div(e).low,t=t.modulo(e);return{quotient:r,rem:t}}function ag(r,e){if(!r&&!e)return{high:z.fromNumber(0),low:z.fromNumber(0)};let t=r.shiftRightUnsigned(32),n=new z(r.getLowBits(),0),s=e.shiftRightUnsigned(32),o=new z(e.getLowBits(),0),l=t.multiply(s),d=t.multiply(o),f=n.multiply(s),u=n.multiply(o);return l=l.add(d.shiftRightUnsigned(32)),d=new z(d.getLowBits(),0).add(f).add(u.shiftRightUnsigned(32)),l=l.add(d.shiftRightUnsigned(32)),u=d.shiftLeft(32).add(new z(u.getLowBits(),0)),{high:l,low:u}}function lg(r,e){let t=r.high>>>0,n=e.high>>>0;if(t<n)return!0;if(t===n){let s=r.low>>>0,o=e.low>>>0;if(s<o)return!0}return!1}function lt(r,e){throw new q(`"${r}" is not a valid Decimal128 string - ${e}`)}function Oi(r,e,t){let n=5;if(Array.isArray(r))for(let s=0;s<r.length;s++)n+=of(s.toString(),r[s],e,!0,t);else{typeof r?.toBSON=="function"&&(r=r.toBSON());for(let s of Object.keys(r))n+=of(s,r[s],e,!1,t)}return n}function of(r,e,t=!1,n=!1,s=!1){switch(typeof e?.toBSON=="function"&&(e=e.toBSON()),typeof e){case"string":return 1+C.utf8ByteLength(r)+1+4+C.utf8ByteLength(e)+1;case"number":return Math.floor(e)===e&&e>=hf&&e<=ff&&e>=An&&e<=xn?(r!=null?C.utf8ByteLength(r)+1:0)+5:(r!=null?C.utf8ByteLength(r)+1:0)+9;case"undefined":return n||!s?(r!=null?C.utf8ByteLength(r)+1:0)+1:0;case"boolean":return(r!=null?C.utf8ByteLength(r)+1:0)+2;case"object":if(e!=null&&typeof e._bsontype=="string"&&e[Symbol.for("@@mdb.bson.version")]!==mr)throw new Ft;if(e==null||e._bsontype==="MinKey"||e._bsontype==="MaxKey")return(r!=null?C.utf8ByteLength(r)+1:0)+1;if(e._bsontype==="ObjectId")return(r!=null?C.utf8ByteLength(r)+1:0)+13;if(e instanceof Date||Yr(e))return(r!=null?C.utf8ByteLength(r)+1:0)+9;if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||mo(e))return(r!=null?C.utf8ByteLength(r)+1:0)+6+e.byteLength;if(e._bsontype==="Long"||e._bsontype==="Double"||e._bsontype==="Timestamp")return(r!=null?C.utf8ByteLength(r)+1:0)+9;if(e._bsontype==="Decimal128")return(r!=null?C.utf8ByteLength(r)+1:0)+17;if(e._bsontype==="Code")return e.scope!=null&&Object.keys(e.scope).length>0?(r!=null?C.utf8ByteLength(r)+1:0)+1+4+4+C.utf8ByteLength(e.code.toString())+1+Oi(e.scope,t,s):(r!=null?C.utf8ByteLength(r)+1:0)+1+4+C.utf8ByteLength(e.code.toString())+1;if(e._bsontype==="Binary"){let o=e;return o.sub_type===pe.SUBTYPE_BYTE_ARRAY?(r!=null?C.utf8ByteLength(r)+1:0)+(o.position+1+4+1+4):(r!=null?C.utf8ByteLength(r)+1:0)+(o.position+1+4+1)}else{if(e._bsontype==="Symbol")return(r!=null?C.utf8ByteLength(r)+1:0)+C.utf8ByteLength(e.value)+4+1+1;if(e._bsontype==="DBRef"){let o=Object.assign({$ref:e.collection,$id:e.oid},e.fields);return e.db!=null&&(o.$db=e.db),(r!=null?C.utf8ByteLength(r)+1:0)+1+Oi(o,t,s)}else return e instanceof RegExp||Jr(e)?(r!=null?C.utf8ByteLength(r)+1:0)+1+C.utf8ByteLength(e.source)+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1:e._bsontype==="BSONRegExp"?(r!=null?C.utf8ByteLength(r)+1:0)+1+C.utf8ByteLength(e.pattern)+1+C.utf8ByteLength(e.options)+1:(r!=null?C.utf8ByteLength(r)+1:0)+Oi(e,t,s)+1}case"function":if(t)return(r!=null?C.utf8ByteLength(r)+1:0)+1+4+C.utf8ByteLength(e.toString())+1}return 0}function ug(r){return r.split("").sort().join("")}function Af(r,e,t){e=e??{};let n=e&&e.index?e.index:0,s=Z.getInt32LE(r,n);if(s<5)throw new q(`bson size must be >= 5, is ${s}`);if(e.allowObjectSmallerThanBufferSize&&r.length<s)throw new q(`buffer length ${r.length} must be >= bson size ${s}`);if(!e.allowObjectSmallerThanBufferSize&&r.length!==s)throw new q(`buffer length ${r.length} must === bson size ${s}`);if(s+n>r.byteLength)throw new q(`(bson size ${s} + options.index ${n} must be <= buffer length ${r.byteLength})`);if(r[n+s-1]!==0)throw new q("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return xi(r,n,e,t)}function xi(r,e,t,n=!1){let s=t.fieldsAsRaw==null?null:t.fieldsAsRaw,o=t.raw==null?!1:t.raw,l=typeof t.bsonRegExp=="boolean"?t.bsonRegExp:!1,d=t.promoteBuffers??!1,f=t.promoteLongs??!0,u=t.promoteValues??!0,p=t.useBigInt64??!1;if(p&&!u)throw new q("Must either request bigint or Long for int64 deserialization");if(p&&!f)throw new q("Must either request bigint or Long for int64 deserialization");let _=t.validation==null?{utf8:!0}:t.validation,I=!0,R,L,g=_.utf8;if(typeof g=="boolean")R=g;else{I=!1;let Q=Object.keys(g).map(function(N){return g[N]});if(Q.length===0)throw new q("UTF-8 validation setting cannot be empty");if(typeof Q[0]!="boolean")throw new q("Invalid UTF-8 validation option, must specify boolean values");if(R=Q[0],!Q.every(N=>N===R))throw new q("Invalid UTF-8 validation option - keys must be all true or all false")}if(!I){L=new Set;for(let Q of Object.keys(g))L.add(Q)}let w=e;if(r.length<5)throw new q("corrupt bson message < 5 bytes long");let y=Z.getInt32LE(r,e);if(e+=4,y<5||y>r.length)throw new q("corrupt bson message");let b=n?[]:{},A=0,v=!1,k=n?!1:null;for(;!v;){let Q=r[e++];if(Q===0)break;let N=e;for(;r[N]!==0&&N<r.length;)N++;if(N>=r.byteLength)throw new q("Bad BSON Document: illegal CString");let K=n?A++:C.toUTF8(r,e,N,!1),G=!0;I||L?.has(K)?G=R:G=!R,k!==!1&&K[0]==="$"&&(k=pg.test(K));let W;if(e=N+1,Q===df){let S=Z.getInt32LE(r,e);if(e+=4,S<=0||S>r.length-e||r[e+S-1]!==0)throw new q("bad string length in bson");W=C.toUTF8(r,e,e+S-1,G),e=e+S}else if(Q===_f){let S=C.allocateUnsafe(12);for(let O=0;O<12;O++)S[O]=r[e+O];W=new qt(S),e=e+12}else if(Q===Ln&&u===!1)W=new er(Z.getInt32LE(r,e)),e+=4;else if(Q===Ln)W=Z.getInt32LE(r,e),e+=4;else if(Q===yo)W=Z.getFloat64LE(r,e),e+=8,u===!1&&(W=new Zt(W));else if(Q===gf){let S=Z.getInt32LE(r,e),O=Z.getInt32LE(r,e+4);e+=8,W=new Date(new z(S,O).toNumber())}else if(Q===mf){if(r[e]!==0&&r[e]!==1)throw new q("illegal boolean type value");W=r[e++]===1}else if(Q===Eo){let S=e,O=Z.getInt32LE(r,e);if(O<=0||O>r.length-e)throw new q("bad embedded document length in bson");if(o)W=r.slice(e,e+O);else{let $=t;I||($={...t,validation:{utf8:G}}),W=xi(r,S,$,!1)}e=e+O}else if(Q===pf){let S=e,O=Z.getInt32LE(r,e),$=t,Y=e+O;if(s&&s[K]&&($={...t,raw:!0}),I||($={...$,validation:{utf8:G}}),W=xi(r,S,$,!0),e=e+O,r[e-1]!==0)throw new q("invalid array terminator byte");if(e!==Y)throw new q("corrupted array bson")}else if(Q===Um)W=void 0;else if(Q===So)W=null;else if(Q===bo)if(p)W=Z.getBigInt64LE(r,e),e+=8;else{let S=Z.getInt32LE(r,e),O=Z.getInt32LE(r,e+4);e+=8;let $=new z(S,O);f&&u===!0?W=$.lessThanOrEqual(hg)&&$.greaterThanOrEqual(dg)?$.toNumber():$:W=$}else if(Q===Sf){let S=C.allocateUnsafe(16);for(let O=0;O<16;O++)S[O]=r[e+O];e=e+16,W=new gr(S)}else if(Q===wo){let S=Z.getInt32LE(r,e);e+=4;let O=S,$=r[e++];if(S<0)throw new q("Negative binary type element size found");if(S>r.byteLength)throw new q("Binary type size larger than document size");if(r.slice!=null){if($===pe.SUBTYPE_BYTE_ARRAY){if(S=Z.getInt32LE(r,e),e+=4,S<0)throw new q("Negative binary type element size found for subtype 0x02");if(S>O-4)throw new q("Binary type with subtype 0x02 contains too long binary size");if(S<O-4)throw new q("Binary type with subtype 0x02 contains too short binary size")}d&&u?W=C.toLocalBufferType(r.slice(e,e+S)):(W=new pe(r.slice(e,e+S),$),$===Ni&&Ct.isValid(W)&&(W=W.toUUID()))}else{if($===pe.SUBTYPE_BYTE_ARRAY){if(S=Z.getInt32LE(r,e),e+=4,S<0)throw new q("Negative binary type element size found for subtype 0x02");if(S>O-4)throw new q("Binary type with subtype 0x02 contains too long binary size");if(S<O-4)throw new q("Binary type with subtype 0x02 contains too short binary size")}if(d&&u)for(W=C.allocateUnsafe(S),N=0;N<S;N++)W[N]=r[e+N];else W=new pe(r.slice(e,e+S),$),$===Ni&&Ct.isValid(W)&&(W=W.toUUID())}e=e+S}else if(Q===Ai&&l===!1){for(N=e;r[N]!==0&&N<r.length;)N++;if(N>=r.length)throw new q("Bad BSON Document: illegal CString");let S=C.toUTF8(r,e,N,!1);for(e=N+1,N=e;r[N]!==0&&N<r.length;)N++;if(N>=r.length)throw new q("Bad BSON Document: illegal CString");let O=C.toUTF8(r,e,N,!1);e=N+1;let $=new Array(O.length);for(N=0;N<O.length;N++)switch(O[N]){case"m":$[N]="m";break;case"s":$[N]="g";break;case"i":$[N]="i";break}W=new RegExp(S,$.join(""))}else if(Q===Ai&&l===!0){for(N=e;r[N]!==0&&N<r.length;)N++;if(N>=r.length)throw new q("Bad BSON Document: illegal CString");let S=C.toUTF8(r,e,N,!1);for(e=N+1,N=e;r[N]!==0&&N<r.length;)N++;if(N>=r.length)throw new q("Bad BSON Document: illegal CString");let O=C.toUTF8(r,e,N,!1);e=N+1,W=new Dt(S,O)}else if(Q===yf){let S=Z.getInt32LE(r,e);if(e+=4,S<=0||S>r.length-e||r[e+S-1]!==0)throw new q("bad string length in bson");let O=C.toUTF8(r,e,e+S-1,G);W=u?O:new wr(O),e=e+S}else if(Q===wf)W=new tr({i:Z.getUint32LE(r,e),t:Z.getUint32LE(r,e+4)}),e+=8;else if(Q===Tf)W=new Er;else if(Q===bf)W=new yr;else if(Q===To){let S=Z.getInt32LE(r,e);if(e+=4,S<=0||S>r.length-e||r[e+S-1]!==0)throw new q("bad string length in bson");let O=C.toUTF8(r,e,e+S-1,G);W=new Bt(O),e=e+S}else if(Q===Ef){let S=Z.getInt32LE(r,e);if(e+=4,S<13)throw new q("code_w_scope total size shorter minimum expected length");let O=Z.getInt32LE(r,e);if(e+=4,O<=0||O>r.length-e||r[e+O-1]!==0)throw new q("bad string length in bson");let $=C.toUTF8(r,e,e+O-1,G);e=e+O;let Y=e,ae=Z.getInt32LE(r,e),ie=xi(r,Y,t,!1);if(e=e+ae,S<8+ae+O)throw new q("code_w_scope total size is too short, truncating scope");if(S>8+ae+O)throw new q("code_w_scope total size is too long, clips outer document");W=new Bt($,ie)}else if(Q===km){let S=Z.getInt32LE(r,e);if(e+=4,S<=0||S>r.length-e||r[e+S-1]!==0)throw new q("bad string length in bson");let O=C.toUTF8(r,e,e+S-1,G);e=e+S;let $=C.allocateUnsafe(12);for(let ae=0;ae<12;ae++)$[ae]=r[e+ae];let Y=new qt($);e=e+12,W=new It(O,Y)}else throw new q(`Detected unknown BSON type ${Q.toString(16)} for fieldname "${K}"`);K==="__proto__"?Object.defineProperty(b,K,{value:W,writable:!0,enumerable:!0,configurable:!0}):b[K]=W}if(y!==e-w)throw n?new q("corrupt array bson"):new q("corrupt object bson");if(!k)return b;if(Lf(b)){let Q=Object.assign({},b);return delete Q.$ref,delete Q.$id,delete Q.$db,new It(b.$ref,b.$id,b.$db,Q)}return b}function Ws(r,e,t,n){r[n++]=df;let s=C.encodeUTF8Into(r,e,n);n=n+s+1,r[n-1]=0;let o=C.encodeUTF8Into(r,t,n+4);return Z.setInt32LE(r,n,o+1),n=n+4+o,r[n++]=0,n}function Ks(r,e,t,n){let o=!Object.is(t,-0)&&Number.isSafeInteger(t)&&t<=xn&&t>=An?Ln:yo;r[n++]=o;let l=C.encodeUTF8Into(r,e,n);return n=n+l,r[n++]=0,o===Ln?n+=Z.setInt32LE(r,n,t):n+=Z.setFloat64LE(r,n,t),n}function Gs(r,e,t,n){r[n++]=bo;let s=C.encodeUTF8Into(r,e,n);return n+=s,r[n++]=0,n+=Z.setBigInt64LE(r,n,t),n}function vn(r,e,t,n){r[n++]=So;let s=C.encodeUTF8Into(r,e,n);return n=n+s,r[n++]=0,n}function Xs(r,e,t,n){r[n++]=mf;let s=C.encodeUTF8Into(r,e,n);return n=n+s,r[n++]=0,r[n++]=t?1:0,n}function Js(r,e,t,n){r[n++]=gf;let s=C.encodeUTF8Into(r,e,n);n=n+s,r[n++]=0;let o=z.fromNumber(t.getTime()),l=o.getLowBits(),d=o.getHighBits();return n+=Z.setInt32LE(r,n,l),n+=Z.setInt32LE(r,n,d),n}function Ys(r,e,t,n){r[n++]=Ai;let s=C.encodeUTF8Into(r,e,n);if(n=n+s,r[n++]=0,t.source&&t.source.match(Fi)!=null)throw new q("value "+t.source+" must not contain null bytes");return n=n+C.encodeUTF8Into(r,t.source,n),r[n++]=0,t.ignoreCase&&(r[n++]=105),t.global&&(r[n++]=115),t.multiline&&(r[n++]=109),r[n++]=0,n}function Zs(r,e,t,n){r[n++]=Ai;let s=C.encodeUTF8Into(r,e,n);if(n=n+s,r[n++]=0,t.pattern.match(Fi)!=null)throw new q("pattern "+t.pattern+" must not contain null bytes");n=n+C.encodeUTF8Into(r,t.pattern,n),r[n++]=0;let o=t.options.split("").sort().join("");return n=n+C.encodeUTF8Into(r,o,n),r[n++]=0,n}function eo(r,e,t,n){t===null?r[n++]=So:t._bsontype==="MinKey"?r[n++]=Tf:r[n++]=bf;let s=C.encodeUTF8Into(r,e,n);return n=n+s,r[n++]=0,n}function to(r,e,t,n){r[n++]=_f;let s=C.encodeUTF8Into(r,e,n);return n=n+s,r[n++]=0,n+=t.serializeInto(r,n),n}function ro(r,e,t,n){r[n++]=wo;let s=C.encodeUTF8Into(r,e,n);n=n+s,r[n++]=0;let o=t.length;if(n+=Z.setInt32LE(r,n,o),r[n++]=Pm,o<=16)for(let l=0;l<o;l++)r[n+l]=t[l];else r.set(t,n);return n=n+o,n}function no(r,e,t,n,s,o,l,d,f){if(f.has(t))throw new q("Cannot convert circular structure to BSON");f.add(t),r[n++]=Array.isArray(t)?pf:Eo;let u=C.encodeUTF8Into(r,e,n);n=n+u,r[n++]=0;let p=Nn(r,t,s,n,o+1,l,d,f);return f.delete(t),p}function io(r,e,t,n){r[n++]=Sf;let s=C.encodeUTF8Into(r,e,n);n=n+s,r[n++]=0;for(let o=0;o<16;o++)r[n+o]=t.bytes[o];return n+16}function so(r,e,t,n){r[n++]=t._bsontype==="Long"?bo:wf;let s=C.encodeUTF8Into(r,e,n);n=n+s,r[n++]=0;let o=t.getLowBits(),l=t.getHighBits();return n+=Z.setInt32LE(r,n,o),n+=Z.setInt32LE(r,n,l),n}function oo(r,e,t,n){t=t.valueOf(),r[n++]=Ln;let s=C.encodeUTF8Into(r,e,n);return n=n+s,r[n++]=0,n+=Z.setInt32LE(r,n,t),n}function ao(r,e,t,n){r[n++]=yo;let s=C.encodeUTF8Into(r,e,n);return n=n+s,r[n++]=0,n+=Z.setFloat64LE(r,n,t.value),n}function lo(r,e,t,n){r[n++]=To;let s=C.encodeUTF8Into(r,e,n);n=n+s,r[n++]=0;let o=t.toString(),l=C.encodeUTF8Into(r,o,n+4)+1;return Z.setInt32LE(r,n,l),n=n+4+l-1,r[n++]=0,n}function co(r,e,t,n,s=!1,o=0,l=!1,d=!0,f){if(t.scope&&typeof t.scope=="object"){r[n++]=Ef;let u=C.encodeUTF8Into(r,e,n);n=n+u,r[n++]=0;let p=n,_=t.code;n=n+4;let I=C.encodeUTF8Into(r,_,n+4)+1;Z.setInt32LE(r,n,I),r[n+4+I-1]=0,n=n+I+4;let R=Nn(r,t.scope,s,n,o+1,l,d,f);n=R-1;let L=R-p;p+=Z.setInt32LE(r,p,L),r[n++]=0}else{r[n++]=To;let u=C.encodeUTF8Into(r,e,n);n=n+u,r[n++]=0;let p=t.code.toString(),_=C.encodeUTF8Into(r,p,n+4)+1;Z.setInt32LE(r,n,_),n=n+4+_-1,r[n++]=0}return n}function uo(r,e,t,n){r[n++]=wo;let s=C.encodeUTF8Into(r,e,n);n=n+s,r[n++]=0;let o=t.buffer,l=t.position;if(t.sub_type===pe.SUBTYPE_BYTE_ARRAY&&(l=l+4),n+=Z.setInt32LE(r,n,l),r[n++]=t.sub_type,t.sub_type===pe.SUBTYPE_BYTE_ARRAY&&(l=l-4,n+=Z.setInt32LE(r,n,l)),l<=16)for(let d=0;d<l;d++)r[n+d]=o[d];else r.set(o,n);return n=n+t.position,n}function fo(r,e,t,n){r[n++]=yf;let s=C.encodeUTF8Into(r,e,n);n=n+s,r[n++]=0;let o=C.encodeUTF8Into(r,t.value,n+4)+1;return Z.setInt32LE(r,n,o),n=n+4+o-1,r[n++]=0,n}function ho(r,e,t,n,s,o,l){r[n++]=Eo;let d=C.encodeUTF8Into(r,e,n);n=n+d,r[n++]=0;let f=n,u={$ref:t.collection||t.namespace,$id:t.oid};t.db!=null&&(u.$db=t.db),u=Object.assign(u,t.fields);let p=Nn(r,u,!1,n,s+1,o,!0,l),_=p-f;return f+=Z.setInt32LE(r,n,_),p}function Nn(r,e,t,n,s,o,l,d){if(d==null){if(e==null)return r[0]=5,r[1]=0,r[2]=0,r[3]=0,r[4]=0,5;if(Array.isArray(e))throw new q("serialize does not support an array as the root input");if(typeof e!="object")throw new q("serialize does not support non-object as the root input");if("_bsontype"in e&&typeof e._bsontype=="string")throw new q("BSON types cannot be serialized as a document");if(Yr(e)||Jr(e)||Xr(e)||mo(e))throw new q("date, regexp, typedarray, and arraybuffer cannot be BSON documents");d=new Set}d.add(e);let f=n+4;if(Array.isArray(e))for(let p=0;p<e.length;p++){let _=`${p}`,I=e[p];if(typeof I?.toBSON=="function"&&(I=I.toBSON()),typeof I=="string")f=Ws(r,_,I,f);else if(typeof I=="number")f=Ks(r,_,I,f);else if(typeof I=="bigint")f=Gs(r,_,I,f);else if(typeof I=="boolean")f=Xs(r,_,I,f);else if(I instanceof Date||Yr(I))f=Js(r,_,I,f);else if(I===void 0)f=vn(r,_,I,f);else if(I===null)f=vn(r,_,I,f);else if(Xr(I))f=ro(r,_,I,f);else if(I instanceof RegExp||Jr(I))f=Ys(r,_,I,f);else if(typeof I=="object"&&I._bsontype==null)f=no(r,_,I,f,t,s,o,l,d);else{if(typeof I=="object"&&I[Symbol.for("@@mdb.bson.version")]!==mr)throw new Ft;if(I._bsontype==="ObjectId")f=to(r,_,I,f);else if(I._bsontype==="Decimal128")f=io(r,_,I,f);else if(I._bsontype==="Long"||I._bsontype==="Timestamp")f=so(r,_,I,f);else if(I._bsontype==="Double")f=ao(r,_,I,f);else if(typeof I=="function"&&o)f=lo(r,_,I,f);else if(I._bsontype==="Code")f=co(r,_,I,f,t,s,o,l,d);else if(I._bsontype==="Binary")f=uo(r,_,I,f);else if(I._bsontype==="BSONSymbol")f=fo(r,_,I,f);else if(I._bsontype==="DBRef")f=ho(r,_,I,f,s,o,d);else if(I._bsontype==="BSONRegExp")f=Zs(r,_,I,f);else if(I._bsontype==="Int32")f=oo(r,_,I,f);else if(I._bsontype==="MinKey"||I._bsontype==="MaxKey")f=eo(r,_,I,f);else if(typeof I._bsontype<"u")throw new q(`Unrecognized or invalid _bsontype: ${String(I._bsontype)}`)}}else if(e instanceof Map||go(e)){let p=e.entries(),_=!1;for(;!_;){let I=p.next();if(_=!!I.done,_)continue;let R=I.value[0],L=I.value[1];typeof L?.toBSON=="function"&&(L=L.toBSON());let g=typeof L;if(typeof R=="string"&&!af.has(R)){if(R.match(Fi)!=null)throw new q("key "+R+" must not contain null bytes");if(t){if(R[0]==="$")throw new q("key "+R+" must not start with '$'");if(R.includes("."))throw new q("key "+R+" must not contain '.'")}}if(g==="string")f=Ws(r,R,L,f);else if(g==="number")f=Ks(r,R,L,f);else if(g==="bigint")f=Gs(r,R,L,f);else if(g==="boolean")f=Xs(r,R,L,f);else if(L instanceof Date||Yr(L))f=Js(r,R,L,f);else if(L===null||L===void 0&&l===!1)f=vn(r,R,L,f);else if(Xr(L))f=ro(r,R,L,f);else if(L instanceof RegExp||Jr(L))f=Ys(r,R,L,f);else if(g==="object"&&L._bsontype==null)f=no(r,R,L,f,t,s,o,l,d);else{if(typeof L=="object"&&L[Symbol.for("@@mdb.bson.version")]!==mr)throw new Ft;if(L._bsontype==="ObjectId")f=to(r,R,L,f);else if(g==="object"&&L._bsontype==="Decimal128")f=io(r,R,L,f);else if(L._bsontype==="Long"||L._bsontype==="Timestamp")f=so(r,R,L,f);else if(L._bsontype==="Double")f=ao(r,R,L,f);else if(L._bsontype==="Code")f=co(r,R,L,f,t,s,o,l,d);else if(typeof L=="function"&&o)f=lo(r,R,L,f);else if(L._bsontype==="Binary")f=uo(r,R,L,f);else if(L._bsontype==="BSONSymbol")f=fo(r,R,L,f);else if(L._bsontype==="DBRef")f=ho(r,R,L,f,s,o,d);else if(L._bsontype==="BSONRegExp")f=Zs(r,R,L,f);else if(L._bsontype==="Int32")f=oo(r,R,L,f);else if(L._bsontype==="MinKey"||L._bsontype==="MaxKey")f=eo(r,R,L,f);else if(typeof L._bsontype<"u")throw new q(`Unrecognized or invalid _bsontype: ${String(L._bsontype)}`)}}}else{if(typeof e?.toBSON=="function"&&(e=e.toBSON(),e!=null&&typeof e!="object"))throw new q("toBSON function did not return an object");for(let p of Object.keys(e)){let _=e[p];typeof _?.toBSON=="function"&&(_=_.toBSON());let I=typeof _;if(typeof p=="string"&&!af.has(p)){if(p.match(Fi)!=null)throw new q("key "+p+" must not contain null bytes");if(t){if(p[0]==="$")throw new q("key "+p+" must not start with '$'");if(p.includes("."))throw new q("key "+p+" must not contain '.'")}}if(I==="string")f=Ws(r,p,_,f);else if(I==="number")f=Ks(r,p,_,f);else if(I==="bigint")f=Gs(r,p,_,f);else if(I==="boolean")f=Xs(r,p,_,f);else if(_ instanceof Date||Yr(_))f=Js(r,p,_,f);else if(_===void 0)l===!1&&(f=vn(r,p,_,f));else if(_===null)f=vn(r,p,_,f);else if(Xr(_))f=ro(r,p,_,f);else if(_ instanceof RegExp||Jr(_))f=Ys(r,p,_,f);else if(I==="object"&&_._bsontype==null)f=no(r,p,_,f,t,s,o,l,d);else{if(typeof _=="object"&&_[Symbol.for("@@mdb.bson.version")]!==mr)throw new Ft;if(_._bsontype==="ObjectId")f=to(r,p,_,f);else if(I==="object"&&_._bsontype==="Decimal128")f=io(r,p,_,f);else if(_._bsontype==="Long"||_._bsontype==="Timestamp")f=so(r,p,_,f);else if(_._bsontype==="Double")f=ao(r,p,_,f);else if(_._bsontype==="Code")f=co(r,p,_,f,t,s,o,l,d);else if(typeof _=="function"&&o)f=lo(r,p,_,f);else if(_._bsontype==="Binary")f=uo(r,p,_,f);else if(_._bsontype==="BSONSymbol")f=fo(r,p,_,f);else if(_._bsontype==="DBRef")f=ho(r,p,_,f,s,o,d);else if(_._bsontype==="BSONRegExp")f=Zs(r,p,_,f);else if(_._bsontype==="Int32")f=oo(r,p,_,f);else if(_._bsontype==="MinKey"||_._bsontype==="MaxKey")f=eo(r,p,_,f);else if(typeof _._bsontype<"u")throw new q(`Unrecognized or invalid _bsontype: ${String(_._bsontype)}`)}}}d.delete(e),r[f++]=0;let u=f-n;return n+=Z.setInt32LE(r,n,u),f}function _g(r){return r!=null&&typeof r=="object"&&"_bsontype"in r&&typeof r._bsontype=="string"}function Nf(r,e={}){if(typeof r=="number"){let n=r<=xn&&r>=An,s=r<=cf&&r>=uf;if(e.relaxed||e.legacy)return r;if(Number.isInteger(r)&&!Object.is(r,-0)){if(n)return new er(r);if(s)return e.useBigInt64?BigInt(r):z.fromNumber(r)}return new Zt(r)}if(r==null||typeof r!="object")return r;if(r.$undefined)return null;let t=Object.keys(r).filter(n=>n.startsWith("$")&&r[n]!=null);for(let n=0;n<t.length;n++){let s=mg[t[n]];if(s)return s.fromExtendedJSON(r,e)}if(r.$date!=null){let n=r.$date,s=new Date;if(e.legacy)if(typeof n=="number")s.setTime(n);else if(typeof n=="string")s.setTime(Date.parse(n));else if(typeof n=="bigint")s.setTime(Number(n));else throw new tn(`Unrecognized type for EJSON date: ${typeof n}`);else if(typeof n=="string")s.setTime(Date.parse(n));else if(z.isLong(n))s.setTime(n.toNumber());else if(typeof n=="number"&&e.relaxed)s.setTime(n);else if(typeof n=="bigint")s.setTime(Number(n));else throw new tn(`Unrecognized type for EJSON date: ${typeof n}`);return s}if(r.$code!=null){let n=Object.assign({},r);return r.$scope&&(n.$scope=Nf(r.$scope)),Bt.fromExtendedJSON(r)}if(Lf(r)||r.$dbPointer){let n=r.$ref?r:r.$dbPointer;if(n instanceof It)return n;let s=Object.keys(n).filter(l=>l.startsWith("$")),o=!0;if(s.forEach(l=>{["$ref","$id","$db"].indexOf(l)===-1&&(o=!1)}),o)return It.fromExtendedJSON(n)}return r}function gg(r,e){return r.map((t,n)=>{e.seenObjects.push({propertyName:`index ${n}`,obj:null});try{return Nt(t,e)}finally{e.seenObjects.pop()}})}function lf(r){let e=r.toISOString();return r.getUTCMilliseconds()!==0?e:e.slice(0,-5)+"Z"}function Nt(r,e){if(r instanceof Map||go(r)){let t=Object.create(null);for(let[n,s]of r){if(typeof n!="string")throw new q("Can only serialize maps with string keys");t[n]=s}return Nt(t,e)}if((typeof r=="object"||typeof r=="function")&&r!==null){let t=e.seenObjects.findIndex(n=>n.obj===r);if(t!==-1){let n=e.seenObjects.map(p=>p.propertyName),s=n.slice(0,t).map(p=>`${p} -> `).join(""),o=n[t],l=" -> "+n.slice(t+1,n.length-1).map(p=>`${p} -> `).join(""),d=n[n.length-1],f=" ".repeat(s.length+o.length/2),u="-".repeat(l.length+(o.length+d.length)/2-1);throw new q(`Converting circular structure to EJSON:
    ${s}${o}${l}${d}
    ${f}\\${u}/`)}e.seenObjects[e.seenObjects.length-1].obj=r}if(Array.isArray(r))return gg(r,e);if(r===void 0)return null;if(r instanceof Date||Yr(r)){let t=r.getTime(),n=t>-1&&t<2534023188e5;return e.legacy?e.relaxed&&n?{$date:r.getTime()}:{$date:lf(r)}:e.relaxed&&n?{$date:lf(r)}:{$date:{$numberLong:r.getTime().toString()}}}if(typeof r=="number"&&(!e.relaxed||!isFinite(r))){if(Number.isInteger(r)&&!Object.is(r,-0)){if(r>=An&&r<=xn)return{$numberInt:r.toString()};if(r>=uf&&r<=cf)return{$numberLong:r.toString()}}return{$numberDouble:Object.is(r,-0)?"-0.0":r.toString()}}if(typeof r=="bigint")return e.relaxed?Number(BigInt.asIntN(64,r)):{$numberLong:BigInt.asIntN(64,r).toString()};if(r instanceof RegExp||Jr(r)){let t=r.flags;if(t===void 0){let s=r.toString().match(/[gimuy]*$/);s&&(t=s[0])}return new Dt(r.source,t).toExtendedJSON(e)}return r!=null&&typeof r=="object"?Eg(r,e):r}function Eg(r,e){if(r==null||typeof r!="object")throw new q("not an object instance");let t=r._bsontype;if(typeof t>"u"){let n={};for(let s of Object.keys(r)){e.seenObjects.push({propertyName:s,obj:null});try{let o=Nt(r[s],e);s==="__proto__"?Object.defineProperty(n,s,{value:o,writable:!0,enumerable:!0,configurable:!0}):n[s]=o}finally{e.seenObjects.pop()}}return n}else{if(r!=null&&typeof r=="object"&&typeof r._bsontype=="string"&&r[Symbol.for("@@mdb.bson.version")]!==mr)throw new Ft;if(_g(r)){let n=r;if(typeof n.toExtendedJSON!="function"){let s=yg[r._bsontype];if(!s)throw new q("Unrecognized or invalid _bsontype: "+r._bsontype);n=s(n)}return t==="Code"&&n.scope?n=new Bt(n.code,Nt(n.scope,e)):t==="DBRef"&&n.oid&&(n=new It(Nt(n.collection,e),Nt(n.oid,e),Nt(n.db,e),Nt(n.fields,e))),n.toExtendedJSON(e)}else throw new q("_bsontype must be a string, but was: "+typeof t)}}function Ff(r,e){let t={useBigInt64:e?.useBigInt64??!1,relaxed:e?.relaxed??!0,legacy:e?.legacy??!1};return JSON.parse(r,(n,s)=>{if(n.indexOf("\0")!==-1)throw new q(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(n)}`);return Nf(s,t)})}function Cf(r,e,t,n){t!=null&&typeof t=="object"&&(n=t,t=0),e!=null&&typeof e=="object"&&!Array.isArray(e)&&(n=e,e=void 0,t=0);let s=Object.assign({relaxed:!0,legacy:!1},n,{seenObjects:[{propertyName:"(root)",obj:null}]}),o=Nt(r,s);return JSON.stringify(o,e,t)}function wg(r,e){return e=e||{},JSON.parse(Cf(r,e))}function Sg(r,e){return e=e||{},Ff(JSON.stringify(r),e)}function po(r,e){try{return Z.getNonnegativeInt32LE(r,e)}catch(t){throw new st("BSON size cannot be negative",e,{cause:t})}}function _o(r,e){let t=e;for(;r[t]!==0;t++);if(t===r.length-1)throw new st("Null terminator not found",e);return t}function Tg(r,e=0){if(e??=0,r.length<5)throw new st(`Input must be at least 5 bytes, got ${r.length} bytes`,e);let t=po(r,e);if(t>r.length-e)throw new st(`Parsed documentSize (${t} bytes) does not match input length (${r.length} bytes)`,e);if(r[e+t-1]!==0)throw new st("BSON documents must end in 0x00",e+t);let n=[],s=e+4;for(;s<=t+e;){let o=r[s];if(s+=1,o===0){if(s-e!==t)throw new st("Invalid 0x00 type byte",s);break}let l=s,d=_o(r,s)-l;s+=d+1;let f;if(o===1||o===18||o===9||o===17)f=8;else if(o===16)f=4;else if(o===7)f=12;else if(o===19)f=16;else if(o===8)f=1;else if(o===10||o===6||o===127||o===255)f=0;else if(o===11)f=_o(r,_o(r,s)+1)+1-s;else if(o===3||o===4||o===15)f=po(r,s);else if(o===2||o===5||o===12||o===13||o===14)f=po(r,s)+4,o===5&&(f+=1),o===12&&(f+=12);else throw new st(`Invalid 0x${o.toString(16).padStart(2,"0")} type byte`,s);if(f>t)throw new st("value reports length larger than document",s);n.push([o,l,d,s,f]),s+=f}return n}function qf(r){Yt.length<r&&(Yt=C.allocate(r))}function Df(r,e={}){let t=typeof e.checkKeys=="boolean"?e.checkKeys:!1,n=typeof e.serializeFunctions=="boolean"?e.serializeFunctions:!1,s=typeof e.ignoreUndefined=="boolean"?e.ignoreUndefined:!0,o=typeof e.minInternalBufferSize=="number"?e.minInternalBufferSize:Bf;Yt.length<o&&(Yt=C.allocate(o));let l=Nn(Yt,r,t,0,0,n,s,null),d=C.allocateUnsafe(l);return d.set(Yt.subarray(0,l),0),d}function Uf(r,e,t={}){let n=typeof t.checkKeys=="boolean"?t.checkKeys:!1,s=typeof t.serializeFunctions=="boolean"?t.serializeFunctions:!1,o=typeof t.ignoreUndefined=="boolean"?t.ignoreUndefined:!0,l=typeof t.index=="number"?t.index:0,d=Nn(Yt,r,n,0,0,s,o,null);return e.set(Yt.subarray(0,d),l),l+d-1}function kf(r,e={}){return Af(C.toLocalBufferType(r),e)}function Pf(r,e={}){e=e||{};let t=typeof e.serializeFunctions=="boolean"?e.serializeFunctions:!1,n=typeof e.ignoreUndefined=="boolean"?e.ignoreUndefined:!0;return Oi(r,t,n)}function Mf(r,e,t,n,s,o){let l=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},o),d=C.toLocalBufferType(r),f=e;for(let u=0;u<t;u++){let p=Z.getInt32LE(d,f);l.index=f,n[s+u]=Af(d,l),f=f+p}return f}var mr,xn,An,cf,uf,ff,hf,yo,df,Eo,pf,wo,Um,_f,mf,gf,So,Ai,km,To,yf,Ef,Ln,wf,bo,Sf,Tf,bf,Pm,Ni,If,q,Ft,tn,st,Vu,Hu,$m,Jt,Vm,Wu,On,Hm,C,qe,pe,Vs,Wm,Km,Ct,Bt,It,it,Ku,Xm,Zr,xf,Gu,Xu,Ju,Jm,Ym,z,Zm,eg,tg,Gr,Rn,Yu,Zu,Hs,ef,tf,rg,ng,rf,ig,sg,gr,Zt,er,yr,Er,en,fe,sf,Z,cg,_r,qt,Dt,wr,fg,tr,hg,dg,pg,Fi,af,mg,yg,Sr,rn,Bf,Yt,bg,$f=ar(async()=>{mr=6,xn=2147483647,An=-2147483648,cf=Math.pow(2,63)-1,uf=-Math.pow(2,63),ff=Math.pow(2,53),hf=-Math.pow(2,53),yo=1,df=2,Eo=3,pf=4,wo=5,Um=6,_f=7,mf=8,gf=9,So=10,Ai=11,km=12,To=13,yf=14,Ef=15,Ln=16,wf=17,bo=18,Sf=19,Tf=255,bf=127,Pm=0,Ni=4,If=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127}),q=class extends Error{get bsonError(){return!0}get name(){return"BSONError"}constructor(e,t){super(e,t)}static isBSONError(e){return e!=null&&typeof e=="object"&&"bsonError"in e&&e.bsonError===!0&&"name"in e&&"message"in e&&"stack"in e}},Ft=class extends q{get name(){return"BSONVersionError"}constructor(){super(`Unsupported BSON version, bson types must be from bson ${mr}.x.x`)}},tn=class extends q{get name(){return"BSONRuntimeError"}constructor(e){super(e)}},st=class extends q{get name(){return"BSONOffsetError"}constructor(e,t,n){super(`${e}. offset: ${t}`,n),this.offset=t}};$m=await(async()=>{try{return(await import("crypto")).randomBytes}catch{return Qm}})(),Jt={toLocalBufferType(r){if(Buffer.isBuffer(r))return r;if(ArrayBuffer.isView(r))return Buffer.from(r.buffer,r.byteOffset,r.byteLength);let e=r?.[Symbol.toStringTag]??Object.prototype.toString.call(r);if(e==="ArrayBuffer"||e==="SharedArrayBuffer"||e==="[object ArrayBuffer]"||e==="[object SharedArrayBuffer]")return Buffer.from(r);throw new q(`Cannot create Buffer from ${String(r)}`)},allocate(r){return Buffer.alloc(r)},allocateUnsafe(r){return Buffer.allocUnsafe(r)},equals(r,e){return Jt.toLocalBufferType(r).equals(e)},fromNumberArray(r){return Buffer.from(r)},fromBase64(r){return Buffer.from(r,"base64")},toBase64(r){return Jt.toLocalBufferType(r).toString("base64")},fromISO88591(r){return Buffer.from(r,"binary")},toISO88591(r){return Jt.toLocalBufferType(r).toString("binary")},fromHex(r){return Buffer.from(r,"hex")},toHex(r){return Jt.toLocalBufferType(r).toString("hex")},toUTF8(r,e,t,n){let s=t-e<=20?vf(r,e,t):null;if(s!=null)return s;let o=Jt.toLocalBufferType(r).toString("utf8",e,t);if(n){for(let l=0;l<o.length;l++)if(o.charCodeAt(l)===65533){Rf(r,e,t,!0);break}}return o},utf8ByteLength(r){return Buffer.byteLength(r,"utf8")},encodeUTF8Into(r,e,t){let n=Mm(r,e,t);return n??Jt.toLocalBufferType(r).write(e,t,void 0,"utf8")},randomBytes:$m};Vm=(()=>{let{crypto:r}=globalThis;if(r!=null&&typeof r.getRandomValues=="function")return e=>r.getRandomValues(On.allocate(e));if(zm()){let{console:e}=globalThis;e?.warn?.("BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return jm})(),Wu=/(\d|[a-f])/i,On={toLocalBufferType(r){let e=r?.[Symbol.toStringTag]??Object.prototype.toString.call(r);if(e==="Uint8Array")return r;if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength));if(e==="ArrayBuffer"||e==="SharedArrayBuffer"||e==="[object ArrayBuffer]"||e==="[object SharedArrayBuffer]")return new Uint8Array(r);throw new q(`Cannot make a Uint8Array from ${String(r)}`)},allocate(r){if(typeof r!="number")throw new TypeError(`The "size" argument must be of type number. Received ${String(r)}`);return new Uint8Array(r)},allocateUnsafe(r){return On.allocate(r)},equals(r,e){if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},fromNumberArray(r){return Uint8Array.from(r)},fromBase64(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))},toBase64(r){return btoa(On.toISO88591(r))},fromISO88591(r){return Uint8Array.from(r,e=>e.charCodeAt(0)&255)},toISO88591(r){return Array.from(Uint16Array.from(r),e=>String.fromCharCode(e)).join("")},fromHex(r){let e=r.length%2===0?r:r.slice(0,r.length-1),t=[];for(let n=0;n<e.length;n+=2){let s=e[n],o=e[n+1];if(!Wu.test(s)||!Wu.test(o))break;let l=Number.parseInt(`${s}${o}`,16);t.push(l)}return Uint8Array.from(t)},toHex(r){return Array.from(r,e=>e.toString(16).padStart(2,"0")).join("")},toUTF8(r,e,t,n){let s=t-e<=20?vf(r,e,t):null;return s??Rf(r,e,t,n)},utf8ByteLength(r){return new TextEncoder().encode(r).byteLength},encodeUTF8Into(r,e,t){let n=new TextEncoder().encode(e);return r.set(n,t),n.byteLength},randomBytes:Vm},Hm=typeof Buffer=="function"&&Buffer.prototype?._isBuffer!==!0,C=Hm?Jt:On,qe=class{get[Symbol.for("@@mdb.bson.version")](){return mr}[Symbol.for("nodejs.util.inspect.custom")](e,t,n){return this.inspect(e,t,n)}},pe=class r extends qe{get _bsontype(){return"Binary"}constructor(e,t){if(super(),e!=null&&typeof e=="string"&&!ArrayBuffer.isView(e)&&!mo(e)&&!Array.isArray(e))throw new q("Binary can only be constructed from Uint8Array or number[]");this.sub_type=t??r.BSON_BINARY_SUBTYPE_DEFAULT,e==null?(this.buffer=C.allocate(r.BUFFER_SIZE),this.position=0):(this.buffer=Array.isArray(e)?C.fromNumberArray(e):C.toLocalBufferType(e),this.position=this.buffer.byteLength)}put(e){if(typeof e=="string"&&e.length!==1)throw new q("only accepts single character String");if(typeof e!="number"&&e.length!==1)throw new q("only accepts single character Uint8Array or Array");let t;if(typeof e=="string"?t=e.charCodeAt(0):typeof e=="number"?t=e:t=e[0],t<0||t>255)throw new q("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.byteLength>this.position)this.buffer[this.position++]=t;else{let n=C.allocate(r.BUFFER_SIZE+this.buffer.length);n.set(this.buffer,0),this.buffer=n,this.buffer[this.position++]=t}}write(e,t){if(t=typeof t=="number"?t:this.position,this.buffer.byteLength<t+e.length){let n=C.allocate(this.buffer.byteLength+e.length);n.set(this.buffer,0),this.buffer=n}if(ArrayBuffer.isView(e))this.buffer.set(C.toLocalBufferType(e),t),this.position=t+e.byteLength>this.position?t+e.length:this.position;else if(typeof e=="string")throw new q("input cannot be string")}read(e,t){return t=t&&t>0?t:this.position,this.buffer.slice(e,e+t)}value(){return this.buffer.length===this.position?this.buffer:this.buffer.subarray(0,this.position)}length(){return this.position}toJSON(){return C.toBase64(this.buffer.subarray(0,this.position))}toString(e){return e==="hex"?C.toHex(this.buffer.subarray(0,this.position)):e==="base64"?C.toBase64(this.buffer.subarray(0,this.position)):e==="utf8"||e==="utf-8"?C.toUTF8(this.buffer,0,this.position,!1):C.toUTF8(this.buffer,0,this.position,!1)}toExtendedJSON(e){e=e||{};let t=C.toBase64(this.buffer),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:n.length===1?"0"+n:n}:{$binary:{base64:t,subType:n.length===1?"0"+n:n}}}toUUID(){if(this.sub_type===r.SUBTYPE_UUID)return new Ct(this.buffer.slice(0,this.position));throw new q(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${r.SUBTYPE_UUID}" is currently supported.`)}static createFromHexString(e,t){return new r(C.fromHex(e),t)}static createFromBase64(e,t){return new r(C.fromBase64(e),t)}static fromExtendedJSON(e,t){t=t||{};let n,s;if("$binary"in e?t.legacy&&typeof e.$binary=="string"&&"$type"in e?(s=e.$type?parseInt(e.$type,16):0,n=C.fromBase64(e.$binary)):typeof e.$binary!="string"&&(s=e.$binary.subType?parseInt(e.$binary.subType,16):0,n=C.fromBase64(e.$binary.base64)):"$uuid"in e&&(s=4,n=Ct.bytesFromString(e.$uuid)),!n)throw new q(`Unexpected Binary Extended JSON format ${JSON.stringify(e)}`);return s===Ni?new Ct(n):new r(n,s)}inspect(e,t,n){n??=Ze;let s=C.toBase64(this.buffer.subarray(0,this.position)),o=n(s,t),l=n(this.sub_type,t);return`Binary.createFromBase64(${o}, ${l})`}};pe.BSON_BINARY_SUBTYPE_DEFAULT=0;pe.BUFFER_SIZE=256;pe.SUBTYPE_DEFAULT=0;pe.SUBTYPE_FUNCTION=1;pe.SUBTYPE_BYTE_ARRAY=2;pe.SUBTYPE_UUID_OLD=3;pe.SUBTYPE_UUID=4;pe.SUBTYPE_MD5=5;pe.SUBTYPE_ENCRYPTED=6;pe.SUBTYPE_COLUMN=7;pe.SUBTYPE_SENSITIVE=8;pe.SUBTYPE_USER_DEFINED=128;Vs=16,Wm=/^[0-9A-F]{32}$/i,Km=/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,Ct=class r extends pe{constructor(e){let t;if(e==null)t=r.generate();else if(e instanceof r)t=C.toLocalBufferType(new Uint8Array(e.buffer));else if(ArrayBuffer.isView(e)&&e.byteLength===Vs)t=C.toLocalBufferType(e);else if(typeof e=="string")t=r.bytesFromString(e);else throw new q("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");super(t,Ni)}get id(){return this.buffer}set id(e){this.buffer=e}toHexString(e=!0){return e?[C.toHex(this.buffer.subarray(0,4)),C.toHex(this.buffer.subarray(4,6)),C.toHex(this.buffer.subarray(6,8)),C.toHex(this.buffer.subarray(8,10)),C.toHex(this.buffer.subarray(10,16))].join("-"):C.toHex(this.buffer)}toString(e){return e==="hex"?C.toHex(this.id):e==="base64"?C.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(e){if(!e)return!1;if(e instanceof r)return C.equals(e.id,this.id);try{return C.equals(new r(e).id,this.id)}catch{return!1}}toBinary(){return new pe(this.id,pe.SUBTYPE_UUID)}static generate(){let e=C.randomBytes(Vs);return e[6]=e[6]&15|64,e[8]=e[8]&63|128,e}static isValid(e){return e?typeof e=="string"?r.isValidUUIDString(e):Xr(e)?e.byteLength===Vs:e._bsontype==="Binary"&&e.sub_type===this.SUBTYPE_UUID&&e.buffer.byteLength===16:!1}static createFromHexString(e){let t=r.bytesFromString(e);return new r(t)}static createFromBase64(e){return new r(C.fromBase64(e))}static bytesFromString(e){if(!r.isValidUUIDString(e))throw new q("UUID string representation must be 32 hex digits or canonical hyphenated representation");return C.fromHex(e.replace(/-/g,""))}static isValidUUIDString(e){return Wm.test(e)||Km.test(e)}inspect(e,t,n){return n??=Ze,`new UUID(${n(this.toHexString(),t)})`}},Bt=class r extends qe{get _bsontype(){return"Code"}constructor(e,t){super(),this.code=e.toString(),this.scope=t??null}toJSON(){return this.scope!=null?{code:this.code,scope:this.scope}:{code:this.code}}toExtendedJSON(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}static fromExtendedJSON(e){return new r(e.$code,e.$scope)}inspect(e,t,n){n??=Ze;let s=n(this.code,t),o=s.includes(`
`);this.scope!=null&&(s+=`,${o?`
`:" "}${n(this.scope,t)}`);let l=o&&this.scope===null;return`new Code(${o?`
`:""}${s}${l?`
`:""})`}};It=class r extends qe{get _bsontype(){return"DBRef"}constructor(e,t,n,s){super();let o=e.split(".");o.length===2&&(n=o.shift(),e=o.shift()),this.collection=e,this.oid=t,this.db=n,this.fields=s||{}}get namespace(){return this.collection}set namespace(e){this.collection=e}toJSON(){let e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(e.$db=this.db),e}toExtendedJSON(e){e=e||{};let t={$ref:this.collection,$id:this.oid};return e.legacy||(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields)),t}static fromExtendedJSON(e){let t=Object.assign({},e);return delete t.$ref,delete t.$id,delete t.$db,new r(e.$ref,e.$id,e.$db,t)}inspect(e,t,n){n??=Ze;let s=[n(this.namespace,t),n(this.oid,t),...this.db?[n(this.db,t)]:[],...Object.keys(this.fields).length>0?[n(this.fields,t)]:[]];return s[1]=n===Ze?`new ObjectId(${s[1]})`:s[1],`new DBRef(${s.join(", ")})`}};try{it=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}Ku=65536,Xm=1<<24,Zr=Ku*Ku,xf=Zr*Zr,Gu=xf/2,Xu={},Ju={},Jm=20,Ym=/^(\+?0|(\+|-)?[1-9][0-9]*)$/,z=class r extends qe{get _bsontype(){return"Long"}get __isLong__(){return!0}constructor(e=0,t,n){super(),typeof e=="bigint"?Object.assign(this,r.fromBigInt(e,!!t)):typeof e=="string"?Object.assign(this,r.fromString(e,!!t)):(this.low=e|0,this.high=t|0,this.unsigned=!!n)}static fromBits(e,t,n){return new r(e,t,n)}static fromInt(e,t){let n,s,o;return t?(e>>>=0,(o=0<=e&&e<256)&&(s=Ju[e],s)?s:(n=r.fromBits(e,(e|0)<0?-1:0,!0),o&&(Ju[e]=n),n)):(e|=0,(o=-128<=e&&e<128)&&(s=Xu[e],s)?s:(n=r.fromBits(e,e<0?-1:0,!1),o&&(Xu[e]=n),n))}static fromNumber(e,t){if(isNaN(e))return t?r.UZERO:r.ZERO;if(t){if(e<0)return r.UZERO;if(e>=xf)return r.MAX_UNSIGNED_VALUE}else{if(e<=-Gu)return r.MIN_VALUE;if(e+1>=Gu)return r.MAX_VALUE}return e<0?r.fromNumber(-e,t).neg():r.fromBits(e%Zr|0,e/Zr|0,t)}static fromBigInt(e,t){return r.fromString(e.toString(),t)}static _fromString(e,t,n){if(e.length===0)throw new q("empty string");if(n<2||36<n)throw new q("radix");let s;if((s=e.indexOf("-"))>0)throw new q("interior hyphen");if(s===0)return r._fromString(e.substring(1),t,n).neg();let o=r.fromNumber(Math.pow(n,8)),l=r.ZERO;for(let d=0;d<e.length;d+=8){let f=Math.min(8,e.length-d),u=parseInt(e.substring(d,d+f),n);if(f<8){let p=r.fromNumber(Math.pow(n,f));l=l.mul(p).add(r.fromNumber(u))}else l=l.mul(o),l=l.add(r.fromNumber(u))}return l.unsigned=t,l}static fromStringStrict(e,t,n){let s=!1;if(typeof t=="number"?(n=t,t=!1):s=!!t,n??=10,e.trim()!==e)throw new q(`Input: '${e}' contains leading and/or trailing whitespace`);if(!Gm(e,n))throw new q(`Input: '${e}' contains invalid characters for radix: ${n}`);let o=Of(e),l=r._fromString(o,s,n);if(l.toString(n).toLowerCase()!==o.toLowerCase())throw new q(`Input: ${e} is not representable as ${l.unsigned?"an unsigned":"a signed"} 64-bit Long ${n!=null?`with radix: ${n}`:""}`);return l}static fromString(e,t,n){let s=!1;return typeof t=="number"?(n=t,t=!1):s=!!t,n??=10,e==="NaN"&&n<24||(e==="Infinity"||e==="+Infinity"||e==="-Infinity")&&n<35?r.ZERO:r._fromString(e,s,n)}static fromBytes(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)}static fromBytesLE(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)}static fromBytesBE(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}static isLong(e){return e!=null&&typeof e=="object"&&"__isLong__"in e&&e.__isLong__===!0}static fromValue(e,t){return typeof e=="number"?r.fromNumber(e,t):typeof e=="string"?r.fromString(e,t):r.fromBits(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}add(e){r.isLong(e)||(e=r.fromValue(e));let t=this.high>>>16,n=this.high&65535,s=this.low>>>16,o=this.low&65535,l=e.high>>>16,d=e.high&65535,f=e.low>>>16,u=e.low&65535,p=0,_=0,I=0,R=0;return R+=o+u,I+=R>>>16,R&=65535,I+=s+f,_+=I>>>16,I&=65535,_+=n+d,p+=_>>>16,_&=65535,p+=t+l,p&=65535,r.fromBits(I<<16|R,p<<16|_,this.unsigned)}and(e){return r.isLong(e)||(e=r.fromValue(e)),r.fromBits(this.low&e.low,this.high&e.high,this.unsigned)}compare(e){if(r.isLong(e)||(e=r.fromValue(e)),this.eq(e))return 0;let t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1}comp(e){return this.compare(e)}divide(e){if(r.isLong(e)||(e=r.fromValue(e)),e.isZero())throw new q("division by zero");if(it){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;let o=(this.unsigned?it.div_u:it.div_s)(this.low,this.high,e.low,e.high);return r.fromBits(o,it.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?r.UZERO:r.ZERO;let t,n,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return r.UZERO;if(e.gt(this.shru(1)))return r.UONE;s=r.UZERO}else{if(this.eq(r.MIN_VALUE))return e.eq(r.ONE)||e.eq(r.NEG_ONE)?r.MIN_VALUE:e.eq(r.MIN_VALUE)?r.ONE:(t=this.shr(1).div(e).shl(1),t.eq(r.ZERO)?e.isNegative()?r.ONE:r.NEG_ONE:(n=this.sub(e.mul(t)),s=t.add(n.div(e)),s));if(e.eq(r.MIN_VALUE))return this.unsigned?r.UZERO:r.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=r.ZERO}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));let o=Math.ceil(Math.log(t)/Math.LN2),l=o<=48?1:Math.pow(2,o-48),d=r.fromNumber(t),f=d.mul(e);for(;f.isNegative()||f.gt(n);)t-=l,d=r.fromNumber(t,this.unsigned),f=d.mul(e);d.isZero()&&(d=r.ONE),s=s.add(d),n=n.sub(f)}return s}div(e){return this.divide(e)}equals(e){return r.isLong(e)||(e=r.fromValue(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low}eq(e){return this.equals(e)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq(r.MIN_VALUE)?64:this.neg().getNumBitsAbs();let e=this.high!==0?this.high:this.low,t;for(t=31;t>0&&!(e&1<<t);t--);return this.high!==0?t+33:t+1}greaterThan(e){return this.comp(e)>0}gt(e){return this.greaterThan(e)}greaterThanOrEqual(e){return this.comp(e)>=0}gte(e){return this.greaterThanOrEqual(e)}ge(e){return this.greaterThanOrEqual(e)}isEven(){return(this.low&1)===0}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return(this.low&1)===1}isPositive(){return this.unsigned||this.high>=0}isZero(){return this.high===0&&this.low===0}lessThan(e){return this.comp(e)<0}lt(e){return this.lessThan(e)}lessThanOrEqual(e){return this.comp(e)<=0}lte(e){return this.lessThanOrEqual(e)}modulo(e){if(r.isLong(e)||(e=r.fromValue(e)),it){let t=(this.unsigned?it.rem_u:it.rem_s)(this.low,this.high,e.low,e.high);return r.fromBits(t,it.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))}mod(e){return this.modulo(e)}rem(e){return this.modulo(e)}multiply(e){if(this.isZero())return r.ZERO;if(r.isLong(e)||(e=r.fromValue(e)),it){let L=it.mul(this.low,this.high,e.low,e.high);return r.fromBits(L,it.get_high(),this.unsigned)}if(e.isZero())return r.ZERO;if(this.eq(r.MIN_VALUE))return e.isOdd()?r.MIN_VALUE:r.ZERO;if(e.eq(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(r.TWO_PWR_24)&&e.lt(r.TWO_PWR_24))return r.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);let t=this.high>>>16,n=this.high&65535,s=this.low>>>16,o=this.low&65535,l=e.high>>>16,d=e.high&65535,f=e.low>>>16,u=e.low&65535,p=0,_=0,I=0,R=0;return R+=o*u,I+=R>>>16,R&=65535,I+=s*u,_+=I>>>16,I&=65535,I+=o*f,_+=I>>>16,I&=65535,_+=n*u,p+=_>>>16,_&=65535,_+=s*f,p+=_>>>16,_&=65535,_+=o*d,p+=_>>>16,_&=65535,p+=t*u+n*f+s*d+o*l,p&=65535,r.fromBits(I<<16|R,p<<16|_,this.unsigned)}mul(e){return this.multiply(e)}negate(){return!this.unsigned&&this.eq(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)}neg(){return this.negate()}not(){return r.fromBits(~this.low,~this.high,this.unsigned)}notEquals(e){return!this.equals(e)}neq(e){return this.notEquals(e)}ne(e){return this.notEquals(e)}or(e){return r.isLong(e)||(e=r.fromValue(e)),r.fromBits(this.low|e.low,this.high|e.high,this.unsigned)}shiftLeft(e){return r.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?r.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):r.fromBits(0,this.low<<e-32,this.unsigned)}shl(e){return this.shiftLeft(e)}shiftRight(e){return r.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?r.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):r.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)}shr(e){return this.shiftRight(e)}shiftRightUnsigned(e){if(r.isLong(e)&&(e=e.toInt()),e&=63,e===0)return this;{let t=this.high;if(e<32){let n=this.low;return r.fromBits(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?r.fromBits(t,0,this.unsigned):r.fromBits(t>>>e-32,0,this.unsigned)}}shr_u(e){return this.shiftRightUnsigned(e)}shru(e){return this.shiftRightUnsigned(e)}subtract(e){return r.isLong(e)||(e=r.fromValue(e)),this.add(e.neg())}sub(e){return this.subtract(e)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*Zr+(this.low>>>0):this.high*Zr+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(e){return e?this.toBytesLE():this.toBytesBE()}toBytesLE(){let e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]}toBytesBE(){let e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]}toSigned(){return this.unsigned?r.fromBits(this.low,this.high,!1):this}toString(e){if(e=e||10,e<2||36<e)throw new q("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(r.MIN_VALUE)){let o=r.fromNumber(e),l=this.div(o),d=l.mul(o).sub(this);return l.toString(e)+d.toInt().toString(e)}else return"-"+this.neg().toString(e);let t=r.fromNumber(Math.pow(e,6),this.unsigned),n=this,s="";for(;;){let o=n.div(t),d=(n.sub(o.mul(t)).toInt()>>>0).toString(e);if(n=o,n.isZero())return d+s;for(;d.length<6;)d="0"+d;s=""+d+s}}toUnsigned(){return this.unsigned?this:r.fromBits(this.low,this.high,!0)}xor(e){return r.isLong(e)||(e=r.fromValue(e)),r.fromBits(this.low^e.low,this.high^e.high,this.unsigned)}eqz(){return this.isZero()}le(e){return this.lessThanOrEqual(e)}toExtendedJSON(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}}static fromExtendedJSON(e,t){let{useBigInt64:n=!1,relaxed:s=!0}={...t};if(e.$numberLong.length>Jm)throw new q("$numberLong string is too long");if(!Ym.test(e.$numberLong))throw new q(`$numberLong string "${e.$numberLong}" is in an invalid format`);if(n){let l=BigInt(e.$numberLong);return BigInt.asIntN(64,l)}let o=r.fromString(e.$numberLong);return s?o.toNumber():o}inspect(e,t,n){n??=Ze;let s=n(this.toString(),t),o=this.unsigned?`, ${n(this.unsigned,t)}`:"";return`new Long(${s}${o})`}};z.TWO_PWR_24=z.fromInt(Xm);z.MAX_UNSIGNED_VALUE=z.fromBits(-1,-1,!0);z.ZERO=z.fromInt(0);z.UZERO=z.fromInt(0,!0);z.ONE=z.fromInt(1);z.UONE=z.fromInt(1,!0);z.NEG_ONE=z.fromInt(-1);z.MAX_VALUE=z.fromBits(-1,2147483647,!1);z.MIN_VALUE=z.fromBits(0,-2147483648,!1);Zm=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,eg=/^(\+|-)?(Infinity|inf)$/i,tg=/^(\+|-)?NaN$/i,Gr=6111,Rn=-6176,Yu=6176,Zu=34,Hs=C.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),ef=C.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),tf=C.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),rg=/^([-+])?(\d+)?$/,ng=31,rf=16383,ig=30,sg=31;gr=class r extends qe{get _bsontype(){return"Decimal128"}constructor(e){if(super(),typeof e=="string")this.bytes=r.fromString(e).bytes;else if(Xr(e)){if(e.byteLength!==16)throw new q("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}else throw new q("Decimal128 must take a Buffer or string")}static fromString(e){return r._fromString(e,{allowRounding:!1})}static fromStringWithRounding(e){return r._fromString(e,{allowRounding:!0})}static _fromString(e,t){let n=!1,s=!1,o=!1,l=!1,d=0,f=0,u=0,p=0,_=0,I=[0],R=0,L=0,g=0,w=0,y=new z(0,0),b=new z(0,0),A=0,v=0;if(e.length>=7e3)throw new q(""+e+" not a valid Decimal128 string");let k=e.match(Zm),Q=e.match(eg),N=e.match(tg);if(!k&&!Q&&!N||e.length===0)throw new q(""+e+" not a valid Decimal128 string");if(k){let S=k[2],O=k[4],$=k[5],Y=k[6];O&&Y===void 0&&lt(e,"missing exponent power"),O&&S===void 0&&lt(e,"missing exponent base"),O===void 0&&($||Y)&&lt(e,"missing e before exponent")}if((e[v]==="+"||e[v]==="-")&&(s=!0,n=e[v++]==="-"),!nf(e[v])&&e[v]!=="."){if(e[v]==="i"||e[v]==="I")return new r(n?ef:tf);if(e[v]==="N")return new r(Hs)}for(;nf(e[v])||e[v]===".";){if(e[v]==="."){o&&lt(e,"contains multiple periods"),o=!0,v=v+1;continue}R<Zu&&(e[v]!=="0"||l)&&(l||(_=f),l=!0,I[L++]=parseInt(e[v],10),R=R+1),l&&(u=u+1),o&&(p=p+1),f=f+1,v=v+1}if(o&&!f)throw new q(""+e+" not a valid Decimal128 string");if(e[v]==="e"||e[v]==="E"){let S=e.substr(++v).match(rg);if(!S||!S[2])return new r(Hs);w=parseInt(S[0],10),v=v+S[0].length}if(e[v])return new r(Hs);if(!R)I[0]=0,u=1,R=1,d=0;else if(g=R-1,d=u,d!==1)for(;e[_+d-1+Number(s)+Number(o)]==="0";)d=d-1;for(w<=p&&p>w+16384?w=Rn:w=w-p;w>Gr;){if(g=g+1,g>=Zu){if(d===0){w=Gr;break}lt(e,"overflow")}w=w-1}if(t.allowRounding){for(;w<Rn||R<u;){if(g===0&&d<R){w=Rn,d=0;break}if(R<u?u=u-1:g=g-1,w<Gr)w=w+1;else{if(I.join("").match(/^0+$/)){w=Gr;break}lt(e,"overflow")}}if(g+1<d){let S=f;o&&(_=_+1,S=S+1),s&&(_=_+1,S=S+1);let O=parseInt(e[_+g+1],10),$=0;if(O>=5&&($=1,O===5)){$=I[g]%2===1?1:0;for(let Y=_+g+2;Y<S;Y++)if(parseInt(e[Y],10)){$=1;break}}if($){let Y=g;for(;Y>=0&&++I[Y]>9;Y--)if(I[Y]=0,Y===0)if(w<Gr)w=w+1,I[Y]=1;else return new r(n?ef:tf)}}}else{for(;w<Rn||R<u;){if(g===0){if(d===0){w=Rn;break}lt(e,"exponent underflow")}R<u?(e[u-1+Number(s)+Number(o)]!=="0"&&d!==0&&lt(e,"inexact rounding"),u=u-1):(I[g]!==0&&lt(e,"inexact rounding"),g=g-1),w<Gr?w=w+1:lt(e,"overflow")}g+1<d&&(o&&(_=_+1),s&&(_=_+1),parseInt(e[_+g+1],10)!==0&&lt(e,"inexact rounding"))}if(y=z.fromNumber(0),b=z.fromNumber(0),d===0)y=z.fromNumber(0),b=z.fromNumber(0);else if(g<17){let S=0;for(b=z.fromNumber(I[S++]),y=new z(0,0);S<=g;S++)b=b.multiply(z.fromNumber(10)),b=b.add(z.fromNumber(I[S]))}else{let S=0;for(y=z.fromNumber(I[S++]);S<=g-17;S++)y=y.multiply(z.fromNumber(10)),y=y.add(z.fromNumber(I[S]));for(b=z.fromNumber(I[S++]);S<=g;S++)b=b.multiply(z.fromNumber(10)),b=b.add(z.fromNumber(I[S]))}let K=ag(y,z.fromString("100000000000000000"));K.low=K.low.add(b),lg(K.low,b)&&(K.high=K.high.add(z.fromNumber(1))),A=w+Yu;let G={low:z.fromNumber(0),high:z.fromNumber(0)};K.high.shiftRightUnsigned(49).and(z.fromNumber(1)).equals(z.fromNumber(1))?(G.high=G.high.or(z.fromNumber(3).shiftLeft(61)),G.high=G.high.or(z.fromNumber(A).and(z.fromNumber(16383).shiftLeft(47))),G.high=G.high.or(K.high.and(z.fromNumber(0x7fffffffffff)))):(G.high=G.high.or(z.fromNumber(A&16383).shiftLeft(49)),G.high=G.high.or(K.high.and(z.fromNumber(562949953421311)))),G.low=K.low,n&&(G.high=G.high.or(z.fromString("9223372036854775808")));let W=C.allocateUnsafe(16);return v=0,W[v++]=G.low.low&255,W[v++]=G.low.low>>8&255,W[v++]=G.low.low>>16&255,W[v++]=G.low.low>>24&255,W[v++]=G.low.high&255,W[v++]=G.low.high>>8&255,W[v++]=G.low.high>>16&255,W[v++]=G.low.high>>24&255,W[v++]=G.high.low&255,W[v++]=G.high.low>>8&255,W[v++]=G.high.low>>16&255,W[v++]=G.high.low>>24&255,W[v++]=G.high.high&255,W[v++]=G.high.high>>8&255,W[v++]=G.high.high>>16&255,W[v++]=G.high.high>>24&255,new r(W)}toString(){let e,t=0,n=new Array(36);for(let v=0;v<n.length;v++)n[v]=0;let s=0,o=!1,l,d={parts:[0,0,0,0]},f,u,p=[];s=0;let _=this.bytes,I=_[s++]|_[s++]<<8|_[s++]<<16|_[s++]<<24,R=_[s++]|_[s++]<<8|_[s++]<<16|_[s++]<<24,L=_[s++]|_[s++]<<8|_[s++]<<16|_[s++]<<24,g=_[s++]|_[s++]<<8|_[s++]<<16|_[s++]<<24;s=0,{low:new z(I,R),high:new z(L,g)}.high.lessThan(z.ZERO)&&p.push("-");let y=g>>26&ng;if(y>>3===3){if(y===ig)return p.join("")+"Infinity";if(y===sg)return"NaN";e=g>>15&rf,l=8+(g>>14&1)}else l=g>>14&7,e=g>>17&rf;let b=e-Yu;if(d.parts[0]=(g&16383)+((l&15)<<14),d.parts[1]=L,d.parts[2]=R,d.parts[3]=I,d.parts[0]===0&&d.parts[1]===0&&d.parts[2]===0&&d.parts[3]===0)o=!0;else for(u=3;u>=0;u--){let v=0,k=og(d);if(d=k.quotient,v=k.rem.low,!!v)for(f=8;f>=0;f--)n[u*9+f]=v%10,v=Math.floor(v/10)}if(o)t=1,n[s]=0;else for(t=36;!n[s];)t=t-1,s=s+1;let A=t-1+b;if(A>=34||A<=-7||b>0){if(t>34)return p.push("0"),b>0?p.push(`E+${b}`):b<0&&p.push(`E${b}`),p.join("");p.push(`${n[s++]}`),t=t-1,t&&p.push(".");for(let v=0;v<t;v++)p.push(`${n[s++]}`);p.push("E"),A>0?p.push(`+${A}`):p.push(`${A}`)}else if(b>=0)for(let v=0;v<t;v++)p.push(`${n[s++]}`);else{let v=t+b;if(v>0)for(let k=0;k<v;k++)p.push(`${n[s++]}`);else p.push("0");for(p.push(".");v++<0;)p.push("0");for(let k=0;k<t-Math.max(v-1,0);k++)p.push(`${n[s++]}`)}return p.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(e){return r.fromString(e.$numberDecimal)}inspect(e,t,n){return n??=Ze,`new Decimal128(${n(this.toString(),t)})`}},Zt=class r extends qe{get _bsontype(){return"Double"}constructor(e){super(),e instanceof Number&&(e=e.valueOf()),this.value=+e}static fromString(e){let t=Number(e);if(e==="NaN")return new r(NaN);if(e==="Infinity")return new r(1/0);if(e==="-Infinity")return new r(-1/0);if(!Number.isFinite(t))throw new q(`Input: ${e} is not representable as a Double`);if(e.trim()!==e)throw new q(`Input: '${e}' contains whitespace`);if(e==="")throw new q("Input is an empty string");if(/[^-0-9.+eE]/.test(e))throw new q(`Input: '${e}' is not in decimal or exponential notation`);return new r(t)}valueOf(){return this.value}toJSON(){return this.value}toString(e){return this.value.toString(e)}toExtendedJSON(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-0.0"}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(e,t){let n=parseFloat(e.$numberDouble);return t&&t.relaxed?n:new r(n)}inspect(e,t,n){return n??=Ze,`new Double(${n(this.value,t)})`}},er=class r extends qe{get _bsontype(){return"Int32"}constructor(e){super(),e instanceof Number&&(e=e.valueOf()),this.value=+e|0}static fromString(e){let t=Of(e),n=Number(e);if(xn<n)throw new q(`Input: '${e}' is larger than the maximum value for Int32`);if(An>n)throw new q(`Input: '${e}' is smaller than the minimum value for Int32`);if(Number.isSafeInteger(n)){if(n.toString()!==t)throw new q(`Input: '${e}' is not a valid Int32 string`)}else throw new q(`Input: '${e}' is not a safe integer`);return new r(n)}valueOf(){return this.value}toString(e){return this.value.toString(e)}toJSON(){return this.value}toExtendedJSON(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}}static fromExtendedJSON(e,t){return t&&t.relaxed?parseInt(e.$numberInt,10):new r(e.$numberInt)}inspect(e,t,n){return n??=Ze,`new Int32(${n(this.value,t)})`}},yr=class r extends qe{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new r}inspect(){return"new MaxKey()"}},Er=class r extends qe{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new r}inspect(){return"new MinKey()"}},en=new Float64Array(1),fe=new Uint8Array(en.buffer,0,8);en[0]=-1;sf=fe[7]===0,Z={getNonnegativeInt32LE(r,e){if(r[e+3]>127)throw new RangeError(`Size cannot be negative at offset: ${e}`);return r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24},getInt32LE(r,e){return r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24},getUint32LE(r,e){return r[e]+r[e+1]*256+r[e+2]*65536+r[e+3]*16777216},getUint32BE(r,e){return r[e+3]+r[e+2]*256+r[e+1]*65536+r[e]*16777216},getBigInt64LE(r,e){let t=Z.getUint32LE(r,e),n=Z.getUint32LE(r,e+4);return(BigInt(n)<<BigInt(32))+BigInt(t)},getFloat64LE:sf?(r,e)=>(fe[7]=r[e],fe[6]=r[e+1],fe[5]=r[e+2],fe[4]=r[e+3],fe[3]=r[e+4],fe[2]=r[e+5],fe[1]=r[e+6],fe[0]=r[e+7],en[0]):(r,e)=>(fe[0]=r[e],fe[1]=r[e+1],fe[2]=r[e+2],fe[3]=r[e+3],fe[4]=r[e+4],fe[5]=r[e+5],fe[6]=r[e+6],fe[7]=r[e+7],en[0]),setInt32BE(r,e,t){return r[e+3]=t,t>>>=8,r[e+2]=t,t>>>=8,r[e+1]=t,t>>>=8,r[e]=t,4},setInt32LE(r,e,t){return r[e]=t,t>>>=8,r[e+1]=t,t>>>=8,r[e+2]=t,t>>>=8,r[e+3]=t,4},setBigInt64LE(r,e,t){let n=BigInt(4294967295),s=Number(t&n);r[e]=s,s>>=8,r[e+1]=s,s>>=8,r[e+2]=s,s>>=8,r[e+3]=s;let o=Number(t>>BigInt(32)&n);return r[e+4]=o,o>>=8,r[e+5]=o,o>>=8,r[e+6]=o,o>>=8,r[e+7]=o,8},setFloat64LE:sf?(r,e,t)=>(en[0]=t,r[e]=fe[7],r[e+1]=fe[6],r[e+2]=fe[5],r[e+3]=fe[4],r[e+4]=fe[3],r[e+5]=fe[2],r[e+6]=fe[1],r[e+7]=fe[0],8):(r,e,t)=>(en[0]=t,r[e]=fe[0],r[e+1]=fe[1],r[e+2]=fe[2],r[e+3]=fe[3],r[e+4]=fe[4],r[e+5]=fe[5],r[e+6]=fe[6],r[e+7]=fe[7],8)},cg=new RegExp("^[0-9a-fA-F]{24}$"),_r=null,qt=class r extends qe{get _bsontype(){return"ObjectId"}constructor(e){super();let t;if(typeof e=="object"&&e&&"id"in e){if(typeof e.id!="string"&&!ArrayBuffer.isView(e.id))throw new q("Argument passed in must have an id that is of type string or Buffer");"toHexString"in e&&typeof e.toHexString=="function"?t=C.fromHex(e.toHexString()):t=e.id}else t=e;if(t==null||typeof t=="number")this.buffer=r.generate(typeof t=="number"?t:void 0);else if(ArrayBuffer.isView(t)&&t.byteLength===12)this.buffer=C.toLocalBufferType(t);else if(typeof t=="string")if(t.length===24&&cg.test(t))this.buffer=C.fromHex(t);else throw new q("input must be a 24 character hex string, 12 byte Uint8Array, or an integer");else throw new q("Argument passed in does not match the accepted types");r.cacheHexString&&(this.__id=C.toHex(this.id))}get id(){return this.buffer}set id(e){this.buffer=e,r.cacheHexString&&(this.__id=C.toHex(e))}toHexString(){if(r.cacheHexString&&this.__id)return this.__id;let e=C.toHex(this.id);return r.cacheHexString&&!this.__id&&(this.__id=e),e}static getInc(){return r.index=(r.index+1)%16777215}static generate(e){typeof e!="number"&&(e=Math.floor(Date.now()/1e3));let t=r.getInc(),n=C.allocateUnsafe(12);return Z.setInt32BE(n,0,e),_r===null&&(_r=C.randomBytes(5)),n[4]=_r[0],n[5]=_r[1],n[6]=_r[2],n[7]=_r[3],n[8]=_r[4],n[11]=t&255,n[10]=t>>8&255,n[9]=t>>16&255,n}toString(e){return e==="base64"?C.toBase64(this.id):e==="hex"?this.toHexString():this.toHexString()}toJSON(){return this.toHexString()}static is(e){return e!=null&&typeof e=="object"&&"_bsontype"in e&&e._bsontype==="ObjectId"}equals(e){if(e==null)return!1;if(r.is(e))return this.buffer[11]===e.buffer[11]&&C.equals(this.buffer,e.buffer);if(typeof e=="string")return e.toLowerCase()===this.toHexString();if(typeof e=="object"&&typeof e.toHexString=="function"){let t=e.toHexString(),n=this.toHexString();return typeof t=="string"&&t.toLowerCase()===n}return!1}getTimestamp(){let e=new Date,t=Z.getUint32BE(this.buffer,0);return e.setTime(Math.floor(t)*1e3),e}static createPk(){return new r}serializeInto(e,t){return e[t]=this.buffer[0],e[t+1]=this.buffer[1],e[t+2]=this.buffer[2],e[t+3]=this.buffer[3],e[t+4]=this.buffer[4],e[t+5]=this.buffer[5],e[t+6]=this.buffer[6],e[t+7]=this.buffer[7],e[t+8]=this.buffer[8],e[t+9]=this.buffer[9],e[t+10]=this.buffer[10],e[t+11]=this.buffer[11],12}static createFromTime(e){let t=C.allocate(12);for(let n=11;n>=4;n--)t[n]=0;return Z.setInt32BE(t,0,e),new r(t)}static createFromHexString(e){if(e?.length!==24)throw new q("hex string must be 24 characters");return new r(C.fromHex(e))}static createFromBase64(e){if(e?.length!==16)throw new q("base64 string must be 16 characters");return new r(C.fromBase64(e))}static isValid(e){if(e==null)return!1;try{return new r(e),!0}catch{return!1}}toExtendedJSON(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}static fromExtendedJSON(e){return new r(e.$oid)}inspect(e,t,n){return n??=Ze,`new ObjectId(${n(this.toHexString(),t)})`}};qt.index=Math.floor(Math.random()*16777215);Dt=class r extends qe{get _bsontype(){return"BSONRegExp"}constructor(e,t){if(super(),this.pattern=e,this.options=ug(t??""),this.pattern.indexOf("\0")!==-1)throw new q(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`);if(this.options.indexOf("\0")!==-1)throw new q(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`);for(let n=0;n<this.options.length;n++)if(!(this.options[n]==="i"||this.options[n]==="m"||this.options[n]==="x"||this.options[n]==="l"||this.options[n]==="s"||this.options[n]==="u"))throw new q(`The regular expression option [${this.options[n]}] is not supported`)}static parseOptions(e){return e?e.split("").sort().join(""):""}toExtendedJSON(e){return e=e||{},e.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(e){if("$regex"in e)if(typeof e.$regex!="string"){if(e.$regex._bsontype==="BSONRegExp")return e}else return new r(e.$regex,r.parseOptions(e.$options));if("$regularExpression"in e)return new r(e.$regularExpression.pattern,r.parseOptions(e.$regularExpression.options));throw new q(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(e)}`)}inspect(e,t,n){let s=Dm(t)??(d=>d);n??=Ze;let o=s(n(this.pattern),"regexp"),l=s(n(this.options),"regexp");return`new BSONRegExp(${o}, ${l})`}},wr=class r extends qe{get _bsontype(){return"BSONSymbol"}constructor(e){super(),this.value=e}valueOf(){return this.value}toString(){return this.value}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(e){return new r(e.$symbol)}inspect(e,t,n){return n??=Ze,`new BSONSymbol(${n(this.value,t)})`}},fg=z,tr=class r extends fg{get _bsontype(){return"Timestamp"}constructor(e){if(e==null)super(0,0,!0);else if(typeof e=="bigint")super(e,!0);else if(z.isLong(e))super(e.low,e.high,!0);else if(typeof e=="object"&&"t"in e&&"i"in e){if(typeof e.t!="number"&&(typeof e.t!="object"||e.t._bsontype!=="Int32"))throw new q("Timestamp constructed from { t, i } must provide t as a number");if(typeof e.i!="number"&&(typeof e.i!="object"||e.i._bsontype!=="Int32"))throw new q("Timestamp constructed from { t, i } must provide i as a number");let t=Number(e.t),n=Number(e.i);if(t<0||Number.isNaN(t))throw new q("Timestamp constructed from { t, i } must provide a positive t");if(n<0||Number.isNaN(n))throw new q("Timestamp constructed from { t, i } must provide a positive i");if(t>4294967295)throw new q("Timestamp constructed from { t, i } must provide t equal or less than uint32 max");if(n>4294967295)throw new q("Timestamp constructed from { t, i } must provide i equal or less than uint32 max");super(n,t,!0)}else throw new q("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }")}toJSON(){return{$timestamp:this.toString()}}static fromInt(e){return new r(z.fromInt(e,!0))}static fromNumber(e){return new r(z.fromNumber(e,!0))}static fromBits(e,t){return new r({i:e,t})}static fromString(e,t){return new r(z.fromString(e,!0,t))}toExtendedJSON(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}static fromExtendedJSON(e){let t=z.isLong(e.$timestamp.i)?e.$timestamp.i.getLowBitsUnsigned():e.$timestamp.i,n=z.isLong(e.$timestamp.t)?e.$timestamp.t.getLowBitsUnsigned():e.$timestamp.t;return new r({t:n,i:t})}inspect(e,t,n){n??=Ze;let s=n(this.high>>>0,t),o=n(this.low>>>0,t);return`new Timestamp({ t: ${s}, i: ${o} })`}};tr.MAX_VALUE=z.MAX_UNSIGNED_VALUE;hg=z.fromNumber(ff),dg=z.fromNumber(hf);pg=/^\$ref$|^\$id$|^\$db$/;Fi=/\x00/,af=new Set(["$db","$ref","$id","$clusterTime"]);mg={$oid:qt,$binary:pe,$uuid:pe,$symbol:wr,$numberInt:er,$numberDecimal:gr,$numberDouble:Zt,$numberLong:z,$minKey:Er,$maxKey:yr,$regex:Dt,$regularExpression:Dt,$timestamp:tr};yg={Binary:r=>new pe(r.value(),r.sub_type),Code:r=>new Bt(r.code,r.scope),DBRef:r=>new It(r.collection||r.namespace,r.oid,r.db,r.fields),Decimal128:r=>new gr(r.bytes),Double:r=>new Zt(r.value),Int32:r=>new er(r.value),Long:r=>z.fromBits(r.low!=null?r.low:r.low_,r.low!=null?r.high:r.high_,r.low!=null?r.unsigned:r.unsigned_),MaxKey:()=>new yr,MinKey:()=>new Er,ObjectId:r=>new qt(r),BSONRegExp:r=>new Dt(r.pattern,r.options),BSONSymbol:r=>new wr(r.value),Timestamp:r=>tr.fromBits(r.low,r.high)};Sr=Object.create(null);Sr.parse=Ff;Sr.stringify=Cf;Sr.serialize=wg;Sr.deserialize=Sg;Object.freeze(Sr);rn=Object.create(null);rn.parseToElements=Tg;rn.ByteUtils=C;rn.NumberUtils=Z;Object.freeze(rn);Bf=1024*1024*17,Yt=C.allocate(Bf);bg=Object.freeze({__proto__:null,BSONError:q,BSONOffsetError:st,BSONRegExp:Dt,BSONRuntimeError:tn,BSONSymbol:wr,BSONType:If,BSONValue:qe,BSONVersionError:Ft,Binary:pe,Code:Bt,DBRef:It,Decimal128:gr,Double:Zt,EJSON:Sr,Int32:er,Long:z,MaxKey:yr,MinKey:Er,ObjectId:qt,Timestamp:tr,UUID:Ct,calculateObjectSize:Pf,deserialize:kf,deserializeStream:Mf,onDemand:rn,serialize:Df,serializeWithBufferAndIndex:Uf,setInternalBufferSize:qf})});var Fn=ar(()=>{});var Zf={};as(Zf,{default:()=>xg});var Og,xg,eh=ar(()=>{Og=(()=>{var r=import.meta.url;return function(e={}){var t=e,n,s,o=new Promise((i,a)=>{n=i,s=a}),l=Object.assign({},t),d="./this.program",f=(i,a)=>{throw a},u=typeof window=="object",p=typeof importScripts=="function",_="",I;(u||p)&&(p?_=self.location.href:typeof document<"u"&&document.currentScript&&(_=document.currentScript.src),r&&(_=r),_.startsWith("blob:")?_="":_=_.substr(0,_.replace(/[?#].*/,"").lastIndexOf("/")+1),p&&(I=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}));var R=t.print||console.log.bind(console),L=t.printErr||console.error.bind(console);Object.assign(t,l),l=null,t.thisProgram&&(d=t.thisProgram),t.quit&&(f=t.quit);var g;t.wasmBinary&&(g=t.wasmBinary);var w,y=!1,b,A,v,k,Q,N,K,G,W;function S(){var i=w.buffer;t.HEAP8=A=new Int8Array(i),t.HEAP16=k=new Int16Array(i),t.HEAPU8=v=new Uint8Array(i),t.HEAPU16=Q=new Uint16Array(i),t.HEAP32=N=new Int32Array(i),t.HEAPU32=K=new Uint32Array(i),t.HEAPF32=G=new Float32Array(i),t.HEAPF64=W=new Float64Array(i)}var O=[],$=[],Y=[],ae=[];function ie(){var i=t.preRun.shift();O.unshift(i)}var Ce=0,ft=null,Se=null;function Te(i){throw t.onAbort?.(i),i="Aborted("+i+")",L(i),y=!0,b=1,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),s(i),i}var br=i=>i.startsWith("data:application/octet-stream;base64,"),ht;if(t.locateFile){if(ht="wa-sqlite-async.wasm",!br(ht)){var Ir=ht;ht=t.locateFile?t.locateFile(Ir,_):_+Ir}}else ht=new URL("wa-sqlite-async.wasm",import.meta.url).href;function Do(i){if(i==ht&&g)return new Uint8Array(g);if(I)return I(i);throw"both async and sync fetching of the wasm failed"}function mh(i){return g||!u&&!p||typeof fetch!="function"?Promise.resolve().then(()=>Do(i)):fetch(i,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw`failed to load wasm binary file at '${i}'`;return a.arrayBuffer()}).catch(()=>Do(i))}function Uo(i,a,c){return mh(i).then(h=>WebAssembly.instantiate(h,a)).then(c,h=>{L(`failed to asynchronously prepare wasm: ${h}`),Te(h)})}function gh(i,a){var c=ht;return g||typeof WebAssembly.instantiateStreaming!="function"||br(c)||typeof fetch!="function"?Uo(c,i,a):fetch(c,{credentials:"same-origin"}).then(h=>WebAssembly.instantiateStreaming(h,i).then(a,function(m){return L(`wasm streaming compile failed: ${m}`),L("falling back to ArrayBuffer instantiation"),Uo(c,i,a)}))}var re,ge;function ko(i){this.name="ExitStatus",this.message=`Program terminated with exit(${i})`,this.status=i}var Cn=i=>{for(;0<i.length;)i.shift()(t)};function Re(i,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":return A[i];case"i8":return A[i];case"i16":return k[i>>1];case"i32":return N[i>>2];case"i64":Te("to do getValue(i64) use WASM_BIGINT");case"float":return G[i>>2];case"double":return W[i>>3];case"*":return K[i>>2];default:Te(`invalid type for getValue: ${a}`)}}var Po=t.noExitRuntime||!0;function dt(i,a,c="i8"){switch(c.endsWith("*")&&(c="*"),c){case"i1":A[i]=a;break;case"i8":A[i]=a;break;case"i16":k[i>>1]=a;break;case"i32":N[i>>2]=a;break;case"i64":Te("to do setValue(i64) use WASM_BIGINT");case"float":G[i>>2]=a;break;case"double":W[i>>3]=a;break;case"*":K[i>>2]=a;break;default:Te(`invalid type for setValue: ${c}`)}}var Mo=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,he=(i,a,c)=>{var h=a+c;for(c=a;i[c]&&!(c>=h);)++c;if(16<c-a&&i.buffer&&Mo)return Mo.decode(i.subarray(a,c));for(h="";a<c;){var m=i[a++];if(m&128){var T=i[a++]&63;if((m&224)==192)h+=String.fromCharCode((m&31)<<6|T);else{var x=i[a++]&63;m=(m&240)==224?(m&15)<<12|T<<6|x:(m&7)<<18|T<<12|x<<6|i[a++]&63,65536>m?h+=String.fromCharCode(m):(m-=65536,h+=String.fromCharCode(55296|m>>10,56320|m&1023))}}else h+=String.fromCharCode(m)}return h},Qo=(i,a)=>{for(var c=0,h=i.length-1;0<=h;h--){var m=i[h];m==="."?i.splice(h,1):m===".."?(i.splice(h,1),c++):c&&(i.splice(h,1),c--)}if(a)for(;c;c--)i.unshift("..");return i},Rr=i=>{var a=i.charAt(0)==="/",c=i.substr(-1)==="/";return(i=Qo(i.split("/").filter(h=>!!h),!a).join("/"))||a||(i="."),i&&c&&(i+="/"),(a?"/":"")+i},yh=i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=a[0],a=a[1],!i&&!a?".":(a&&=a.substr(0,a.length-1),i+a)},Bn=i=>{if(i==="/")return"/";i=Rr(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},Eh=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);Te("initRandomDevice")},ji=i=>(ji=Eh())(i),qn=(...i)=>{for(var a="",c=!1,h=i.length-1;-1<=h&&!c;h--){if(c=0<=h?i[h]:"/",typeof c!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!c)return"";a=c+"/"+a,c=c.charAt(0)==="/"}return a=Qo(a.split("/").filter(m=>!!m),!c).join("/"),(c?"/":"")+a||"."},Vi=[],vr=i=>{for(var a=0,c=0;c<i.length;++c){var h=i.charCodeAt(c);127>=h?a++:2047>=h?a+=2:55296<=h&&57343>=h?(a+=4,++c):a+=3}return a},pt=(i,a,c,h)=>{if(!(0<h))return 0;var m=c;h=c+h-1;for(var T=0;T<i.length;++T){var x=i.charCodeAt(T);if(55296<=x&&57343>=x){var U=i.charCodeAt(++T);x=65536+((x&1023)<<10)|U&1023}if(127>=x){if(c>=h)break;a[c++]=x}else{if(2047>=x){if(c+1>=h)break;a[c++]=192|x>>6}else{if(65535>=x){if(c+2>=h)break;a[c++]=224|x>>12}else{if(c+3>=h)break;a[c++]=240|x>>18,a[c++]=128|x>>12&63}a[c++]=128|x>>6&63}a[c++]=128|x&63}}return a[c]=0,c-m};function $o(i,a,c){return c=Array(0<c?c:vr(i)+1),i=pt(i,c,0,c.length),a&&(c.length=i),c}var zo=[];function jo(i,a){zo[i]={input:[],Gf:[],Rf:a},Xi(i,wh)}var wh={open(i){var a=zo[i.node.Uf];if(!a)throw new j(43);i.Hf=a,i.seekable=!1},close(i){i.Hf.Rf.Xf(i.Hf)},Xf(i){i.Hf.Rf.Xf(i.Hf)},read(i,a,c,h){if(!i.Hf||!i.Hf.Rf.lg)throw new j(60);for(var m=0,T=0;T<h;T++){try{var x=i.Hf.Rf.lg(i.Hf)}catch{throw new j(29)}if(x===void 0&&m===0)throw new j(6);if(x==null)break;m++,a[c+T]=x}return m&&(i.node.timestamp=Date.now()),m},write(i,a,c,h){if(!i.Hf||!i.Hf.Rf.fg)throw new j(60);try{for(var m=0;m<h;m++)i.Hf.Rf.fg(i.Hf,a[c+m])}catch{throw new j(29)}return h&&(i.node.timestamp=Date.now()),m}},Sh={lg(){e:{if(!Vi.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break e}Vi=$o(i,!0)}i=Vi.shift()}return i},fg(i,a){a===null||a===10?(R(he(i.Gf,0)),i.Gf=[]):a!=0&&i.Gf.push(a)},Xf(i){i.Gf&&0<i.Gf.length&&(R(he(i.Gf,0)),i.Gf=[])},Mg(){return{Hg:25856,Jg:5,Gg:191,Ig:35387,Fg:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ng(){return 0},Og(){return[24,80]}},Th={fg(i,a){a===null||a===10?(L(he(i.Gf,0)),i.Gf=[]):a!=0&&i.Gf.push(a)},Xf(i){i.Gf&&0<i.Gf.length&&(L(he(i.Gf,0)),i.Gf=[])}};function Vo(i,a){var c=i.Cf?i.Cf.length:0;c>=a||(a=Math.max(a,c*(1048576>c?2:1.125)>>>0),c!=0&&(a=Math.max(a,256)),c=i.Cf,i.Cf=new Uint8Array(a),0<i.Ef&&i.Cf.set(c.subarray(0,i.Ef),0))}var ce={Kf:null,Jf(){return ce.createNode(null,"/",16895,0)},createNode(i,a,c,h){if((c&61440)===24576||(c&61440)===4096)throw new j(63);return ce.Kf||(ce.Kf={dir:{node:{If:ce.Af.If,Ff:ce.Af.Ff,Sf:ce.Af.Sf,Yf:ce.Af.Yf,pg:ce.Af.pg,cg:ce.Af.cg,ag:ce.Af.ag,og:ce.Af.og,bg:ce.Af.bg},stream:{Of:ce.Bf.Of}},file:{node:{If:ce.Af.If,Ff:ce.Af.Ff},stream:{Of:ce.Bf.Of,read:ce.Bf.read,write:ce.Bf.write,ig:ce.Bf.ig,Zf:ce.Bf.Zf,$f:ce.Bf.$f}},link:{node:{If:ce.Af.If,Ff:ce.Af.Ff,Vf:ce.Af.Vf},stream:{}},jg:{node:{If:ce.Af.If,Ff:ce.Af.Ff},stream:Oh}}),c=Go(i,a,c,h),Ge(c.mode)?(c.Af=ce.Kf.dir.node,c.Bf=ce.Kf.dir.stream,c.Cf={}):(c.mode&61440)===32768?(c.Af=ce.Kf.file.node,c.Bf=ce.Kf.file.stream,c.Ef=0,c.Cf=null):(c.mode&61440)===40960?(c.Af=ce.Kf.link.node,c.Bf=ce.Kf.link.stream):(c.mode&61440)===8192&&(c.Af=ce.Kf.jg.node,c.Bf=ce.Kf.jg.stream),c.timestamp=Date.now(),i&&(i.Cf[a]=c,i.timestamp=c.timestamp),c},Lg(i){return i.Cf?i.Cf.subarray?i.Cf.subarray(0,i.Ef):new Uint8Array(i.Cf):new Uint8Array(0)},Af:{If(i){var a={};return a.vg=(i.mode&61440)===8192?i.id:1,a.mg=i.id,a.mode=i.mode,a.Bg=1,a.uid=0,a.yg=0,a.Uf=i.Uf,Ge(i.mode)?a.size=4096:(i.mode&61440)===32768?a.size=i.Ef:(i.mode&61440)===40960?a.size=i.link.length:a.size=0,a.rg=new Date(i.timestamp),a.Ag=new Date(i.timestamp),a.ug=new Date(i.timestamp),a.sg=4096,a.tg=Math.ceil(a.size/a.sg),a},Ff(i,a){if(a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,i.Ef!=a))if(a==0)i.Cf=null,i.Ef=0;else{var c=i.Cf;i.Cf=new Uint8Array(a),c&&i.Cf.set(c.subarray(0,Math.min(a,i.Ef))),i.Ef=a}},Sf(){throw Wi[44]},Yf(i,a,c,h){return ce.createNode(i,a,c,h)},pg(i,a,c){if(Ge(i.mode)){try{var h=ir(a,c)}catch{}if(h)for(var m in h.Cf)throw new j(55)}delete i.parent.Cf[i.name],i.parent.timestamp=Date.now(),i.name=c,a.Cf[c]=i,a.timestamp=i.parent.timestamp,i.parent=a},cg(i,a){delete i.Cf[a],i.timestamp=Date.now()},ag(i,a){var c=ir(i,a),h;for(h in c.Cf)throw new j(55);delete i.Cf[a],i.timestamp=Date.now()},og(i){var a=[".",".."],c;for(c of Object.keys(i.Cf))a.push(c);return a},bg(i,a,c){return i=ce.createNode(i,a,41471,0),i.link=c,i},Vf(i){if((i.mode&61440)!==40960)throw new j(28);return i.link}},Bf:{read(i,a,c,h,m){var T=i.node.Cf;if(m>=i.node.Ef)return 0;if(i=Math.min(i.node.Ef-m,h),8<i&&T.subarray)a.set(T.subarray(m,m+i),c);else for(h=0;h<i;h++)a[c+h]=T[m+h];return i},write(i,a,c,h,m,T){if(a.buffer===A.buffer&&(T=!1),!h)return 0;if(i=i.node,i.timestamp=Date.now(),a.subarray&&(!i.Cf||i.Cf.subarray)){if(T)return i.Cf=a.subarray(c,c+h),i.Ef=h;if(i.Ef===0&&m===0)return i.Cf=a.slice(c,c+h),i.Ef=h;if(m+h<=i.Ef)return i.Cf.set(a.subarray(c,c+h),m),h}if(Vo(i,m+h),i.Cf.subarray&&a.subarray)i.Cf.set(a.subarray(c,c+h),m);else for(T=0;T<h;T++)i.Cf[m+T]=a[c+T];return i.Ef=Math.max(i.Ef,m+h),h},Of(i,a,c){if(c===1?a+=i.position:c===2&&(i.node.mode&61440)===32768&&(a+=i.node.Ef),0>a)throw new j(28);return a},ig(i,a,c){Vo(i.node,a+c),i.node.Ef=Math.max(i.node.Ef,a+c)},Zf(i,a,c,h,m){if((i.node.mode&61440)!==32768)throw new j(43);if(i=i.node.Cf,m&2||i.buffer!==A.buffer){if((0<c||c+a<i.length)&&(i.subarray?i=i.subarray(c,c+a):i=Array.prototype.slice.call(i,c,c+a)),c=!0,a=65536*Math.ceil(a/65536),(m=ol(65536,a))?(v.fill(0,m,m+a),a=m):a=0,!a)throw new j(48);A.set(i,a)}else c=!1,a=i.byteOffset;return{Cg:a,qg:c}},$f(i,a,c,h){return ce.Bf.write(i,a,0,h,c,!1),0}}},bh=(i,a)=>{var c=0;return i&&(c|=365),a&&(c|=146),c},Hi=null,Ho={},an=[],Ih=1,kt=null,Wo=!0,j=class{constructor(i){this.name="ErrnoError",this.Df=i}},Wi={},Rh=class{constructor(){this.Wf={},this.node=null}get flags(){return this.Wf.flags}set flags(i){this.Wf.flags=i}get position(){return this.Wf.position}set position(i){this.Wf.position=i}},vh=class{constructor(i,a,c,h){i||=this,this.parent=i,this.Jf=i.Jf,this.Pf=null,this.id=Ih++,this.name=a,this.mode=c,this.Af={},this.Bf={},this.Uf=h}get read(){return(this.mode&365)===365}set read(i){i?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(i){i?this.mode|=146:this.mode&=-147}};function Pe(i,a={}){if(i=qn(i),!i)return{path:"",node:null};if(a=Object.assign({kg:!0,gg:0},a),8<a.gg)throw new j(32);i=i.split("/").filter(x=>!!x);for(var c=Hi,h="/",m=0;m<i.length;m++){var T=m===i.length-1;if(T&&a.parent)break;if(c=ir(c,i[m]),h=Rr(h+"/"+i[m]),c.Pf&&(!T||T&&a.kg)&&(c=c.Pf.root),!T||a.Nf){for(T=0;(c.mode&61440)===40960;)if(c=ra(h),h=qn(yh(h),c),c=Pe(h,{gg:a.gg+1}).node,40<T++)throw new j(32)}}return{path:h,node:c}}function Ki(i){for(var a;;){if(i===i.parent)return i=i.Jf.ng,a?i[i.length-1]!=="/"?`${i}/${a}`:i+a:i;a=a?`${i.name}/${a}`:i.name,i=i.parent}}function Gi(i,a){for(var c=0,h=0;h<a.length;h++)c=(c<<5)-c+a.charCodeAt(h)|0;return(i+c>>>0)%kt.length}function Ko(i){var a=Gi(i.parent.id,i.name);if(kt[a]===i)kt[a]=i.Qf;else for(a=kt[a];a;){if(a.Qf===i){a.Qf=i.Qf;break}a=a.Qf}}function ir(i,a){var c=Ge(i.mode)?(c=Lr(i,"x"))?c:i.Af.Sf?0:2:54;if(c)throw new j(c);for(c=kt[Gi(i.id,a)];c;c=c.Qf){var h=c.name;if(c.parent.id===i.id&&h===a)return c}return i.Af.Sf(i,a)}function Go(i,a,c,h){return i=new vh(i,a,c,h),a=Gi(i.parent.id,i.name),i.Qf=kt[a],kt[a]=i}function Ge(i){return(i&61440)===16384}function Xo(i){var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a}function Lr(i,a){if(Wo)return 0;if(!a.includes("r")||i.mode&292){if(a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73))return 2}else return 2;return 0}function Jo(i,a){try{return ir(i,a),20}catch{}return Lr(i,"wx")}function Yo(i,a,c){try{var h=ir(i,a)}catch(m){return m.Df}if(i=Lr(i,"wx"))return i;if(c){if(!Ge(h.mode))return 54;if(h===h.parent||Ki(h)==="/")return 10}else if(Ge(h.mode))return 31;return 0}function De(i){if(i=an[i],!i)throw new j(8);return i}function Zo(i,a=-1){if(i=Object.assign(new Rh,i),a==-1)e:{for(a=0;4096>=a;a++)if(!an[a])break e;throw new j(33)}return i.Lf=a,an[a]=i}function Lh(i,a=-1){return i=Zo(i,a),i.Bf?.Kg?.(i),i}var Oh={open(i){i.Bf=Ho[i.node.Uf].Bf,i.Bf.open?.(i)},Of(){throw new j(70)}};function Xi(i,a){Ho[i]={Bf:a}}function ea(i,a){var c=a==="/";if(c&&Hi)throw new j(10);if(!c&&a){var h=Pe(a,{kg:!1});if(a=h.path,h=h.node,h.Pf)throw new j(10);if(!Ge(h.mode))throw new j(54)}a={type:i,Pg:{},ng:a,zg:[]},i=i.Jf(a),i.Jf=a,a.root=i,c?Hi=i:h&&(h.Pf=a,h.Jf&&h.Jf.zg.push(a))}function Ji(i,a,c){var h=Pe(i,{parent:!0}).node;if(i=Bn(i),!i||i==="."||i==="..")throw new j(28);var m=Jo(h,i);if(m)throw new j(m);if(!h.Af.Yf)throw new j(63);return h.Af.Yf(h,i,a,c)}function _t(i,a){return Ji(i,(a!==void 0?a:511)&1023|16384,0)}function Dn(i,a,c){typeof c>"u"&&(c=a,a=438),Ji(i,a|8192,c)}function Yi(i,a){if(!qn(i))throw new j(44);var c=Pe(a,{parent:!0}).node;if(!c)throw new j(44);a=Bn(a);var h=Jo(c,a);if(h)throw new j(h);if(!c.Af.bg)throw new j(63);c.Af.bg(c,a,i)}function ta(i){var a=Pe(i,{parent:!0}).node;i=Bn(i);var c=ir(a,i),h=Yo(a,i,!0);if(h)throw new j(h);if(!a.Af.ag)throw new j(63);if(c.Pf)throw new j(10);a.Af.ag(a,i),Ko(c)}function ra(i){if(i=Pe(i).node,!i)throw new j(44);if(!i.Af.Vf)throw new j(28);return qn(Ki(i.parent),i.Af.Vf(i))}function Un(i,a){if(i=Pe(i,{Nf:!a}).node,!i)throw new j(44);if(!i.Af.If)throw new j(63);return i.Af.If(i)}function na(i){return Un(i,!0)}function ia(i,a){if(i=typeof i=="string"?Pe(i,{Nf:!0}).node:i,!i.Af.Ff)throw new j(63);i.Af.Ff(i,{mode:a&4095|i.mode&-4096,timestamp:Date.now()})}function sa(i,a){if(0>a)throw new j(28);if(i=typeof i=="string"?Pe(i,{Nf:!0}).node:i,!i.Af.Ff)throw new j(63);if(Ge(i.mode))throw new j(31);if((i.mode&61440)!==32768)throw new j(28);var c=Lr(i,"w");if(c)throw new j(c);i.Af.Ff(i,{size:a,timestamp:Date.now()})}function kn(i,a,c){if(i==="")throw new j(44);if(typeof a=="string"){var h={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof h>"u")throw Error(`Unknown file open mode: ${a}`);a=h}if(c=a&64?(typeof c>"u"?438:c)&4095|32768:0,typeof i=="object")var m=i;else{i=Rr(i);try{m=Pe(i,{Nf:!(a&131072)}).node}catch{}}if(h=!1,a&64)if(m){if(a&128)throw new j(20)}else m=Ji(i,c,0),h=!0;if(!m)throw new j(44);if((m.mode&61440)===8192&&(a&=-513),a&65536&&!Ge(m.mode))throw new j(54);if(!h&&(c=m?(m.mode&61440)===40960?32:Ge(m.mode)&&(Xo(a)!=="r"||a&512)?31:Lr(m,Xo(a)):44))throw new j(c);return a&512&&!h&&sa(m,0),a&=-131713,m=Zo({node:m,path:Ki(m),flags:a,seekable:!0,position:0,Bf:m.Bf,Eg:[],error:!1}),m.Bf.open&&m.Bf.open(m),!t.logReadFiles||a&1||(Zi||={},i in Zi||(Zi[i]=1)),m}function oa(i,a,c){if(i.Lf===null)throw new j(8);if(!i.seekable||!i.Bf.Of)throw new j(70);if(c!=0&&c!=1&&c!=2)throw new j(28);i.position=i.Bf.Of(i,a,c),i.Eg=[]}var aa;function ln(i,a,c){i=Rr("/dev/"+i);var h=bh(!!a,!!c);la||=64;var m=la++<<8|0;Xi(m,{open(T){T.seekable=!1},close(){c?.buffer?.length&&c(10)},read(T,x,U,F){for(var D=0,P=0;P<F;P++){try{var M=a()}catch{throw new j(29)}if(M===void 0&&D===0)throw new j(6);if(M==null)break;D++,x[U+P]=M}return D&&(T.node.timestamp=Date.now()),D},write(T,x,U,F){for(var D=0;D<F;D++)try{c(x[U+D])}catch{throw new j(29)}return F&&(T.node.timestamp=Date.now()),D}}),Dn(i,h,m)}var la,me={},Zi;function sr(i,a,c){if(a.charAt(0)==="/")return a;if(i=i===-100?"/":De(i).path,a.length==0){if(!c)throw new j(44);return i}return Rr(i+"/"+a)}function Pn(i,a,c){i=i(a),N[c>>2]=i.vg,N[c+4>>2]=i.mode,K[c+8>>2]=i.Bg,N[c+12>>2]=i.uid,N[c+16>>2]=i.yg,N[c+20>>2]=i.Uf,ge=[i.size>>>0,(re=i.size,1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[c+24>>2]=ge[0],N[c+28>>2]=ge[1],N[c+32>>2]=4096,N[c+36>>2]=i.tg,a=i.rg.getTime();var h=i.Ag.getTime(),m=i.ug.getTime();return ge=[Math.floor(a/1e3)>>>0,(re=Math.floor(a/1e3),1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[c+40>>2]=ge[0],N[c+44>>2]=ge[1],K[c+48>>2]=a%1e3*1e3,ge=[Math.floor(h/1e3)>>>0,(re=Math.floor(h/1e3),1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[c+56>>2]=ge[0],N[c+60>>2]=ge[1],K[c+64>>2]=h%1e3*1e3,ge=[Math.floor(m/1e3)>>>0,(re=Math.floor(m/1e3),1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[c+72>>2]=ge[0],N[c+76>>2]=ge[1],K[c+80>>2]=m%1e3*1e3,ge=[i.mg>>>0,(re=i.mg,1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[c+88>>2]=ge[0],N[c+92>>2]=ge[1],0}var Mn=void 0;function Qn(){var i=N[+Mn>>2];return Mn+=4,i}var cn=(i,a)=>a+2097152>>>0<4194305-!!i?(i>>>0)+4294967296*a:NaN,xh=[0,31,60,91,121,152,182,213,244,274,305,335],Ah=[0,31,59,90,120,151,181,212,243,273,304,334],es={},ca=()=>{if(!ts){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:d||"./this.program"},a;for(a in es)es[a]===void 0?delete i[a]:i[a]=es[a];var c=[];for(a in i)c.push(`${a}=${i[a]}`);ts=c}return ts},ts;function ua(){}function fa(){}function ha(){}function da(){}function pa(){}function _a(){}function ma(){}function ga(){}function ya(){}function Ea(){}function wa(){}function Sa(){}function Ta(){}function ba(){}function Ia(){}function Ra(){}function va(){}function La(){}function Oa(){}function xa(){}function Aa(){}function Na(){}function Fa(){}function Ca(){}function Ba(){}function qa(){}function Da(){}function Ua(){}function ka(){}function Pa(){}function Ma(){}function Qa(){}function $a(){}function za(){}function ja(){}function Va(){}function Ha(){}function Wa(){}function Ka(){}var $n=0,Ga=i=>{b=i,Po||0<$n||(t.onExit?.(i),y=!0),f(i,new ko(i))},rs=i=>{i instanceof ko||i=="unwind"||f(1,i)},zn=i=>{try{i()}catch(a){Te(a)}},Nh=i=>{if(!y)try{if(i(),!(Po||0<$n))try{b=i=b,Ga(i)}catch(a){rs(a)}}catch(a){rs(a)}};function Fh(){var i=E,a={};for(let[c,h]of Object.entries(i))a[c]=typeof h=="function"?(...m)=>{jn.push(c);try{return h(...m)}finally{y||(jn.pop(),mt&&Pt===1&&jn.length===0&&(Pt=0,zn(fl),typeof Fibers<"u"&&Fibers.Qg()))}}:h;return a}var Pt=0,mt=null,Xa=0,jn=[],Ja={},Ya={},Ch=0,ns=null,Bh=[];function qh(){return new Promise((i,a)=>{ns={resolve:i,reject:a}})}function Dh(){var i=nl(16396),a=i+12;K[i>>2]=a,K[i+4>>2]=a+16384,a=jn[0];var c=Ja[a];return c===void 0&&(c=Ch++,Ja[a]=c,Ya[c]=a),N[i+8>>2]=c,i}function Za(i){if(!y){if(Pt===0){var a=!1,c=!1;i((h=0)=>{if(!y&&(Xa=h,a=!0,c)){Pt=2,zn(()=>hl(mt)),typeof Browser<"u"&&Browser.eg.xg&&Browser.eg.resume(),h=!1;try{var m=(0,E[Ya[N[mt+8>>2]]])()}catch(U){m=U,h=!0}var T=!1;if(!mt){var x=ns;x&&(ns=null,(h?x.reject:x.resolve)(m),T=!0)}if(h&&!T)throw m}}),c=!0,a||(Pt=1,mt=Dh(),typeof Browser<"u"&&Browser.eg.xg&&Browser.eg.pause(),zn(()=>ul(mt)))}else Pt===2?(Pt=0,zn(dl),il(mt),mt=null,Bh.forEach(Nh)):Te(`invalid state: ${Pt}`);return Xa}}function is(i){return Za(a=>{i().then(a)})}var el={},or,Or,tl=[],gt=(i,a,c,h,m)=>{function T(M){return--$n,F!==0&&ll(F),a==="string"?M?he(v,M):"":a==="boolean"?!!M:M}var x={string:M=>{var H=0;if(M!=null&&M!==0){H=vr(M)+1;var ue=ss(H);pt(M,v,ue,H),H=ue}return H},array:M=>{var H=ss(M.length);return A.set(M,H),H}};i=t["_"+i];var U=[],F=0;if(h)for(var D=0;D<h.length;D++){var P=x[c[D]];P?(F===0&&(F=cl()),U[D]=P(h[D])):U[D]=h[D]}return c=mt,h=i(...U),m=m?.async,$n+=1,mt!=c?qh().then(T):(h=T(h),m?Promise.resolve(h):h)},rl=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;[44].forEach(i=>{Wi[i]=new j(i),Wi[i].stack="<generic error, no stack>"}),kt=Array(4096),ea(ce,"/"),_t("/tmp"),_t("/home"),_t("/home/web_user"),function(){_t("/dev"),Xi(259,{read:()=>0,write:(h,m,T,x)=>x}),Dn("/dev/null",259),jo(1280,Sh),jo(1536,Th),Dn("/dev/tty",1280),Dn("/dev/tty1",1536);var i=new Uint8Array(1024),a=0,c=()=>(a===0&&(a=ji(i).byteLength),i[--a]);ln("random",c),ln("urandom",c),_t("/dev/shm"),_t("/dev/shm/tmp")}(),function(){_t("/proc");var i=_t("/proc/self");_t("/proc/self/fd"),ea({Jf(){var a=Go(i,"fd",16895,73);return a.Af={Sf(c,h){var m=De(+h);return c={parent:null,Jf:{ng:"fake"},Af:{Vf:()=>m.path}},c.parent=c}},a}},"/proc/self/fd")}(),function(){let i=new Map;t.setAuthorizer=function(a,c,h){return c?i.set(a,{f:c,hg:h}):i.delete(a),gt("set_authorizer","number",["number"],[a])},ua=function(a,c,h,m,T,x){if(i.has(a)){let{f:U,hg:F}=i.get(a);return U(F,c,h?h?he(v,h):"":null,m?m?he(v,m):"":null,T?T?he(v,T):"":null,x?x?he(v,x):"":null)}return 0}}(),function(){let i=new Map,a=new Map;t.createFunction=function(c,h,m,T,x,U){let F=i.size;return i.set(F,{f:U,Mf:x}),gt("create_function","number","number string number number number number".split(" "),[c,h,m,T,F,0])},t.createAggregate=function(c,h,m,T,x,U,F){let D=i.size;return i.set(D,{step:U,wg:F,Mf:x}),gt("create_function","number","number string number number number number".split(" "),[c,h,m,T,D,1])},t.getFunctionUserData=function(c){return a.get(c)},ha=function(c,h,m,T){c=i.get(c),a.set(h,c.Mf),c.f(h,new Uint32Array(v.buffer,T,m)),a.delete(h)},pa=function(c,h,m,T){c=i.get(c),a.set(h,c.Mf),c.step(h,new Uint32Array(v.buffer,T,m)),a.delete(h)},fa=function(c,h){c=i.get(c),a.set(h,c.Mf),c.wg(h),a.delete(h)}}(),function(){let i=new Map;t.progressHandler=function(a,c,h,m){return h?i.set(a,{f:h,hg:m}):i.delete(a),gt("progress_handler",null,["number","number"],[a,c])},da=function(a){if(i.has(a)){let{f:c,hg:h}=i.get(a);return c(h)}return 0}}(),function(){function i(F,D){let P=`get${F}`,M=`set${F}`;return new Proxy(new DataView(v.buffer,D,F==="Int32"?4:8),{get(H,ue){if(ue===P)return function(_e,ve){if(!ve)throw Error("must be little endian");return H[ue](_e,ve)};if(ue===M)return function(_e,ve,be){if(!be)throw Error("must be little endian");return H[ue](_e,ve,be)};if(typeof ue=="string"&&ue.match(/^(get)|(set)/))throw Error("invalid type");return H[ue]}})}let a=typeof el=="object",c=new Map,h=new Map,m=new Map,T=a?new Set:null,x=a?new Set:null,U=new Map;Na=function(F,D,P,M){U.set(F?he(v,F):"",{size:D,Tf:Array.from(new Uint32Array(v.buffer,M,P))})},t.createModule=function(F,D,P,M){a&&(P.handleAsync=is);let H=c.size;return c.set(H,{module:P,Mf:M}),M=0,P.xCreate&&(M|=1),P.xConnect&&(M|=2),P.xBestIndex&&(M|=4),P.xDisconnect&&(M|=8),P.xDestroy&&(M|=16),P.xOpen&&(M|=32),P.xClose&&(M|=64),P.xFilter&&(M|=128),P.xNext&&(M|=256),P.xEof&&(M|=512),P.xColumn&&(M|=1024),P.xRowid&&(M|=2048),P.xUpdate&&(M|=4096),P.xBegin&&(M|=8192),P.xSync&&(M|=16384),P.xCommit&&(M|=32768),P.xRollback&&(M|=65536),P.xFindFunction&&(M|=131072),P.xRename&&(M|=262144),gt("create_module","number",["number","string","number","number"],[F,D,H,M])},Sa=function(F,D,P,M,H,ue){if(D=c.get(D),h.set(H,D),a){T.delete(H);for(let _e of T)h.delete(_e)}return M=Array.from(new Uint32Array(v.buffer,M,P)).map(_e=>_e?he(v,_e):""),D.module.xCreate(F,D.Mf,M,H,i("Int32",ue))},wa=function(F,D,P,M,H,ue){if(D=c.get(D),h.set(H,D),a){T.delete(H);for(let _e of T)h.delete(_e)}return M=Array.from(new Uint32Array(v.buffer,M,P)).map(_e=>_e?he(v,_e):""),D.module.xConnect(F,D.Mf,M,H,i("Int32",ue))},ma=function(F,D){var P=h.get(F),M=U.get("sqlite3_index_info").Tf;let H={};H.nConstraint=Re(D+M[0],"i32"),H.aConstraint=[];for(var ue=Re(D+M[1],"*"),_e=U.get("sqlite3_index_constraint").size,ve=0;ve<H.nConstraint;++ve){var be=H.aConstraint,ot=be.push,Xe=ue+ve*_e,xr=U.get("sqlite3_index_constraint").Tf,Mt={};Mt.iColumn=Re(Xe+xr[0],"i32"),Mt.op=Re(Xe+xr[1],"i8"),Mt.usable=!!Re(Xe+xr[2],"i8"),ot.call(be,Mt)}for(H.nOrderBy=Re(D+M[2],"i32"),H.aOrderBy=[],ue=Re(D+M[3],"*"),_e=U.get("sqlite3_index_orderby").size,ve=0;ve<H.nOrderBy;++ve)be=H.aOrderBy,ot=be.push,Xe=ue+ve*_e,xr=U.get("sqlite3_index_orderby").Tf,Mt={},Mt.iColumn=Re(Xe+xr[0],"i32"),Mt.desc=!!Re(Xe+xr[1],"i8"),ot.call(be,Mt);for(H.aConstraintUsage=[],ue=0;ue<H.nConstraint;++ue)H.aConstraintUsage.push({argvIndex:0,omit:!1});for(H.idxNum=Re(D+M[5],"i32"),H.idxStr=null,H.orderByConsumed=!!Re(D+M[8],"i8"),H.estimatedCost=Re(D+M[9],"double"),H.estimatedRows=Re(D+M[10],"i32"),H.idxFlags=Re(D+M[11],"i32"),H.colUsed=Re(D+M[12],"i32"),F=P.module.xBestIndex(F,H),P=U.get("sqlite3_index_info").Tf,M=Re(D+P[4],"*"),ue=U.get("sqlite3_index_constraint_usage").size,ot=0;ot<H.nConstraint;++ot)_e=M+ot*ue,be=H.aConstraintUsage[ot],Xe=U.get("sqlite3_index_constraint_usage").Tf,dt(_e+Xe[0],be.argvIndex,"i32"),dt(_e+Xe[1],be.omit?1:0,"i8");return dt(D+P[5],H.idxNum,"i32"),typeof H.idxStr=="string"&&(M=vr(H.idxStr),ue=gt("sqlite3_malloc","number",["number"],[M+1]),pt(H.idxStr,v,ue,M+1),dt(D+P[6],ue,"*"),dt(D+P[7],1,"i32")),dt(D+P[8],H.orderByConsumed,"i32"),dt(D+P[9],H.estimatedCost,"double"),dt(D+P[10],H.estimatedRows,"i32"),dt(D+P[11],H.idxFlags,"i32"),F},ba=function(F){let D=h.get(F);return a?T.add(F):h.delete(F),D.module.xDisconnect(F)},Ta=function(F){let D=h.get(F);return a?T.add(F):h.delete(F),D.module.xDestroy(F)},La=function(F,D){let P=h.get(F);if(m.set(D,P),a){x.delete(D);for(let M of x)m.delete(M)}return P.module.xOpen(F,D)},ga=function(F){let D=m.get(F);return a?x.add(F):m.delete(F),D.module.xClose(F)},Ia=function(F){return m.get(F).module.xEof(F)?1:0},Ra=function(F,D,P,M,H){let ue=m.get(F);return P=P?P?he(v,P):"":null,H=new Uint32Array(v.buffer,H,M),ue.module.xFilter(F,D,P,H)},va=function(F){return m.get(F).module.xNext(F)},ya=function(F,D,P){return m.get(F).module.xColumn(F,D,P)},Aa=function(F,D){return m.get(F).module.xRowid(F,i("BigInt64",D))},Ca=function(F,D,P,M){let H=h.get(F);return P=new Uint32Array(v.buffer,P,D),H.module.xUpdate(F,P,i("BigInt64",M))},_a=function(F){return h.get(F).module.xBegin(F)},Fa=function(F){return h.get(F).module.xSync(F)},Ea=function(F){return h.get(F).module.xCommit(F)},xa=function(F){return h.get(F).module.xRollback(F)},Oa=function(F,D){let P=h.get(F);return D=D?he(v,D):"",P.module.xRename(F,D)}}(),function(){function i(T,x){let U=`get${T}`,F=`set${T}`;return new Proxy(new DataView(v.buffer,x,T==="Int32"?4:8),{get(D,P){if(P===U)return function(M,H){if(!H)throw Error("must be little endian");return D[P](M,H)};if(P===F)return function(M,H,ue){if(!ue)throw Error("must be little endian");return D[P](M,H,ue)};if(typeof P=="string"&&P.match(/^(get)|(set)/))throw Error("invalid type");return D[P]}})}let a=typeof el=="object";a&&(t.handleAsync=is);let c=new Map,h=new Map;t.registerVFS=function(T,x){if(gt("sqlite3_vfs_find","number",["string"],[T.name]))throw Error(`VFS '${T.name}' already registered`);a&&(T.handleAsync=is);var U=T.mxPathName??64;let F=t._malloc(4);return x=gt("register_vfs","number",["string","number","number","number"],[T.name,U,x?1:0,F]),x||(U=Re(F,"*"),c.set(U,T)),t._free(F),x};let m=a?new Set:null;Da=function(T){let x=h.get(T);return a?m.add(T):h.delete(T),x.xClose(T)},za=function(T,x,U,F,D){return h.get(T).xRead(T,v.subarray(x,x+U),4294967296*D+F+(0>F?4294967296:0))},Ka=function(T,x,U,F,D){return h.get(T).xWrite(T,v.subarray(x,x+U),4294967296*D+F+(0>F?4294967296:0))},Ha=function(T,x,U){return h.get(T).xTruncate(T,4294967296*U+x+(0>x?4294967296:0))},Va=function(T,x){return h.get(T).xSync(T,x)},Ma=function(T,x){let U=h.get(T);return x=i("BigInt64",x),U.xFileSize(T,x)},Qa=function(T,x){return h.get(T).xLock(T,x)},Wa=function(T,x){return h.get(T).xUnlock(T,x)},qa=function(T,x){let U=h.get(T);return x=i("Int32",x),U.xCheckReservedLock(T,x)},Pa=function(T,x,U){let F=h.get(T);return U=new DataView(v.buffer,U),F.xFileControl(T,x,U)},ja=function(T){return h.get(T).xSectorSize(T)},ka=function(T){return h.get(T).xDeviceCharacteristics(T)},$a=function(T,x,U,F,D){if(T=c.get(T),h.set(U,T),a){m.delete(U);for(var P of m)h.delete(P)}if(P=null,F&64){P=1;let M=[];for(;P;){let H=v[x++];if(H)M.push(H);else switch(v[x]||(P=null),P){case 1:M.push(63),P=2;break;case 2:M.push(61),P=3;break;case 3:M.push(38),P=2}}P=new TextDecoder().decode(new Uint8Array(M))}else x&&(P=x?he(v,x):"");return D=i("Int32",D),T.xOpen(P,U,F,D)},Ua=function(T,x,U){return c.get(T).xDelete(x?he(v,x):"",U)},Ba=function(T,x,U,F){return T=c.get(T),F=i("Int32",F),T.xAccess(x?he(v,x):"",U,F)}}();var Uh={a:(i,a,c,h)=>{Te(`Assertion failed: ${i?he(v,i):""}, at: `+[a?a?he(v,a):"":"unknown filename",c,h?h?he(v,h):"":"unknown function"])},N:function(i,a){try{return i=i?he(v,i):"",ia(i,a),0}catch(c){if(typeof me>"u"||c.name!=="ErrnoError")throw c;return-c.Df}},Q:function(i,a,c){try{if(a=a?he(v,a):"",a=sr(i,a),c&-8)return-28;var h=Pe(a,{Nf:!0}).node;return h?(i="",c&4&&(i+="r"),c&2&&(i+="w"),c&1&&(i+="x"),i&&Lr(h,i)?-2:0):-44}catch(m){if(typeof me>"u"||m.name!=="ErrnoError")throw m;return-m.Df}},O:function(i,a){try{var c=De(i);return ia(c.node,a),0}catch(h){if(typeof me>"u"||h.name!=="ErrnoError")throw h;return-h.Df}},M:function(i){try{var a=De(i).node,c=typeof a=="string"?Pe(a,{Nf:!0}).node:a;if(!c.Af.Ff)throw new j(63);return c.Af.Ff(c,{timestamp:Date.now()}),0}catch(h){if(typeof me>"u"||h.name!=="ErrnoError")throw h;return-h.Df}},b:function(i,a,c){Mn=c;try{var h=De(i);switch(a){case 0:var m=Qn();if(0>m)break;for(;an[m];)m++;return Lh(h,m).Lf;case 1:case 2:return 0;case 3:return h.flags;case 4:return m=Qn(),h.flags|=m,0;case 12:return m=Qn(),k[m+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(T){if(typeof me>"u"||T.name!=="ErrnoError")throw T;return-T.Df}},L:function(i,a){try{var c=De(i);return Pn(Un,c.path,a)}catch(h){if(typeof me>"u"||h.name!=="ErrnoError")throw h;return-h.Df}},n:function(i,a,c){a=cn(a,c);try{if(isNaN(a))return 61;var h=De(i);if(!(h.flags&2097155))throw new j(28);return sa(h.node,a),0}catch(m){if(typeof me>"u"||m.name!=="ErrnoError")throw m;return-m.Df}},F:function(i,a){try{if(a===0)return-28;var c=vr("/")+1;return a<c?-68:(pt("/",v,i,a),c)}catch(h){if(typeof me>"u"||h.name!=="ErrnoError")throw h;return-h.Df}},J:function(i,a){try{return i=i?he(v,i):"",Pn(na,i,a)}catch(c){if(typeof me>"u"||c.name!=="ErrnoError")throw c;return-c.Df}},C:function(i,a,c){try{return a=a?he(v,a):"",a=sr(i,a),a=Rr(a),a[a.length-1]==="/"&&(a=a.substr(0,a.length-1)),_t(a,c),0}catch(h){if(typeof me>"u"||h.name!=="ErrnoError")throw h;return-h.Df}},H:function(i,a,c,h){try{a=a?he(v,a):"";var m=h&256;return a=sr(i,a,h&4096),Pn(m?na:Un,a,c)}catch(T){if(typeof me>"u"||T.name!=="ErrnoError")throw T;return-T.Df}},B:function(i,a,c,h){Mn=h;try{a=a?he(v,a):"",a=sr(i,a);var m=h?Qn():0;return kn(a,c,m).Lf}catch(T){if(typeof me>"u"||T.name!=="ErrnoError")throw T;return-T.Df}},z:function(i,a,c,h){try{if(a=a?he(v,a):"",a=sr(i,a),0>=h)return-28;var m=ra(a),T=Math.min(h,vr(m)),x=A[c+T];return pt(m,v,c,h+1),A[c+T]=x,T}catch(U){if(typeof me>"u"||U.name!=="ErrnoError")throw U;return-U.Df}},y:function(i){try{return i=i?he(v,i):"",ta(i),0}catch(a){if(typeof me>"u"||a.name!=="ErrnoError")throw a;return-a.Df}},K:function(i,a){try{return i=i?he(v,i):"",Pn(Un,i,a)}catch(c){if(typeof me>"u"||c.name!=="ErrnoError")throw c;return-c.Df}},u:function(i,a,c){try{if(a=a?he(v,a):"",a=sr(i,a),c===0){i=a;var h=Pe(i,{parent:!0}).node;if(!h)throw new j(44);var m=Bn(i),T=ir(h,m),x=Yo(h,m,!1);if(x)throw new j(x);if(!h.Af.cg)throw new j(63);if(T.Pf)throw new j(10);h.Af.cg(h,m),Ko(T)}else c===512?ta(a):Te("Invalid flags passed to unlinkat");return 0}catch(U){if(typeof me>"u"||U.name!=="ErrnoError")throw U;return-U.Df}},t:function(i,a,c){try{if(a=a?he(v,a):"",a=sr(i,a,!0),c){var h=K[c>>2]+4294967296*N[c+4>>2],m=N[c+8>>2];T=1e3*h+m/1e6,c+=16,h=K[c>>2]+4294967296*N[c+4>>2],m=N[c+8>>2],x=1e3*h+m/1e6}else var T=Date.now(),x=T;i=T;var U=Pe(a,{Nf:!0}).node;return U.Af.Ff(U,{timestamp:Math.max(i,x)}),0}catch(F){if(typeof me>"u"||F.name!=="ErrnoError")throw F;return-F.Df}},k:function(i,a,c){i=new Date(1e3*cn(i,a)),N[c>>2]=i.getSeconds(),N[c+4>>2]=i.getMinutes(),N[c+8>>2]=i.getHours(),N[c+12>>2]=i.getDate(),N[c+16>>2]=i.getMonth(),N[c+20>>2]=i.getFullYear()-1900,N[c+24>>2]=i.getDay(),a=i.getFullYear(),N[c+28>>2]=(a%4!==0||a%100===0&&a%400!==0?Ah:xh)[i.getMonth()]+i.getDate()-1|0,N[c+36>>2]=-(60*i.getTimezoneOffset()),a=new Date(i.getFullYear(),6,1).getTimezoneOffset();var h=new Date(i.getFullYear(),0,1).getTimezoneOffset();N[c+32>>2]=(a!=h&&i.getTimezoneOffset()==Math.min(h,a))|0},i:function(i,a,c,h,m,T,x,U){m=cn(m,T);try{if(isNaN(m))return 61;var F=De(h);if(a&2&&!(c&2)&&(F.flags&2097155)!==2)throw new j(2);if((F.flags&2097155)===1)throw new j(2);if(!F.Bf.Zf)throw new j(43);var D=F.Bf.Zf(F,i,m,a,c),P=D.Cg;return N[x>>2]=D.qg,K[U>>2]=P,0}catch(M){if(typeof me>"u"||M.name!=="ErrnoError")throw M;return-M.Df}},j:function(i,a,c,h,m,T,x){T=cn(T,x);try{var U=De(m);if(c&2){if((U.node.mode&61440)!==32768)throw new j(43);h&2||U.Bf.$f&&U.Bf.$f(U,v.slice(i,i+a),T,a,h)}}catch(F){if(typeof me>"u"||F.name!=="ErrnoError")throw F;return-F.Df}},v:(i,a,c,h)=>{var m=new Date().getFullYear(),T=new Date(m,0,1),x=new Date(m,6,1);m=T.getTimezoneOffset();var U=x.getTimezoneOffset();K[i>>2]=60*Math.max(m,U),N[a>>2]=+(m!=U),i=F=>F.toLocaleTimeString(void 0,{hour12:!1,timeZoneName:"short"}).split(" ")[1],T=i(T),x=i(x),U<m?(pt(T,v,c,17),pt(x,v,h,17)):(pt(T,v,h,17),pt(x,v,c,17))},e:()=>Date.now(),d:()=>performance.now(),r:i=>{var a=v.length;if(i>>>=0,2147483648<i)return!1;for(var c=1;4>=c;c*=2){var h=a*(1+.2/c);h=Math.min(h,i+100663296);var m=Math;h=Math.max(i,h);e:{m=(m.min.call(m,2147483648,h+(65536-h%65536)%65536)-w.buffer.byteLength+65535)/65536;try{w.grow(m),S();var T=1;break e}catch{}T=void 0}if(T)return!0}return!1},D:(i,a)=>{var c=0;return ca().forEach((h,m)=>{var T=a+c;for(m=K[i+4*m>>2]=T,T=0;T<h.length;++T)A[m++]=h.charCodeAt(T);A[m]=0,c+=h.length+1}),0},E:(i,a)=>{var c=ca();K[i>>2]=c.length;var h=0;return c.forEach(m=>h+=m.length+1),K[a>>2]=h,0},f:function(i){try{var a=De(i);if(a.Lf===null)throw new j(8);a.dg&&(a.dg=null);try{a.Bf.close&&a.Bf.close(a)}catch(c){throw c}finally{an[a.Lf]=null}return a.Lf=null,0}catch(c){if(typeof me>"u"||c.name!=="ErrnoError")throw c;return c.Df}},s:function(i,a){try{var c=De(i);return A[a]=c.Hf?2:Ge(c.mode)?3:(c.mode&61440)===40960?7:4,k[a+2>>1]=0,ge=[0,(re=0,1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[a+8>>2]=ge[0],N[a+12>>2]=ge[1],ge=[0,(re=0,1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[a+16>>2]=ge[0],N[a+20>>2]=ge[1],0}catch(h){if(typeof me>"u"||h.name!=="ErrnoError")throw h;return h.Df}},A:function(i,a,c,h){try{e:{var m=De(i);i=a;for(var T,x=a=0;x<c;x++){var U=K[i>>2],F=K[i+4>>2];i+=8;var D=m,P=T,M=A;if(0>F||0>P)throw new j(28);if(D.Lf===null)throw new j(8);if((D.flags&2097155)===1)throw new j(8);if(Ge(D.node.mode))throw new j(31);if(!D.Bf.read)throw new j(28);var H=typeof P<"u";if(!H)P=D.position;else if(!D.seekable)throw new j(70);var ue=D.Bf.read(D,M,U,F,P);H||(D.position+=ue);var _e=ue;if(0>_e){var ve=-1;break e}if(a+=_e,_e<F)break;typeof T<"u"&&(T+=_e)}ve=a}return K[h>>2]=ve,0}catch(be){if(typeof me>"u"||be.name!=="ErrnoError")throw be;return be.Df}},l:function(i,a,c,h,m){a=cn(a,c);try{if(isNaN(a))return 61;var T=De(i);return oa(T,a,h),ge=[T.position>>>0,(re=T.position,1<=+Math.abs(re)?0<re?+Math.floor(re/4294967296)>>>0:~~+Math.ceil((re-+(~~re>>>0))/4294967296)>>>0:0)],N[m>>2]=ge[0],N[m+4>>2]=ge[1],T.dg&&a===0&&h===0&&(T.dg=null),0}catch(x){if(typeof me>"u"||x.name!=="ErrnoError")throw x;return x.Df}},G:function(i){try{var a=De(i);return Za(c=>{var h=a.node.Jf;h.type.Dg?h.type.Dg(h,!1,m=>{c(m?29:0)}):c(0)})}catch(c){if(typeof me>"u"||c.name!=="ErrnoError")throw c;return c.Df}},w:function(i,a,c,h){try{e:{var m=De(i);i=a;for(var T,x=a=0;x<c;x++){var U=K[i>>2],F=K[i+4>>2];i+=8;var D=m,P=U,M=F,H=T,ue=A;if(0>M||0>H)throw new j(28);if(D.Lf===null)throw new j(8);if(!(D.flags&2097155))throw new j(8);if(Ge(D.node.mode))throw new j(31);if(!D.Bf.write)throw new j(28);D.seekable&&D.flags&1024&&oa(D,0,2);var _e=typeof H<"u";if(!_e)H=D.position;else if(!D.seekable)throw new j(70);var ve=D.Bf.write(D,ue,P,M,H,void 0);_e||(D.position+=ve);var be=ve;if(0>be){var ot=-1;break e}a+=be,typeof T<"u"&&(T+=be)}ot=a}return K[h>>2]=ot,0}catch(Xe){if(typeof me>"u"||Xe.name!=="ErrnoError")throw Xe;return Xe.Df}},ta:(i,a)=>(ji(v.subarray(i,i+a)),0),ia:ua,I:fa,_:ha,ca:da,P:pa,la:_a,m:ma,sa:ga,oa:ya,ja:Ea,ea:wa,fa:Sa,g:Ta,h:ba,pa:Ia,ra:Ra,qa:va,da:La,ga:Oa,ha:xa,na:Aa,c:Na,ka:Fa,ma:Ca,x:function(i,a,c,h){(0,globalThis.__onTablesChanged)?.(i,a,c,h)},aa:Ba,V:qa,$:Da,ba:Ua,S:ka,U:Pa,Y:Ma,X:Qa,R:$a,q:za,T:ja,Z:Va,o:Ha,W:Wa,p:Ka},E=function(){function i(c){return E=c.exports,E=Fh(),w=E.ua,S(),or=E.qf,$.unshift(E.va),Ce--,t.monitorRunDependencies?.(Ce),Ce==0&&(ft!==null&&(clearInterval(ft),ft=null),Se&&(c=Se,Se=null,c())),E}var a={a:Uh};if(Ce++,t.monitorRunDependencies?.(Ce),t.instantiateWasm)try{return t.instantiateWasm(a,i)}catch(c){L(`Module.instantiateWasm callback failed with error: ${c}`),s(c)}return gh(a,function(c){i(c.instance)}).catch(s),{}}();t._sqlite3_auto_extension=i=>(t._sqlite3_auto_extension=E.wa)(i),t._sqlite3_free=i=>(t._sqlite3_free=E.xa)(i),t._sqlite3_malloc=i=>(t._sqlite3_malloc=E.ya)(i),t._sqlite3_bind_blob=(i,a,c,h,m)=>(t._sqlite3_bind_blob=E.za)(i,a,c,h,m),t._sqlite3_shutdown=()=>(t._sqlite3_shutdown=E.Aa)(),t._sqlite3_bind_int=(i,a,c)=>(t._sqlite3_bind_int=E.Ba)(i,a,c),t._sqlite3_bind_int64=(i,a,c,h)=>(t._sqlite3_bind_int64=E.Ca)(i,a,c,h),t._sqlite3_bind_double=(i,a,c)=>(t._sqlite3_bind_double=E.Da)(i,a,c),t._sqlite3_bind_null=(i,a)=>(t._sqlite3_bind_null=E.Ea)(i,a),t._sqlite3_clear_bindings=i=>(t._sqlite3_clear_bindings=E.Fa)(i),t._sqlite3_bind_text=(i,a,c,h,m)=>(t._sqlite3_bind_text=E.Ga)(i,a,c,h,m),t._sqlite3_bind_pointer=(i,a,c,h,m)=>(t._sqlite3_bind_pointer=E.Ha)(i,a,c,h,m),t._sqlite3_bind_value=(i,a,c)=>(t._sqlite3_bind_value=E.Ia)(i,a,c),t._sqlite3_close=i=>(t._sqlite3_close=E.Ja)(i),t._sqlite3_vtab_config=(i,a,c)=>(t._sqlite3_vtab_config=E.Ka)(i,a,c),t._sqlite3_commit_hook=(i,a,c)=>(t._sqlite3_commit_hook=E.La)(i,a,c),t._sqlite3_column_type=(i,a)=>(t._sqlite3_column_type=E.Ma)(i,a),t._sqlite3_column_count=i=>(t._sqlite3_column_count=E.Na)(i),t._sqlite3_column_text=(i,a)=>(t._sqlite3_column_text=E.Oa)(i,a),t._sqlite3_column_blob=(i,a)=>(t._sqlite3_column_blob=E.Pa)(i,a),t._sqlite3_column_bytes=(i,a)=>(t._sqlite3_column_bytes=E.Qa)(i,a),t._sqlite3_column_value=(i,a)=>(t._sqlite3_column_value=E.Ra)(i,a),t._sqlite3_column_double=(i,a)=>(t._sqlite3_column_double=E.Sa)(i,a),t._sqlite3_column_int=(i,a)=>(t._sqlite3_column_int=E.Ta)(i,a),t._sqlite3_column_int64=(i,a)=>(t._sqlite3_column_int64=E.Ua)(i,a),t._sqlite3_column_name=(i,a)=>(t._sqlite3_column_name=E.Va)(i,a),t._sqlite3_context_db_handle=i=>(t._sqlite3_context_db_handle=E.Wa)(i),t._sqlite3_create_function_v2=(i,a,c,h,m,T,x,U,F)=>(t._sqlite3_create_function_v2=E.Xa)(i,a,c,h,m,T,x,U,F),t._sqlite3_create_module_v2=(i,a,c,h,m)=>(t._sqlite3_create_module_v2=E.Ya)(i,a,c,h,m),t._sqlite3_declare_vtab=(i,a)=>(t._sqlite3_declare_vtab=E.Za)(i,a),t._sqlite3_errcode=i=>(t._sqlite3_errcode=E._a)(i),t._sqlite3_errmsg=i=>(t._sqlite3_errmsg=E.$a)(i),t._sqlite3_exec=(i,a,c,h,m)=>(t._sqlite3_exec=E.ab)(i,a,c,h,m),t._sqlite3_finalize=i=>(t._sqlite3_finalize=E.bb)(i),t._sqlite3_get_auxdata=(i,a)=>(t._sqlite3_get_auxdata=E.cb)(i,a),t._sqlite3_next_stmt=(i,a)=>(t._sqlite3_next_stmt=E.db)(i,a),t._sqlite3_open=(i,a)=>(t._sqlite3_open=E.eb)(i,a),t._sqlite3_prepare_v2=(i,a,c,h,m)=>(t._sqlite3_prepare_v2=E.fb)(i,a,c,h,m),t._sqlite3_prepare_v3=(i,a,c,h,m,T)=>(t._sqlite3_prepare_v3=E.gb)(i,a,c,h,m,T),t._sqlite3_randomness=(i,a)=>(t._sqlite3_randomness=E.hb)(i,a),t._sqlite3_result_int=(i,a)=>(t._sqlite3_result_int=E.ib)(i,a),t._sqlite3_result_blob=(i,a,c,h)=>(t._sqlite3_result_blob=E.jb)(i,a,c,h),t._sqlite3_result_int64=(i,a,c)=>(t._sqlite3_result_int64=E.kb)(i,a,c),t._sqlite3_result_double=(i,a)=>(t._sqlite3_result_double=E.lb)(i,a),t._sqlite3_result_null=i=>(t._sqlite3_result_null=E.mb)(i),t._sqlite3_result_pointer=(i,a,c,h)=>(t._sqlite3_result_pointer=E.nb)(i,a,c,h),t._sqlite3_result_error=(i,a,c)=>(t._sqlite3_result_error=E.ob)(i,a,c),t._sqlite3_result_error_code=(i,a)=>(t._sqlite3_result_error_code=E.pb)(i,a),t._sqlite3_result_value=(i,a)=>(t._sqlite3_result_value=E.qb)(i,a),t._sqlite3_result_text=(i,a,c,h)=>(t._sqlite3_result_text=E.rb)(i,a,c,h),t._sqlite3_result_subtype=(i,a)=>(t._sqlite3_result_subtype=E.sb)(i,a),t._sqlite3_set_authorizer=(i,a,c)=>(t._sqlite3_set_authorizer=E.tb)(i,a,c),t._sqlite3_set_auxdata=(i,a,c,h)=>(t._sqlite3_set_auxdata=E.ub)(i,a,c,h),t._sqlite3_sql=i=>(t._sqlite3_sql=E.vb)(i),t._sqlite3_reset=i=>(t._sqlite3_reset=E.wb)(i),t._sqlite3_value_text=i=>(t._sqlite3_value_text=E.xb)(i),t._sqlite3_value_type=i=>(t._sqlite3_value_type=E.yb)(i),t._sqlite3_value_bytes=i=>(t._sqlite3_value_bytes=E.zb)(i),t._sqlite3_value_blob=i=>(t._sqlite3_value_blob=E.Ab)(i),t._sqlite3_value_int=i=>(t._sqlite3_value_int=E.Bb)(i),t._sqlite3_value_int64=i=>(t._sqlite3_value_int64=E.Cb)(i),t._sqlite3_value_double=i=>(t._sqlite3_value_double=E.Db)(i),t._sqlite3_value_pointer=(i,a)=>(t._sqlite3_value_pointer=E.Eb)(i,a),t._sqlite3_vtab_distinct=i=>(t._sqlite3_vtab_distinct=E.Fb)(i),t._sqlite3_get_autocommit=i=>(t._sqlite3_get_autocommit=E.Gb)(i),t._sqlite3_step=i=>(t._sqlite3_step=E.Hb)(i),t._sqlite3_status64=(i,a,c,h)=>(t._sqlite3_status64=E.Ib)(i,a,c,h),t._sqlite3_status=(i,a,c,h)=>(t._sqlite3_status=E.Jb)(i,a,c,h),t._sqlite3_db_status=(i,a,c,h,m)=>(t._sqlite3_db_status=E.Kb)(i,a,c,h,m),t._sqlite3_msize=i=>(t._sqlite3_msize=E.Lb)(i),t._sqlite3_vfs_find=i=>(t._sqlite3_vfs_find=E.Mb)(i),t._sqlite3_vfs_register=(i,a)=>(t._sqlite3_vfs_register=E.Nb)(i,a),t._sqlite3_vfs_unregister=i=>(t._sqlite3_vfs_unregister=E.Ob)(i),t._sqlite3_release_memory=i=>(t._sqlite3_release_memory=E.Pb)(i),t._sqlite3_soft_heap_limit64=(i,a)=>(t._sqlite3_soft_heap_limit64=E.Qb)(i,a),t._sqlite3_memory_used=()=>(t._sqlite3_memory_used=E.Rb)(),t._sqlite3_hard_heap_limit64=(i,a)=>(t._sqlite3_hard_heap_limit64=E.Sb)(i,a),t._sqlite3_memory_highwater=i=>(t._sqlite3_memory_highwater=E.Tb)(i),t._sqlite3_malloc64=(i,a)=>(t._sqlite3_malloc64=E.Ub)(i,a),t._sqlite3_realloc=(i,a)=>(t._sqlite3_realloc=E.Vb)(i,a),t._sqlite3_realloc64=(i,a,c)=>(t._sqlite3_realloc64=E.Wb)(i,a,c),t._sqlite3_str_vappendf=(i,a,c)=>(t._sqlite3_str_vappendf=E.Xb)(i,a,c),t._sqlite3_str_append=(i,a,c)=>(t._sqlite3_str_append=E.Yb)(i,a,c),t._sqlite3_str_appendchar=(i,a,c)=>(t._sqlite3_str_appendchar=E.Zb)(i,a,c),t._sqlite3_str_appendall=(i,a)=>(t._sqlite3_str_appendall=E._b)(i,a),t._sqlite3_str_appendf=(i,a,c)=>(t._sqlite3_str_appendf=E.$b)(i,a,c),t._sqlite3_str_finish=i=>(t._sqlite3_str_finish=E.ac)(i),t._sqlite3_str_errcode=i=>(t._sqlite3_str_errcode=E.bc)(i),t._sqlite3_str_length=i=>(t._sqlite3_str_length=E.cc)(i),t._sqlite3_str_value=i=>(t._sqlite3_str_value=E.dc)(i),t._sqlite3_str_reset=i=>(t._sqlite3_str_reset=E.ec)(i),t._sqlite3_str_new=i=>(t._sqlite3_str_new=E.fc)(i),t._sqlite3_vmprintf=(i,a)=>(t._sqlite3_vmprintf=E.gc)(i,a),t._sqlite3_mprintf=(i,a)=>(t._sqlite3_mprintf=E.hc)(i,a),t._sqlite3_vsnprintf=(i,a,c,h)=>(t._sqlite3_vsnprintf=E.ic)(i,a,c,h),t._sqlite3_snprintf=(i,a,c,h)=>(t._sqlite3_snprintf=E.jc)(i,a,c,h),t._sqlite3_log=(i,a,c)=>(t._sqlite3_log=E.kc)(i,a,c),t._sqlite3_stricmp=(i,a)=>(t._sqlite3_stricmp=E.lc)(i,a),t._sqlite3_strnicmp=(i,a,c)=>(t._sqlite3_strnicmp=E.mc)(i,a,c),t._sqlite3_os_init=()=>(t._sqlite3_os_init=E.nc)(),t._sqlite3_os_end=()=>(t._sqlite3_os_end=E.oc)(),t._sqlite3_serialize=(i,a,c,h)=>(t._sqlite3_serialize=E.pc)(i,a,c,h),t._sqlite3_deserialize=(i,a,c,h,m,T,x,U)=>(t._sqlite3_deserialize=E.qc)(i,a,c,h,m,T,x,U),t._sqlite3_database_file_object=i=>(t._sqlite3_database_file_object=E.rc)(i),t._sqlite3_backup_init=(i,a,c,h)=>(t._sqlite3_backup_init=E.sc)(i,a,c,h),t._sqlite3_backup_step=(i,a)=>(t._sqlite3_backup_step=E.tc)(i,a),t._sqlite3_backup_finish=i=>(t._sqlite3_backup_finish=E.uc)(i),t._sqlite3_backup_remaining=i=>(t._sqlite3_backup_remaining=E.vc)(i),t._sqlite3_backup_pagecount=i=>(t._sqlite3_backup_pagecount=E.wc)(i),t._sqlite3_value_bytes16=i=>(t._sqlite3_value_bytes16=E.xc)(i),t._sqlite3_value_subtype=i=>(t._sqlite3_value_subtype=E.yc)(i),t._sqlite3_value_text16=i=>(t._sqlite3_value_text16=E.zc)(i),t._sqlite3_value_text16be=i=>(t._sqlite3_value_text16be=E.Ac)(i),t._sqlite3_value_text16le=i=>(t._sqlite3_value_text16le=E.Bc)(i),t._sqlite3_value_encoding=i=>(t._sqlite3_value_encoding=E.Cc)(i),t._sqlite3_value_nochange=i=>(t._sqlite3_value_nochange=E.Dc)(i),t._sqlite3_value_frombind=i=>(t._sqlite3_value_frombind=E.Ec)(i),t._sqlite3_value_dup=i=>(t._sqlite3_value_dup=E.Fc)(i),t._sqlite3_value_free=i=>(t._sqlite3_value_free=E.Gc)(i),t._sqlite3_result_blob64=(i,a,c,h,m)=>(t._sqlite3_result_blob64=E.Hc)(i,a,c,h,m),t._sqlite3_result_error16=(i,a,c)=>(t._sqlite3_result_error16=E.Ic)(i,a,c),t._sqlite3_result_text64=(i,a,c,h,m,T)=>(t._sqlite3_result_text64=E.Jc)(i,a,c,h,m,T),t._sqlite3_result_text16=(i,a,c,h)=>(t._sqlite3_result_text16=E.Kc)(i,a,c,h),t._sqlite3_result_text16be=(i,a,c,h)=>(t._sqlite3_result_text16be=E.Lc)(i,a,c,h),t._sqlite3_result_text16le=(i,a,c,h)=>(t._sqlite3_result_text16le=E.Mc)(i,a,c,h),t._sqlite3_result_error_toobig=i=>(t._sqlite3_result_error_toobig=E.Nc)(i),t._sqlite3_result_zeroblob=(i,a)=>(t._sqlite3_result_zeroblob=E.Oc)(i,a),t._sqlite3_result_zeroblob64=(i,a,c)=>(t._sqlite3_result_zeroblob64=E.Pc)(i,a,c),t._sqlite3_result_error_nomem=i=>(t._sqlite3_result_error_nomem=E.Qc)(i),t._sqlite3_user_data=i=>(t._sqlite3_user_data=E.Rc)(i),t._sqlite3_vtab_nochange=i=>(t._sqlite3_vtab_nochange=E.Sc)(i),t._sqlite3_vtab_in_first=(i,a)=>(t._sqlite3_vtab_in_first=E.Tc)(i,a),t._sqlite3_vtab_in_next=(i,a)=>(t._sqlite3_vtab_in_next=E.Uc)(i,a),t._sqlite3_aggregate_context=(i,a)=>(t._sqlite3_aggregate_context=E.Vc)(i,a),t._sqlite3_data_count=i=>(t._sqlite3_data_count=E.Wc)(i),t._sqlite3_column_bytes16=(i,a)=>(t._sqlite3_column_bytes16=E.Xc)(i,a),t._sqlite3_column_text16=(i,a)=>(t._sqlite3_column_text16=E.Yc)(i,a),t._sqlite3_column_name16=(i,a)=>(t._sqlite3_column_name16=E.Zc)(i,a),t._sqlite3_bind_blob64=(i,a,c,h,m,T)=>(t._sqlite3_bind_blob64=E._c)(i,a,c,h,m,T),t._sqlite3_bind_text64=(i,a,c,h,m,T,x)=>(t._sqlite3_bind_text64=E.$c)(i,a,c,h,m,T,x),t._sqlite3_bind_text16=(i,a,c,h,m)=>(t._sqlite3_bind_text16=E.ad)(i,a,c,h,m),t._sqlite3_bind_zeroblob=(i,a,c)=>(t._sqlite3_bind_zeroblob=E.bd)(i,a,c),t._sqlite3_bind_zeroblob64=(i,a,c,h)=>(t._sqlite3_bind_zeroblob64=E.cd)(i,a,c,h),t._sqlite3_bind_parameter_count=i=>(t._sqlite3_bind_parameter_count=E.dd)(i),t._sqlite3_bind_parameter_name=(i,a)=>(t._sqlite3_bind_parameter_name=E.ed)(i,a),t._sqlite3_bind_parameter_index=(i,a)=>(t._sqlite3_bind_parameter_index=E.fd)(i,a),t._sqlite3_db_handle=i=>(t._sqlite3_db_handle=E.gd)(i),t._sqlite3_stmt_readonly=i=>(t._sqlite3_stmt_readonly=E.hd)(i),t._sqlite3_stmt_isexplain=i=>(t._sqlite3_stmt_isexplain=E.id)(i),t._sqlite3_stmt_explain=(i,a)=>(t._sqlite3_stmt_explain=E.jd)(i,a),t._sqlite3_stmt_busy=i=>(t._sqlite3_stmt_busy=E.kd)(i),t._sqlite3_stmt_status=(i,a,c)=>(t._sqlite3_stmt_status=E.ld)(i,a,c),t._sqlite3_expanded_sql=i=>(t._sqlite3_expanded_sql=E.md)(i),t._sqlite3_value_numeric_type=i=>(t._sqlite3_value_numeric_type=E.nd)(i),t._sqlite3_blob_open=(i,a,c,h,m,T,x,U)=>(t._sqlite3_blob_open=E.od)(i,a,c,h,m,T,x,U),t._sqlite3_blob_close=i=>(t._sqlite3_blob_close=E.pd)(i),t._sqlite3_blob_read=(i,a,c,h)=>(t._sqlite3_blob_read=E.qd)(i,a,c,h),t._sqlite3_blob_write=(i,a,c,h)=>(t._sqlite3_blob_write=E.rd)(i,a,c,h),t._sqlite3_blob_bytes=i=>(t._sqlite3_blob_bytes=E.sd)(i),t._sqlite3_blob_reopen=(i,a,c)=>(t._sqlite3_blob_reopen=E.td)(i,a,c),t._sqlite3_strglob=(i,a)=>(t._sqlite3_strglob=E.ud)(i,a),t._sqlite3_strlike=(i,a,c)=>(t._sqlite3_strlike=E.vd)(i,a,c),t._sqlite3_cancel_auto_extension=i=>(t._sqlite3_cancel_auto_extension=E.wd)(i),t._sqlite3_reset_auto_extension=()=>(t._sqlite3_reset_auto_extension=E.xd)(),t._sqlite3_prepare=(i,a,c,h,m)=>(t._sqlite3_prepare=E.yd)(i,a,c,h,m),t._sqlite3_prepare16=(i,a,c,h,m)=>(t._sqlite3_prepare16=E.zd)(i,a,c,h,m),t._sqlite3_prepare16_v2=(i,a,c,h,m)=>(t._sqlite3_prepare16_v2=E.Ad)(i,a,c,h,m),t._sqlite3_prepare16_v3=(i,a,c,h,m,T)=>(t._sqlite3_prepare16_v3=E.Bd)(i,a,c,h,m,T),t._sqlite3_get_table=(i,a,c,h,m,T)=>(t._sqlite3_get_table=E.Cd)(i,a,c,h,m,T),t._sqlite3_free_table=i=>(t._sqlite3_free_table=E.Dd)(i),t._sqlite3_create_module=(i,a,c,h)=>(t._sqlite3_create_module=E.Ed)(i,a,c,h),t._sqlite3_drop_modules=(i,a)=>(t._sqlite3_drop_modules=E.Fd)(i,a),t._sqlite3_vtab_on_conflict=i=>(t._sqlite3_vtab_on_conflict=E.Gd)(i),t._sqlite3_vtab_collation=(i,a)=>(t._sqlite3_vtab_collation=E.Hd)(i,a),t._sqlite3_vtab_in=(i,a,c)=>(t._sqlite3_vtab_in=E.Id)(i,a,c),t._sqlite3_vtab_rhs_value=(i,a,c)=>(t._sqlite3_vtab_rhs_value=E.Jd)(i,a,c),t._sqlite3_keyword_name=(i,a,c)=>(t._sqlite3_keyword_name=E.Kd)(i,a,c),t._sqlite3_keyword_count=()=>(t._sqlite3_keyword_count=E.Ld)(),t._sqlite3_keyword_check=(i,a)=>(t._sqlite3_keyword_check=E.Md)(i,a),t._sqlite3_complete=i=>(t._sqlite3_complete=E.Nd)(i),t._sqlite3_complete16=i=>(t._sqlite3_complete16=E.Od)(i),t._sqlite3_libversion=()=>(t._sqlite3_libversion=E.Pd)(),t._sqlite3_libversion_number=()=>(t._sqlite3_libversion_number=E.Qd)(),t._sqlite3_threadsafe=()=>(t._sqlite3_threadsafe=E.Rd)(),t._sqlite3_initialize=()=>(t._sqlite3_initialize=E.Sd)(),t._sqlite3_config=(i,a)=>(t._sqlite3_config=E.Td)(i,a),t._sqlite3_db_mutex=i=>(t._sqlite3_db_mutex=E.Ud)(i),t._sqlite3_db_release_memory=i=>(t._sqlite3_db_release_memory=E.Vd)(i),t._sqlite3_db_cacheflush=i=>(t._sqlite3_db_cacheflush=E.Wd)(i),t._sqlite3_db_config=(i,a,c)=>(t._sqlite3_db_config=E.Xd)(i,a,c),t._sqlite3_last_insert_rowid=i=>(t._sqlite3_last_insert_rowid=E.Yd)(i),t._sqlite3_set_last_insert_rowid=(i,a,c)=>(t._sqlite3_set_last_insert_rowid=E.Zd)(i,a,c),t._sqlite3_changes64=i=>(t._sqlite3_changes64=E._d)(i),t._sqlite3_changes=i=>(t._sqlite3_changes=E.$d)(i),t._sqlite3_total_changes64=i=>(t._sqlite3_total_changes64=E.ae)(i),t._sqlite3_total_changes=i=>(t._sqlite3_total_changes=E.be)(i),t._sqlite3_txn_state=(i,a)=>(t._sqlite3_txn_state=E.ce)(i,a),t._sqlite3_close_v2=i=>(t._sqlite3_close_v2=E.de)(i),t._sqlite3_busy_handler=(i,a,c)=>(t._sqlite3_busy_handler=E.ee)(i,a,c),t._sqlite3_progress_handler=(i,a,c,h)=>(t._sqlite3_progress_handler=E.fe)(i,a,c,h),t._sqlite3_busy_timeout=(i,a)=>(t._sqlite3_busy_timeout=E.ge)(i,a),t._sqlite3_interrupt=i=>(t._sqlite3_interrupt=E.he)(i),t._sqlite3_is_interrupted=i=>(t._sqlite3_is_interrupted=E.ie)(i),t._sqlite3_create_function=(i,a,c,h,m,T,x,U)=>(t._sqlite3_create_function=E.je)(i,a,c,h,m,T,x,U),t._sqlite3_create_window_function=(i,a,c,h,m,T,x,U,F,D)=>(t._sqlite3_create_window_function=E.ke)(i,a,c,h,m,T,x,U,F,D),t._sqlite3_create_function16=(i,a,c,h,m,T,x,U)=>(t._sqlite3_create_function16=E.le)(i,a,c,h,m,T,x,U),t._sqlite3_overload_function=(i,a,c)=>(t._sqlite3_overload_function=E.me)(i,a,c),t._sqlite3_trace_v2=(i,a,c,h)=>(t._sqlite3_trace_v2=E.ne)(i,a,c,h),t._sqlite3_update_hook=(i,a,c)=>(t._sqlite3_update_hook=E.oe)(i,a,c),t._sqlite3_rollback_hook=(i,a,c)=>(t._sqlite3_rollback_hook=E.pe)(i,a,c),t._sqlite3_autovacuum_pages=(i,a,c,h)=>(t._sqlite3_autovacuum_pages=E.qe)(i,a,c,h),t._sqlite3_wal_autocheckpoint=(i,a)=>(t._sqlite3_wal_autocheckpoint=E.re)(i,a),t._sqlite3_wal_hook=(i,a,c)=>(t._sqlite3_wal_hook=E.se)(i,a,c),t._sqlite3_wal_checkpoint_v2=(i,a,c,h,m)=>(t._sqlite3_wal_checkpoint_v2=E.te)(i,a,c,h,m),t._sqlite3_wal_checkpoint=(i,a)=>(t._sqlite3_wal_checkpoint=E.ue)(i,a),t._sqlite3_error_offset=i=>(t._sqlite3_error_offset=E.ve)(i),t._sqlite3_errmsg16=i=>(t._sqlite3_errmsg16=E.we)(i),t._sqlite3_extended_errcode=i=>(t._sqlite3_extended_errcode=E.xe)(i),t._sqlite3_system_errno=i=>(t._sqlite3_system_errno=E.ye)(i),t._sqlite3_errstr=i=>(t._sqlite3_errstr=E.ze)(i),t._sqlite3_limit=(i,a,c)=>(t._sqlite3_limit=E.Ae)(i,a,c),t._sqlite3_open_v2=(i,a,c,h)=>(t._sqlite3_open_v2=E.Be)(i,a,c,h),t._sqlite3_open16=(i,a)=>(t._sqlite3_open16=E.Ce)(i,a),t._sqlite3_create_collation=(i,a,c,h,m)=>(t._sqlite3_create_collation=E.De)(i,a,c,h,m),t._sqlite3_create_collation_v2=(i,a,c,h,m,T)=>(t._sqlite3_create_collation_v2=E.Ee)(i,a,c,h,m,T),t._sqlite3_create_collation16=(i,a,c,h,m)=>(t._sqlite3_create_collation16=E.Fe)(i,a,c,h,m),t._sqlite3_collation_needed=(i,a,c)=>(t._sqlite3_collation_needed=E.Ge)(i,a,c),t._sqlite3_collation_needed16=(i,a,c)=>(t._sqlite3_collation_needed16=E.He)(i,a,c),t._sqlite3_get_clientdata=(i,a)=>(t._sqlite3_get_clientdata=E.Ie)(i,a),t._sqlite3_set_clientdata=(i,a,c,h)=>(t._sqlite3_set_clientdata=E.Je)(i,a,c,h),t._sqlite3_table_column_metadata=(i,a,c,h,m,T,x,U,F)=>(t._sqlite3_table_column_metadata=E.Ke)(i,a,c,h,m,T,x,U,F),t._sqlite3_sleep=i=>(t._sqlite3_sleep=E.Le)(i),t._sqlite3_extended_result_codes=(i,a)=>(t._sqlite3_extended_result_codes=E.Me)(i,a),t._sqlite3_file_control=(i,a,c,h)=>(t._sqlite3_file_control=E.Ne)(i,a,c,h),t._sqlite3_test_control=(i,a)=>(t._sqlite3_test_control=E.Oe)(i,a),t._sqlite3_create_filename=(i,a,c,h,m)=>(t._sqlite3_create_filename=E.Pe)(i,a,c,h,m),t._sqlite3_free_filename=i=>(t._sqlite3_free_filename=E.Qe)(i),t._sqlite3_uri_parameter=(i,a)=>(t._sqlite3_uri_parameter=E.Re)(i,a),t._sqlite3_uri_key=(i,a)=>(t._sqlite3_uri_key=E.Se)(i,a),t._sqlite3_uri_boolean=(i,a,c)=>(t._sqlite3_uri_boolean=E.Te)(i,a,c),t._sqlite3_uri_int64=(i,a,c,h)=>(t._sqlite3_uri_int64=E.Ue)(i,a,c,h),t._sqlite3_filename_database=i=>(t._sqlite3_filename_database=E.Ve)(i),t._sqlite3_filename_journal=i=>(t._sqlite3_filename_journal=E.We)(i),t._sqlite3_filename_wal=i=>(t._sqlite3_filename_wal=E.Xe)(i),t._sqlite3_db_name=(i,a)=>(t._sqlite3_db_name=E.Ye)(i,a),t._sqlite3_db_filename=(i,a)=>(t._sqlite3_db_filename=E.Ze)(i,a),t._sqlite3_db_readonly=(i,a)=>(t._sqlite3_db_readonly=E._e)(i,a),t._sqlite3_compileoption_used=i=>(t._sqlite3_compileoption_used=E.$e)(i),t._sqlite3_compileoption_get=i=>(t._sqlite3_compileoption_get=E.af)(i),t._sqlite3_sourceid=()=>(t._sqlite3_sourceid=E.bf)();var nl=t._malloc=i=>(nl=t._malloc=E.cf)(i),il=t._free=i=>(il=t._free=E.df)(i);t._RegisterExtensionFunctions=i=>(t._RegisterExtensionFunctions=E.ef)(i),t._set_authorizer=i=>(t._set_authorizer=E.ff)(i),t._create_function=(i,a,c,h,m,T)=>(t._create_function=E.gf)(i,a,c,h,m,T),t._on_tables_changed=(i,a,c,h,m,T)=>(t._on_tables_changed=E.hf)(i,a,c,h,m,T),t._register_table_update_hook=i=>(t._register_table_update_hook=E.jf)(i),t._create_module=(i,a,c,h)=>(t._create_module=E.kf)(i,a,c,h),t._progress_handler=(i,a)=>(t._progress_handler=E.lf)(i,a),t._register_vfs=(i,a,c,h)=>(t._register_vfs=E.mf)(i,a,c,h),t._getSqliteFree=()=>(t._getSqliteFree=E.nf)();var sl=t._main=(i,a)=>(sl=t._main=E.of)(i,a);t._setup_powersync=()=>(t._setup_powersync=E.pf)();var ol=(i,a)=>(ol=E.rf)(i,a),al=()=>(al=E.sf)(),ll=i=>(ll=E.tf)(i),ss=i=>(ss=E.uf)(i),cl=()=>(cl=E.vf)(),ul=i=>(ul=E.wf)(i),fl=()=>(fl=E.xf)(),hl=i=>(hl=E.yf)(i),dl=()=>(dl=E.zf)();t._sqlite3_version=44971,t.getTempRet0=()=>al(),t.ccall=gt,t.cwrap=(i,a,c,h)=>{var m=!c||c.every(T=>T==="number"||T==="boolean");return a!=="string"&&m&&!h?t["_"+i]:(...T)=>gt(i,a,c,T,h)},t.addFunction=(i,a)=>{if(!Or){Or=new WeakMap;var c=or.length;if(Or)for(var h=0;h<0+c;h++){var m=or.get(h);m&&Or.set(m,h)}}if(c=Or.get(i)||0)return c;if(tl.length)c=tl.pop();else{try{or.grow(1)}catch(U){throw U instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":U}c=or.length-1}try{or.set(c,i)}catch(U){if(!(U instanceof TypeError))throw U;if(typeof WebAssembly.Function=="function"){h=WebAssembly.Function,m={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var T={parameters:[],results:a[0]=="v"?[]:[m[a[0]]]},x=1;x<a.length;++x)T.parameters.push(m[a[x]]);a=new h(T,i)}else{for(h=[1],m=a.slice(0,1),a=a.slice(1),T={i:127,p:127,j:126,f:125,d:124,e:111},h.push(96),x=a.length,128>x?h.push(x):h.push(x%128|128,x>>7),x=0;x<a.length;++x)h.push(T[a[x]]);m=="v"?h.push(0):h.push(1,T[m]),a=[0,97,115,109,1,0,0,0,1],m=h.length,128>m?a.push(m):a.push(m%128|128,m>>7),a.push(...h),a.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),a=new WebAssembly.Module(new Uint8Array(a)),a=new WebAssembly.Instance(a,{e:{f:i}}).exports.f}or.set(c,a)}return Or.set(i,c),c},t.setValue=dt,t.getValue=Re,t.UTF8ToString=(i,a)=>i?he(v,i,a):"",t.stringToUTF8=(i,a,c)=>pt(i,v,a,c),t.lengthBytesUTF8=vr,t.intArrayFromString=$o,t.intArrayToString=function(i){for(var a=[],c=0;c<i.length;c++){var h=i[c];255<h&&(h&=255),a.push(String.fromCharCode(h))}return a.join("")},t.AsciiToString=i=>{for(var a="";;){var c=v[i++];if(!c)return a;a+=String.fromCharCode(c)}},t.UTF16ToString=(i,a)=>{for(var c=i>>1,h=c+a/2;!(c>=h)&&Q[c];)++c;if(c<<=1,32<c-i&&rl)return rl.decode(v.subarray(i,c));for(c="",h=0;!(h>=a/2);++h){var m=k[i+2*h>>1];if(m==0)break;c+=String.fromCharCode(m)}return c},t.stringToUTF16=(i,a,c)=>{if(c??=2147483647,2>c)return 0;c-=2;var h=a;c=c<2*i.length?c/2:i.length;for(var m=0;m<c;++m)k[a>>1]=i.charCodeAt(m),a+=2;return k[a>>1]=0,a-h},t.UTF32ToString=(i,a)=>{for(var c=0,h="";!(c>=a/4);){var m=N[i+4*c>>2];if(m==0)break;++c,65536<=m?(m-=65536,h+=String.fromCharCode(55296|m>>10,56320|m&1023)):h+=String.fromCharCode(m)}return h},t.stringToUTF32=(i,a,c)=>{if(c??=2147483647,4>c)return 0;var h=a;c=h+c-4;for(var m=0;m<i.length;++m){var T=i.charCodeAt(m);if(55296<=T&&57343>=T){var x=i.charCodeAt(++m);T=65536+((T&1023)<<10)|x&1023}if(N[a>>2]=T,a+=4,a+4>c)break}return N[a>>2]=0,a-h},t.writeArrayToMemory=(i,a)=>{A.set(i,a)};var Vn;Se=function i(){Vn||pl(),Vn||(Se=i)};function pl(){function i(){if(!Vn&&(Vn=!0,t.calledRun=!0,!y)){if(t.noFSInit||aa||(aa=!0,t.stdin=t.stdin,t.stdout=t.stdout,t.stderr=t.stderr,t.stdin?ln("stdin",t.stdin):Yi("/dev/tty","/dev/stdin"),t.stdout?ln("stdout",null,t.stdout):Yi("/dev/tty","/dev/stdout"),t.stderr?ln("stderr",null,t.stderr):Yi("/dev/tty1","/dev/stderr"),kn("/dev/stdin",0),kn("/dev/stdout",1),kn("/dev/stderr",1)),Wo=!1,Cn($),Cn(Y),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),_l){var a=sl;try{var c=a(0,0);b=c,Ga(c)}catch(h){rs(h)}}if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)a=t.postRun.shift(),ae.unshift(a);Cn(ae)}}if(!(0<Ce)){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)ie();Cn(O),0<Ce||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),i()},1)):i())}}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();var _l=!0;return t.noInitialRun&&(_l=!1),pl(),o}})(),xg=Og});var qi,rw,xo=ar(()=>{Fn();Fn();qi=class{mxPathName=64;xClose(e){return 10}xRead(e,t,n){return 10}xWrite(e,t,n){return 10}xTruncate(e,t){return 10}xSync(e,t){return 0}xFileSize(e,t){return 10}xLock(e,t){return 0}xUnlock(e,t){return 0}xCheckReservedLock(e,t){return t.setInt32(0,0,!0),0}xFileControl(e,t,n){return 12}xSectorSize(e){return 512}xDeviceCharacteristics(e){return 0}xOpen(e,t,n,s){return 14}xDelete(e,t){return 10}xAccess(e,t,n){return 10}handleAsync(e){return e()}},rw=[256,2048,512,4096,1024,8192,16384].reduce((r,e)=>r|e)});var Mg,Ao,ki,rh=ar(()=>{xo();Mg=7,Ao=class{get state(){return this.#e}#e=0;timeoutMillis=0;#n=new Map;#t=Promise.resolve(0);async lock(e){return this.#r(this.#o,e)}async unlock(e){return this.#r(this.#s,e)}async isSomewhereReserved(){throw new Error("unimplemented")}async#r(e,t){let n=t&Mg;try{let s=()=>e.call(this,n);return await(this.#t=this.#t.then(s,s)),this.#e=n,0}catch(s){return s.name==="AbortError"?5:(console.error(s),3850)}}async#o(e){if(e===this.#e)return 0;switch(this.#e){case 0:switch(e){case 1:return this._NONEtoSHARED();default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}case 1:switch(e){case 2:return this._SHAREDtoRESERVED();case 4:return this._SHAREDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}case 2:switch(e){case 4:return this._RESERVEDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}}async#s(e){if(e===this.#e)return 0;switch(this.#e){case 4:switch(e){case 1:return this._EXCLUSIVEtoSHARED();case 0:return this._EXCLUSIVEtoNONE();default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}case 2:switch(e){case 1:return this._RESERVEDtoSHARED();case 0:return this._RESERVEDtoNONE();default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}case 1:switch(e){case 0:return this._SHAREDtoNONE();default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}default:throw new Error(`unexpected transition ${this.#e} -> ${e}`)}}async _NONEtoSHARED(){}async _SHAREDtoEXCLUSIVE(){await this._SHAREDtoRESERVED(),await this._RESERVEDtoEXCLUSIVE()}async _SHAREDtoRESERVED(){}async _RESERVEDtoEXCLUSIVE(){}async _EXCLUSIVEtoRESERVED(){}async _EXCLUSIVEtoSHARED(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED()}async _EXCLUSIVEtoNONE(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _RESERVEDtoSHARED(){}async _RESERVEDtoNONE(){await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _SHAREDtoNONE(){}_acquireWebLock(e,t){return new Promise(async(n,s)=>{try{await navigator.locks.request(e,t,o=>{if(n(o),o)return new Promise(l=>this.#n.set(e,l))})}catch(o){s(o)}})}_releaseWebLock(e){this.#n.get(e)?.(),this.#n.delete(e)}async _pollWebLock(e){return(await navigator.locks.query()).held.find(({name:n})=>n===e)?.mode}_getTimeoutSignal(){if(this.timeoutMillis){let e=new AbortController;return setTimeout(()=>e.abort(),this.timeoutMillis),e.signal}}},ki=class extends Ao{constructor(e){super(),this._lockName=e+"-outer",this._reservedName=e+"-reserved"}async isSomewhereReserved(){return await this._pollWebLock(this._reservedName)==="exclusive"}async _NONEtoSHARED(){await this._acquireWebLock(this._lockName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _SHAREDtoRESERVED(){await this._acquireWebLock(this._reservedName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _RESERVEDtoSHARED(){this._releaseWebLock(this._reservedName)}async _SHAREDtoNONE(){this._releaseWebLock(this._lockName)}}});function ut(...r){}function nr(r){return new Promise((e,t)=>{r.addEventListener("success",()=>e(r.result)),r.addEventListener("error",()=>t(r.error))})}var nh,No,Pi,Fo,Co,ih=ar(()=>{nh=0,No=new WeakMap;Pi=class{#e;#n;#t;#r=null;#o=0;#s=Promise.resolve();#i=Promise.resolve();constructor(e,t={durability:"default"}){this.#n=Promise.resolve(e).then(n=>this.#e=n),this.#t=t}async close(){let e=this.#e??await this.#n;await this.#s,await this.sync(),e.close()}async run(e,t){let n=this.#s.then(()=>this.#l(e,t));return this.#s=n.catch(()=>{}),n}async#l(e,t){let n=this.#e??await this.#n;if(e==="readwrite"&&this.#r?.mode==="readonly")this.#r=null;else if(performance.now()-this.#o>5e3){try{this.#r?.commit()}catch(s){if(s.name!=="InvalidStateError")throw s}await new Promise(s=>setTimeout(s)),this.#r=null}for(let s=0;s<2;++s){if(!this.#r){this.#r=n.transaction(n.objectStoreNames,e,this.#t);let o=this.#o=performance.now();this.#i=this.#i.then(()=>new Promise((l,d)=>{this.#r.addEventListener("complete",f=>{l(),this.#r===f.target&&(this.#r=null),ut(`transaction ${No.get(f.target)} complete`)}),this.#r.addEventListener("abort",f=>{console.warn("tx abort",(performance.now()-o)/1e3);let u=f.target.error;d(u),this.#r===f.target&&(this.#r=null),ut(`transaction ${No.get(f.target)} aborted`,u)})})),ut(`new transaction ${nh} ${e}`),No.set(this.#r,nh++)}try{let o=Object.fromEntries(Array.from(n.objectStoreNames,l=>[l,new Fo(this.#r.objectStore(l))]));return await t(o)}catch(o){if(this.#r=null,s)throw o}}}async sync(){await this.#s,await this.#i,this.#i=Promise.resolve()}};Fo=class{#e;constructor(e){this.#e=e}get(e){ut(`get ${this.#e.name}`,e);let t=this.#e.get(e);return nr(t)}getAll(e,t){ut(`getAll ${this.#e.name}`,e,t);let n=this.#e.getAll(e,t);return nr(n)}getKey(e){ut(`getKey ${this.#e.name}`,e);let t=this.#e.getKey(e);return nr(t)}getAllKeys(e,t){ut(`getAllKeys ${this.#e.name}`,e,t);let n=this.#e.getAllKeys(e,t);return nr(n)}put(e,t){ut(`put ${this.#e.name}`,e,t);let n=this.#e.put(e,t);return nr(n)}delete(e){ut(`delete ${this.#e.name}`,e);let t=this.#e.delete(e);return nr(t)}clear(){ut(`clear ${this.#e.name}`);let e=this.#e.clear();return nr(e)}index(e){return new Co(this.#e.index(e))}},Co=class{#e;constructor(e){this.#e=e}getAllKeys(e,t){ut(`IDBIndex.getAllKeys ${this.#e.objectStore.name}<${this.#e.name}>`,e,t);let n=this.#e.getAllKeys(e,t);return nr(n)}}});var ah={};as(ah,{IDBBatchAtomicVFS:()=>Bo});function Fe(...r){}function Gg(r){return new Promise((e,t)=>{let n=globalThis.indexedDB.open(r,5);n.addEventListener("upgradeneeded",function(){n.result.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"])}),n.addEventListener("success",()=>{e(n.result)}),n.addEventListener("error",()=>{t(n.error)})})}var Kg,sh,oh,Bo,lh=ar(()=>{xo();rh();ih();Kg=512,sh=3e3,oh={durability:"default",purge:"deferred",purgeAtLeast:16};Bo=class extends qi{#e;#n=new Map;#t;#r=new Set;#o=performance.now();#s=new Set;#i=null;constructor(e="wa-sqlite",t=oh){super(),this.name=e,this.#e=Object.assign({},oh,t),this.#t=new Pi(Gg(e),{durability:this.#e.durability})}async close(){for(let e of this.#n.keys())await this.xClose(e);await this.#t?.close(),this.#t=null}xOpen(e,t,n,s){let o=this.handleAsync(async()=>{e===null&&(e=`null_${t}`),Fe(`xOpen ${e} 0x${t.toString(16)} 0x${n.toString(16)}`);try{let l=new URL(e,"http://localhost/"),d={path:l.pathname,flags:n,block0:null,isMetadataChanged:!0,locks:new ki(l.pathname)};return this.#n.set(t,d),await this.#t.run("readwrite",async({blocks:f})=>{if(d.block0=await f.get(this.#a(d,0)),!d.block0)if(n&4)d.block0={path:d.path,offset:0,version:0,data:new Uint8Array(0),fileSize:0},f.put(d.block0);else throw new Error(`file not found: ${d.path}`)}),(s.buffer.detached||!s.buffer.byteLength)&&(s=new DataView(new ArrayBuffer(4)),this.#i=f=>{f.setInt32(0,s.getInt32(0,!0),!0)}),s.setInt32(0,n&1,!0),0}catch(l){return console.error(l),14}});return this.#i?.(s),this.#i=null,o}xClose(e){return this.handleAsync(async()=>{try{let t=this.#n.get(e);return t&&(Fe(`xClose ${t.path}`),this.#n.delete(e),t.flags&8&&this.#t.run("readwrite",({blocks:n})=>{n.delete(IDBKeyRange.bound([t.path],[t.path,[]]))})),0}catch(t){return console.error(t),10}})}xRead(e,t,n){let s=t.byteLength,o=this.handleAsync(async()=>{let l=this.#n.get(e);Fe(`xRead ${l.path} ${t.byteLength} ${n}`);try{return await this.#t.run("readonly",async({blocks:f})=>{(t.buffer.detached||!t.buffer.byteLength)&&(t=new Uint8Array(s),this.#i=p=>p.set(t));let u=0;for(;u<t.byteLength;){let p=n+u,_=p<l.block0.data.byteLength?l.block0:await f.get(this.#a(l,-p));if(!_||_.data.byteLength-_.offset<=p)return t.fill(0,u),522;let I=t.subarray(u),R=p+_.offset,L=Math.min(Math.max(_.data.byteLength-R,0),I.byteLength);I.set(_.data.subarray(R,R+L)),u+=L}return 0})}catch(d){return console.error(d),10}});return this.#i?.(t),this.#i=null,o}xWrite(e,t,n){let s=this.#s.has(e);if(s||performance.now()-this.#o>sh){let o=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&this.#s.add(e),await new Promise(d=>setTimeout(d));let l=this.#l(e,t.slice(),n);return this.#o=performance.now(),l});return s&&this.#s.delete(e),o}return this.#l(e,t,n)}#l(e,t,n){let s=this.#n.get(e);Fe(`xWrite ${s.path} ${t.byteLength} ${n}`);try{let o=s.block0.fileSize;s.block0.fileSize<n+t.byteLength&&(s.block0.fileSize=n+t.byteLength,s.isMetadataChanged=!0);let l=n===0?s.block0:{path:s.path,offset:-n,version:s.block0.version,data:null};return l.data=t.slice(),s.changedPages?(o===s.block0.fileSize&&s.changedPages.add(-n),n!==0&&this.#t.run("readwrite",({blocks:d})=>d.put(l))):this.#t.run("readwrite",({blocks:d})=>d.put(l)),s.isMetadataChanged=n===0?!1:s.isMetadataChanged,0}catch(o){return console.error(o),10}}xTruncate(e,t){let n=this.#n.get(e);Fe(`xTruncate ${n.path} ${t}`);try{Object.assign(n.block0,{fileSize:t,data:n.block0.data.slice(0,t)});let s=Object.assign({},n.block0);return this.#t.run("readwrite",({blocks:o})=>{o.delete(this.#a(n,-1/0,-t)),o.put(s)}),0}catch(s){return console.error(s),10}}xSync(e,t){let n=this.#s.has(e);if(n||this.#e.durability!=="relaxed"||performance.now()-this.#o>sh){let o=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&this.#s.add(e);let l=await this.#c(e,t);return this.#o=performance.now(),l});return n&&this.#s.delete(e),o}let s=this.#n.get(e);return Fe(`xSync ${s.path} ${t}`),0}async#c(e,t){let n=this.#n.get(e);Fe(`xSync ${n.path} ${t}`);try{n.isMetadataChanged&&(this.#t.run("readwrite",async({blocks:s})=>{await s.put(n.block0)}),n.isMetadataChanged=!1),await this.#t.sync()}catch(s){return console.error(s),10}return 0}xFileSize(e,t){let n=this.#n.get(e);return Fe(`xFileSize ${n.path}`),t.setBigInt64(0,BigInt(n.block0.fileSize),!0),0}xLock(e,t){return this.handleAsync(async()=>{let n=this.#n.get(e);Fe(`xLock ${n.path} ${t}`);try{let s=await n.locks.lock(t);return s===0&&n.locks.state===1&&(n.block0=await this.#t.run("readonly",({blocks:o})=>o.get(this.#a(n,0)))),s}catch(s){return console.error(s),10}})}xUnlock(e,t){return this.handleAsync(async()=>{let n=this.#n.get(e);Fe(`xUnlock ${n.path} ${t}`);try{return n.locks.unlock(t)}catch(s){return console.error(s),10}})}xCheckReservedLock(e,t){let n=this.handleAsync(async()=>{let s=this.#n.get(e);Fe(`xCheckReservedLock ${s.path}`);let o=await s.locks.isSomewhereReserved();function l(d){}return(t.buffer.detached||!t.buffer.byteLength)&&(t=new DataView(new ArrayBuffer(4)),this.#i=d=>{d.setInt32(0,t.getInt32(0,!0),!0)}),t.setInt32(0,o?1:0,!0),0});return this.#i?.(t),this.#i=null,n}xSectorSize(e){return Fe("xSectorSize"),Kg}xDeviceCharacteristics(e){return Fe("xDeviceCharacteristics"),19968}xFileControl(e,t,n){let s=this.#n.get(e);switch(Fe(`xFileControl ${s.path} ${t}`),t){case 11:return s.overwrite=!0,0;case 21:if(s.overwrite)try{return this.handleAsync(async()=>(await this.#f(s),0))}catch(o){return console.error(o),10}if(s.isMetadataChanged)try{this.#t.run("readwrite",async({blocks:o})=>{await o.put(s.block0)}),s.isMetadataChanged=!1}catch(o){return console.error(o),10}return 0;case 22:return s.overwrite=!1,0;case 31:return this.handleAsync(async()=>{try{return s.block0.version--,s.changedPages=new Set,this.#t.run("readwrite",async({blocks:o})=>{let l=await o.index("version").getAllKeys(IDBKeyRange.bound([s.path],[s.path,s.block0.version]));for(let d of l)o.delete(d)}),0}catch(o){return console.error(o),10}});case 32:try{let o=Object.assign({},s.block0);o.data=o.data.slice();let l=s.changedPages;return s.changedPages=null,s.isMetadataChanged=!1,this.#t.run("readwrite",async({blocks:d})=>{d.put(o);let f=await d.get([s.path,"purge",0])??{path:s.path,offset:"purge",version:0,data:new Map,count:0};f.count+=l.size;for(let u of l)f.data.set(u,o.version);d.put(f),this.#u(s.path,f.count)}),0}catch(o){return console.error(o),10}case 33:return this.handleAsync(async()=>{try{return s.changedPages=null,s.isMetadataChanged=!1,s.block0=await this.#t.run("readonly",({blocks:o})=>o.get([s.path,0,s.block0.version+1])),0}catch(o){return console.error(o),10}});default:return 12}}xAccess(e,t,n){let s=this.handleAsync(async()=>{try{let o=new URL(e,"file://localhost/").pathname;Fe(`xAccess ${o} ${t}`);let l=await this.#t.run("readonly",({blocks:d})=>d.getKey(this.#a({path:o},0)));return(n.buffer.detached||!n.buffer.byteLength)&&(n=new DataView(new ArrayBuffer(4)),this.#i=d=>{d.setInt32(0,n.getInt32(0,!0),!0)}),n.setInt32(0,l?1:0,!0),0}catch(o){return console.error(o),10}});return this.#i?.(n),this.#i=null,s}xDelete(e,t){return this.handleAsync(async()=>{let n=new URL(e,"file://localhost/").pathname;Fe(`xDelete ${n} ${t}`);try{return this.#t.run("readwrite",({blocks:s})=>s.delete(IDBKeyRange.bound([n],[n,[]]))),t&&await this.#t.sync(),0}catch(s){return console.error(s),10}})}async purge(e){let t=Date.now();await this.#t.run("readwrite",async({blocks:n})=>{let s=await n.get([e,"purge",0]);if(s){for(let[o,l]of s.data)n.delete(IDBKeyRange.bound([e,o,l],[e,o,1/0],!0,!1));await n.delete([e,"purge",0])}Fe(`purge ${e} ${s?.data.size??0} pages in ${Date.now()-t} ms`)})}#u(e,t){this.#e.purge==="manual"||this.#r.has(e)||t<this.#e.purgeAtLeast||(globalThis.requestIdleCallback?globalThis.requestIdleCallback(()=>{this.purge(e),this.#r.delete(e)}):setTimeout(()=>{this.purge(e),this.#r.delete(e)}),this.#r.add(e))}#a(e,t,n=0){let s=!t||-t<e.block0.data.length?-1/0:e.block0.version;return IDBKeyRange.bound([e.path,t,s],[e.path,n,1/0])}async#f(e){let t=e.block0.data.length;if(t<18)return;let n=new DataView(e.block0.data.buffer,e.block0.data.byteOffset),s=n.getUint16(16);if(s===1&&(s=65536),s===t)return;let o=Math.max(t,s),l=o/t,d=o/s,u=n.getUint32(28)*s,p=e.block0.version;await this.#t.run("readwrite",async({blocks:_})=>{let I=await _.index("version").getAllKeys(IDBKeyRange.bound([e.path,p+1],[e.path,1/0]));for(let R of I)_.delete(R);_.delete([e.path,"purge",0]);for(let R=0;R<u;R+=o){let L=await _.getAll(IDBKeyRange.lowerBound([e.path,-(R+o),1/0]),l);for(let g of L)_.delete([g.path,g.offset,g.version]);if(d===1){let g=new Uint8Array(s);for(let y of L)g.set(y.data,-(R+y.offset));let w={path:e.path,offset:-R,version:p,data:g};w.offset===0&&(w.fileSize=u,e.block0=w),_.put(w)}else{let g=L[0];for(let w=0;w<d;++w){let y=-(R+w*s);if(-y>=u)break;let b={path:g.path,offset:y,version:p,data:g.data.subarray(w*s,(w+1)*s)};b.offset===0&&(b.fileSize=u,e.block0=b),_.put(b)}}}})}}});var gl=Symbol("Comlink.proxy"),jh=Symbol("Comlink.endpoint"),us=Symbol("Comlink.releaseProxy"),ls=Symbol("Comlink.finalizer"),Wn=Symbol("Comlink.thrown"),yl=r=>typeof r=="object"&&r!==null||typeof r=="function",Vh={canHandle:r=>yl(r)&&r[gl],serialize(r){let{port1:e,port2:t}=new MessageChannel;return Jn(r,e),[t,[t]]},deserialize(r){return r.start(),cr(r)}},Hh={canHandle:r=>yl(r)&&Wn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},El=new Map([["proxy",Vh],["throw",Hh]]);function Wh(r,e){for(let t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function Jn(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(s){if(!s||!s.data)return;if(!Wh(t,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}let{id:o,type:l,path:d}=Object.assign({path:[]},s.data),f=(s.data.argumentList||[]).map(lr),u;try{let p=d.slice(0,-1).reduce((I,R)=>I[R],r),_=d.reduce((I,R)=>I[R],r);switch(l){case"GET":u=_;break;case"SET":p[d.slice(-1)[0]]=lr(s.data.value),u=!0;break;case"APPLY":u=_.apply(p,f);break;case"CONSTRUCT":{let I=new _(...f);u=Rt(I)}break;case"ENDPOINT":{let{port1:I,port2:R}=new MessageChannel;Jn(r,R),u=Yh(I,[I])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[Wn]:0}}Promise.resolve(u).catch(p=>({value:p,[Wn]:0})).then(p=>{let[_,I]=Xn(p);e.postMessage(Object.assign(Object.assign({},_),{id:o}),I),l==="RELEASE"&&(e.removeEventListener("message",n),wl(e),ls in r&&typeof r[ls]=="function"&&r[ls]())}).catch(p=>{let[_,I]=Xn({value:new TypeError("Unserializable return value"),[Wn]:0});e.postMessage(Object.assign(Object.assign({},_),{id:o}),I)})}),e.start&&e.start()}function Kh(r){return r.constructor.name==="MessagePort"}function wl(r){Kh(r)&&r.close()}function cr(r,e){return cs(r,[],e)}function Hn(r){if(r)throw new Error("Proxy has been released and is not useable")}function Sl(r){return Ar(r,{type:"RELEASE"}).then(()=>{wl(r)})}var Kn=new WeakMap,Gn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{let e=(Kn.get(r)||0)-1;Kn.set(r,e),e===0&&Sl(r)});function Gh(r,e){let t=(Kn.get(e)||0)+1;Kn.set(e,t),Gn&&Gn.register(r,e,r)}function Xh(r){Gn&&Gn.unregister(r)}function cs(r,e=[],t=function(){}){let n=!1,s=new Proxy(t,{get(o,l){if(Hn(n),l===us)return()=>{Xh(s),Sl(r),n=!0};if(l==="then"){if(e.length===0)return{then:()=>s};let d=Ar(r,{type:"GET",path:e.map(f=>f.toString())}).then(lr);return d.then.bind(d)}return cs(r,[...e,l])},set(o,l,d){Hn(n);let[f,u]=Xn(d);return Ar(r,{type:"SET",path:[...e,l].map(p=>p.toString()),value:f},u).then(lr)},apply(o,l,d){Hn(n);let f=e[e.length-1];if(f===jh)return Ar(r,{type:"ENDPOINT"}).then(lr);if(f==="bind")return cs(r,e.slice(0,-1));let[u,p]=ml(d);return Ar(r,{type:"APPLY",path:e.map(_=>_.toString()),argumentList:u},p).then(lr)},construct(o,l){Hn(n);let[d,f]=ml(l);return Ar(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:d},f).then(lr)}});return Gh(s,r),s}function Jh(r){return Array.prototype.concat.apply([],r)}function ml(r){let e=r.map(Xn);return[e.map(t=>t[0]),Jh(e.map(t=>t[1]))]}var Tl=new WeakMap;function Yh(r,e){return Tl.set(r,e),r}function Rt(r){return Object.assign(r,{[gl]:!0})}function Xn(r){for(let[e,t]of El)if(t.canHandle(r)){let[n,s]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:r},Tl.get(r)||[]]}function lr(r){switch(r.type){case"HANDLER":return El.get(r.name).deserialize(r.value);case"RAW":return r.value}}function Ar(r,e,t){return new Promise(n=>{let s=Zh();r.addEventListener("message",function o(l){!l.data||!l.data.id||l.data.id!==s||(r.removeEventListener("message",o),n(l.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:s},e),t)})}function Zh(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var dh=Ie(at());var ty=new Error("timeout while waiting for mutex to become available"),ry=new Error("mutex already locked"),ed=new Error("request for lock canceled"),td=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},fs=class{constructor(e,t=ed){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return td(this,void 0,void 0,function*(){let[n,s]=yield this.acquire(t);try{return yield e(n)}finally{s()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;let s=this._value,o=t;this._value-=t,t=this._value+1,n.resolve([s,this._newReleaser(o)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}},rd=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},Nr=class{constructor(e){this._semaphore=new fs(1,e)}acquire(){return rd(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};var Ts=Ie(Rl()),yc=Ie(at()),Ec=Ie(gs());var sc;(function(r){r[r.SQLITE_INSERT=18]="SQLITE_INSERT",r[r.SQLITE_DELETE=9]="SQLITE_DELETE",r[r.SQLITE_UPDATE=23]="SQLITE_UPDATE"})(sc||(sc={}));function ys(r){return"tables"in r}function oc(r){return ys(r)?r.tables:[r.table]}var Je=class{options;constructor(e){this.options=e}get connected(){return this.options.connected??!1}get lastSyncedAt(){return this.options.lastSyncedAt}get hasSynced(){return this.options.hasSynced}get dataFlowStatus(){return this.options.dataFlow??{downloading:!1,uploading:!1}}isEqual(e){return JSON.stringify(this.options)==JSON.stringify(e.options)}getMessage(){let e=this.dataFlowStatus;return`SyncStatus<connected: ${this.connected} lastSyncedAt: ${this.lastSyncedAt} hasSynced: ${this.hasSynced}. Downloading: ${e.downloading}. Uploading: ${e.uploading}`}toJSON(){return{connected:this.connected,dataFlow:this.dataFlowStatus,lastSyncedAt:this.lastSyncedAt,hasSynced:this.hasSynced}}};var dn=class{count;size;constructor(e,t=null){this.count=e,this.size=t}toString(){return this.size==null?`UploadQueueStats<count:${this.count}>`:`UploadQueueStats<count: $count size: ${this.size/1024}kB>`}};var Me=class{listeners=new Set;constructor(){}registerListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}iterateListeners(e){for(let t of this.listeners)e(t)}async iterateAsyncListeners(e){for(let t of Array.from(this.listeners.values()))await e(t)}};async function Es(r,e,t){return new Promise((n,s)=>{let o=t?.timeoutMs,l=!1,d=o?setTimeout(()=>{l=!0,s(new Error("Timeout waiting for lock"))},o):void 0;r.runExclusive(async()=>{if(d&&clearTimeout(d),!l)try{n(await e())}catch(f){s(f)}})})}function ac(r){return`"${r.replaceAll('"','""')}"`}var Le;(function(r){r.DATA="ps_data",r.CRUD="ps_crud",r.BUCKETS="ps_buckets",r.OPLOG="ps_oplog",r.UNTYPED="ps_untyped"})(Le||(Le={}));var Fr=class{crud;haveMore;complete;constructor(e,t,n){this.crud=e,this.haveMore=t,this.complete=n}};var lc;(function(r){r.PUT="PUT",r.PATCH="PATCH",r.DELETE="DELETE"})(lc||(lc={}));var Qt=class r{clientId;id;op;opData;table;transactionId;static fromRow(e){let t=JSON.parse(e.data);return new r(parseInt(e.id),t.op,t.type,t.id,e.tx_id,t.data)}constructor(e,t,n,s,o,l){this.clientId=e,this.id=s,this.op=t,this.opData=l,this.table=n,this.transactionId=o}toJSON(){return{op_id:this.clientId,op:this.op,type:this.table,id:this.id,tx_id:this.transactionId,data:this.opData}}equals(e){return JSON.stringify(this.toComparisonArray())==JSON.stringify(e.toComparisonArray())}hashCode(){return JSON.stringify(this.toComparisonArray())}toComparisonArray(){return[this.transactionId,this.clientId,this.op,this.table,this.id,this.opData]}};var ri=class extends Fr{crud;complete;transactionId;constructor(e,t,n){super(e,!1,t),this.crud=e,this.complete=t,this.transactionId=n}};var pc=Ie(gs()),_c=Ie(at());function cc(r){return r.data!=null}function uc(r){return r.token_expires_in!=null}function fc(r){return r.checkpoint!=null}function hc(r){return r.checkpoint_complete!=null}function dc(r){return r.checkpoint_diff!=null}var ur;(function(r){r[r.CLEAR=1]="CLEAR",r[r.MOVE=2]="MOVE",r[r.PUT=3]="PUT",r[r.REMOVE=4]="REMOVE"})(ur||(ur={}));var ni=class r{value;static fromJSON(e){return new r(ur[e])}constructor(e){this.value=e}toJSON(){return Object.entries(ur).find(([,e])=>e===this.value)[0]}};var ii=class r{op_id;op;checksum;subkey;object_type;object_id;data;static fromRow(e){return new r(e.op_id,ni.fromJSON(e.op),e.checksum,typeof e.subkey=="string"?e.subkey:JSON.stringify(e.subkey),e.object_type,e.object_id,e.data)}constructor(e,t,n,s,o,l,d){this.op_id=e,this.op=t,this.checksum=n,this.subkey=s,this.object_type=o,this.object_id=l,this.data=d}toJSON(){return{op_id:this.op_id,op:this.op.toJSON(),object_type:this.object_type,object_id:this.object_id,checksum:this.checksum,data:this.data,subkey:JSON.stringify(this.subkey)}}};var pn=class r{bucket;data;has_more;after;next_after;static fromRow(e){return new r(e.bucket,e.data.map(t=>ii.fromRow(t)),e.has_more??!1,e.after,e.next_after)}constructor(e,t,n,s,o){this.bucket=e,this.data=t,this.has_more=n,this.after=s,this.next_after=o}toJSON(){return{bucket:this.bucket,has_more:this.has_more,after:this.after,next_after:this.next_after,data:this.data.map(e=>e.toJSON())}}};var tt=class r extends Error{reason;constructor(e){super(e),this.reason=e,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,r)}};var Cr;(function(r){r.CRUD="crud",r.SYNC="sync"})(Cr||(Cr={}));var si;(function(r){r.HTTP="http",r.WEB_SOCKET="web-socket"})(si||(si={}));var ws=1e3,Xd={retryDelayMs:5e3,logger:_c.default.get("PowerSyncStream"),crudUploadThrottleMs:ws},Jd={connectionMethod:si.HTTP},oi=class extends Me{_lastSyncedAt;options;abortController;crudUpdateListener;streamingSyncPromise;syncStatus;triggerCrudUpload;constructor(e){super(),this.options={...Xd,...e},this.syncStatus=new Je({connected:!1,lastSyncedAt:void 0,dataFlow:{uploading:!1,downloading:!1}}),this.abortController=null,this.triggerCrudUpload=(0,pc.default)(()=>{!this.syncStatus.connected||this.syncStatus.dataFlowStatus.uploading||this._uploadAllCrud()},this.options.crudUploadThrottleMs,{trailing:!0})}async waitForReady(){}waitForStatus(e){return new Promise(t=>{let n=this.registerListener({statusChanged:s=>{let o=(l,d)=>Object.entries(l).every(([f,u])=>{let p=d[f];return typeof u=="object"&&typeof p=="object"?o(u,p):u==p});o(e,s.toJSON())&&(t(),n?.())}})})}get lastSyncedAt(){let e=this.syncStatus.lastSyncedAt;return e&&new Date(e)}get isConnected(){return this.syncStatus.connected}get logger(){return this.options.logger}async dispose(){this.crudUpdateListener?.(),this.crudUpdateListener=void 0}async hasCompletedSync(){return this.options.adapter.hasCompletedSync()}async getWriteCheckpoint(){return(await this.options.remote.get("/write-checkpoint2.json")).data.write_checkpoint}async _uploadAllCrud(){return this.obtainLock({type:Cr.CRUD,callback:async()=>{for(this.updateSyncStatus({dataFlow:{uploading:!0}});;)try{if(await this.uploadCrudBatch())break}catch{this.updateSyncStatus({connected:!1,dataFlow:{uploading:!1}}),await this.delayRetry();break}finally{this.updateSyncStatus({dataFlow:{uploading:!1}})}}})}async uploadCrudBatch(){return await this.options.adapter.hasCrud()?(await this.options.uploadCrud(),!1):(await this.options.adapter.updateLocalTarget(()=>this.getWriteCheckpoint()),!0)}async connect(e){return this.abortController&&await this.disconnect(),this.abortController=new AbortController,this.streamingSyncPromise=this.streamingSync(this.abortController.signal,e),new Promise(t=>{let n=this.registerListener({statusUpdated:s=>{typeof s.connected>"u"||(s.connected==!1&&this.logger.warn("Initial connect attempt did not successfully connect to server"),t(),n())}})})}async disconnect(){if(this.abortController){this.abortController.signal.aborted||this.abortController.abort(new tt("Disconnect has been requested"));try{await this.streamingSyncPromise}catch(e){this.logger.warn(e)}this.streamingSyncPromise=void 0,this.abortController=null,this.updateSyncStatus({connected:!1})}}async streamingSync(e,t){e||(this.abortController=new AbortController,e=this.abortController.signal),this.crudUpdateListener=this.options.adapter.registerListener({crudUpdate:()=>this.triggerCrudUpload()});let n=new AbortController;for(e.addEventListener("abort",()=>{n.abort(e?.reason??new tt("Received command to disconnect from upstream")),this.crudUpdateListener?.(),this.crudUpdateListener=void 0,this.updateSyncStatus({connected:!1,dataFlow:{downloading:!1}})});;)try{if(e?.aborted)break;let{retry:s}=await this.streamingSyncIteration(n.signal,t);if(!s)break}catch(s){s instanceof tt?this.logger.warn(s):this.logger.error(s),await this.delayRetry()}finally{e.aborted||(n.abort(new tt("Closing sync stream network requests before retry.")),n=new AbortController),this.updateSyncStatus({connected:!1})}this.updateSyncStatus({connected:!1})}async streamingSyncIteration(e,t){return await this.obtainLock({type:Cr.SYNC,signal:e,callback:async()=>{let n={...Jd,...t??{}};this.logger.debug("Streaming sync iteration started"),this.options.adapter.startSession();let s=await this.options.adapter.getBucketStates(),o=new Map;s.forEach(R=>{o.set(R.bucket,R.op_id)});let l=Array.from(o.entries()).map(([R,L])=>({name:R,after:L})),d=null,f=null,u=null,p=new Set(o.keys());this.logger.debug("Requesting stream from server");let _={path:"/sync/stream",abortSignal:e,data:{buckets:l,include_checksum:!0,raw_data:!0}},I=n?.connectionMethod==si.HTTP?await this.options.remote.postStream(_):await this.options.remote.socketStream(_);for(this.logger.debug("Stream established. Processing events");!I.closed;){let R=await I.read();if(!R)return{retry:!0};if(this.syncStatus.connected||(Promise.resolve().then(()=>this.triggerCrudUpload()),this.updateSyncStatus({connected:!0})),fc(R)){d=R.checkpoint;let L=new Set(p),g=new Set;for(let w of R.checkpoint.buckets)g.add(w.bucket),L.delete(w.bucket);L.size>0&&this.logger.debug("Removing buckets",[...L]),p=g,await this.options.adapter.removeBuckets([...L]),await this.options.adapter.setTargetCheckpoint(d)}else if(hc(R)){this.logger.debug("Checkpoint complete",d);let L=await this.options.adapter.syncLocalDatabase(d);if(L.checkpointValid)L.ready&&(u=d,this.logger.debug("validated checkpoint",u),this.updateSyncStatus({connected:!0,lastSyncedAt:new Date,dataFlow:{downloading:!1}}));else return await new Promise(g=>setTimeout(g,50)),{retry:!0};f=d}else if(dc(R)){if(d==null)throw new Error("Checkpoint diff without previous checkpoint");let L=R.checkpoint_diff,g=new Map;for(let b of d.buckets)g.set(b.bucket,b);for(let b of L.updated_buckets)g.set(b.bucket,b);for(let b of L.removed_buckets)g.delete(b);d={last_op_id:L.last_op_id,buckets:[...g.values()],write_checkpoint:L.write_checkpoint},p=new Set(g.keys());let y=L.removed_buckets;y.length>0&&this.logger.debug("Remove buckets",y),await this.options.adapter.removeBuckets(y),await this.options.adapter.setTargetCheckpoint(d)}else if(cc(R)){let{data:L}=R;this.updateSyncStatus({dataFlow:{downloading:!0}}),await this.options.adapter.saveSyncData({buckets:[pn.fromRow(L)]})}else if(uc(R)){if(R.token_expires_in==0)return this.logger.debug("Token expiring; reconnect"),await this.delayRetry(),{retry:!0};this.triggerCrudUpload()}else if(this.logger.debug("Sync complete"),d===u)this.updateSyncStatus({connected:!0,lastSyncedAt:new Date});else if(f===d){let L=await this.options.adapter.syncLocalDatabase(d);if(L.checkpointValid)L.ready&&(u=d,this.updateSyncStatus({connected:!0,lastSyncedAt:new Date,dataFlow:{downloading:!1}}));else return await new Promise(g=>setTimeout(g,50)),{retry:!1}}}return this.logger.debug("Stream input empty"),{retry:!0}}})}updateSyncStatus(e){let t=new Je({connected:e.connected??this.syncStatus.connected,lastSyncedAt:e.lastSyncedAt??this.syncStatus.lastSyncedAt,dataFlow:{...this.syncStatus.dataFlowStatus,...e.dataFlow}});this.syncStatus.isEqual(t)||(this.syncStatus=t,this.iterateListeners(n=>n.statusChanged?.(t))),this.iterateListeners(n=>n.statusUpdated?.(e))}async delayRetry(){return new Promise(e=>setTimeout(e,this.options.retryDelayMs))}};var ai=class{task;runningTask;pendingTaskParam;isThrottling;closed;constructor(e,t){this.task=e;let{throttleEnabled:n=!0}=t??{};this.isThrottling=n,this.closed=!1}schedule(e){if(!this.closed){if(!this.isThrottling){this.task(e);return}if(this.runningTask){this.pendingTaskParam=e;return}this.execute(e)}}dispose(){this.closed=!0,this.runningTask&&(this.runningTask=void 0)}async execute(e){if(this.runningTask=this.task(e),await this.runningTask,this.runningTask=void 0,this.pendingTaskParam){let t=this.pendingTaskParam;this.pendingTaskParam=void 0,this.execute(t)}}};var Ss=/(^ps_data__|^ps_data_local__)/,Yd={clearLocal:!0},Zd={disconnect:!0},ep=30,tp={retryDelay:5e3,logger:yc.default.get("PowerSyncDatabase"),crudUploadThrottleMs:ws},mc=12e4,gc=class r extends Me{options;static transactionMutex=new Nr;closed;ready;currentStatus;syncStreamImplementation;sdkVersion;bucketStorageAdapter;syncStatusListenerDisposer;_isReadyPromise;hasSyncedWatchDisposer;_schema;constructor(e){super(),this.options=e,this.bucketStorageAdapter=this.generateBucketStorageAdapter(),this.closed=!1,this.currentStatus=new Je({}),this.options={...tp,...e},this._schema=e.schema,this.ready=!1,this.sdkVersion="",this._isReadyPromise=this.initialize()}get schema(){return this._schema}get database(){return this.options.database}get connected(){return this.currentStatus?.connected||!1}async waitForReady(){this.ready||await this._isReadyPromise}async waitForFirstSync(e){if(!this.currentStatus.hasSynced)return new Promise(t=>{let n=this.registerListener({statusChanged:s=>{s.hasSynced&&(n(),t())}});e?.addEventListener("abort",()=>{n(),t()})})}async initialize(){await this._initialize(),await this.bucketStorageAdapter.init();let e=await this.options.database.execute("SELECT powersync_rs_version()");this.sdkVersion=e.rows?.item(0)["powersync_rs_version()"]??"",await this.updateSchema(this.options.schema),this.updateHasSynced(),await this.database.execute("PRAGMA RECURSIVE_TRIGGERS=TRUE"),this.ready=!0,this.iterateListeners(t=>t.initialized?.())}async updateHasSynced(){let e="SELECT 1 FROM ps_buckets WHERE last_applied_op > 0 LIMIT 1",t=new AbortController;this.hasSyncedWatchDisposer=()=>t.abort(),this.watch(e,[],{onResult:n=>{let s=!!n.rows?.length;s!=this.currentStatus.hasSynced&&(this.currentStatus=new Je({...this.currentStatus.toJSON(),hasSynced:s}),this.iterateListeners(o=>o.statusChanged?.(this.currentStatus))),s&&t.abort()},onError:n=>{this.options.logger?.warn("Failure while watching synced state",n),t.abort()}},{rawTableNames:!0,signal:t.signal})}async updateSchema(e){if(this.syncStreamImplementation)throw new Error("Cannot update schema while connected");try{e.validate()}catch(t){this.options.logger?.warn("Schema validation failed. Unexpected behaviour could occur",t)}this._schema=e,await this.database.execute("SELECT powersync_replace_schema(?)",[JSON.stringify(this.schema.toJSON())])}async init(){return this.waitForReady()}async connect(e,t){if(await this.waitForReady(),await this.disconnect(),this.closed)throw new Error("Cannot connect using a closed client");this.syncStreamImplementation=this.generateSyncStreamImplementation(e),this.syncStatusListenerDisposer=this.syncStreamImplementation.registerListener({statusChanged:n=>{this.currentStatus=new Je({...n.toJSON(),hasSynced:this.currentStatus?.hasSynced||!!n.lastSyncedAt}),this.iterateListeners(s=>s.statusChanged?.(this.currentStatus))}}),await this.syncStreamImplementation.waitForReady(),this.syncStreamImplementation.triggerCrudUpload(),await this.syncStreamImplementation.connect(t)}async disconnect(){await this.waitForReady(),await this.syncStreamImplementation?.disconnect(),this.syncStatusListenerDisposer?.(),await this.syncStreamImplementation?.dispose(),this.syncStreamImplementation=void 0}async disconnectAndClear(e=Yd){await this.disconnect(),await this.waitForReady();let{clearLocal:t}=e;await this.database.writeTransaction(async n=>{await n.execute(`DELETE FROM ${Le.OPLOG}`),await n.execute(`DELETE FROM ${Le.CRUD}`),await n.execute(`DELETE FROM ${Le.BUCKETS}`),await n.execute(`DELETE FROM ${Le.UNTYPED}`);let s=t?"ps_data_*":"ps_data__*",o=await n.execute(`
      SELECT name FROM sqlite_master WHERE type='table' AND name GLOB ?
      `,[s]);if(o.rows?.length)for(let l of o.rows._array)await n.execute(`DELETE FROM ${ac(l.name)} WHERE 1`)})}async close(e=Zd){await this.waitForReady(),this.hasSyncedWatchDisposer?.();let{disconnect:t}=e;t&&await this.disconnect(),await this.syncStreamImplementation?.dispose(),this.database.close(),this.closed=!0}async getUploadQueueStats(e){return this.readTransaction(async t=>{if(e){let s=(await t.execute(`SELECT SUM(cast(data as blob) + 20) as size, count(*) as count FROM ${Le.CRUD}`)).rows.item(0);return new dn(s?.count??0,s?.size??0)}else{let s=(await t.execute(`SELECT count(*) as count FROM ${Le.CRUD}`)).rows.item(0);return new dn(s?.count??0)}})}async getCrudBatch(e){let n=(await this.getAll(`SELECT id, tx_id, data FROM ${Le.CRUD} ORDER BY id ASC LIMIT ?`,[e+1])).map(l=>Qt.fromRow(l))??[],s=!1;if(n.length>e&&(n.pop(),s=!0),n.length==0)return null;let o=n[n.length-1];return new Fr(n,s,async l=>this.handleCrudCheckpoint(o.clientId,l))}async getNextCrudTransaction(){return await this.readTransaction(async e=>{let t=await e.getOptional(`SELECT id, tx_id, data FROM ${Le.CRUD} ORDER BY id ASC LIMIT 1`);if(!t)return null;let n=t.tx_id,s;n?s=(await e.getAll(`SELECT id, tx_id, data FROM ${Le.CRUD} WHERE tx_id = ? ORDER BY id ASC`,[n])).map(d=>Qt.fromRow(d)):s=[Qt.fromRow(t)];let o=s[s.length-1];return new ri(s,async l=>this.handleCrudCheckpoint(o.clientId,l),n)})}async handleCrudCheckpoint(e,t){return this.writeTransaction(async n=>{await n.execute(`DELETE FROM ${Le.CRUD} WHERE id <= ?`,[e]),t?(await n.execute(`SELECT 1 FROM ${Le.CRUD} LIMIT 1`)).rows?.length||await n.execute(`UPDATE ${Le.BUCKETS} SET target_op = ? WHERE name='$local'`,[t]):await n.execute(`UPDATE ${Le.BUCKETS} SET target_op = ? WHERE name='$local'`,[this.bucketStorageAdapter.getMaxOpId()])})}async execute(e,t){return await this.waitForReady(),this.database.execute(e,t)}async executeBatch(e,t){return await this.waitForReady(),this.database.executeBatch(e,t)}async getAll(e,t){return await this.waitForReady(),this.database.getAll(e,t)}async getOptional(e,t){return await this.waitForReady(),this.database.getOptional(e,t)}async get(e,t){return await this.waitForReady(),this.database.get(e,t)}async readLock(e){return await this.waitForReady(),Es(r.transactionMutex,()=>e(this.database))}async writeLock(e){return await this.waitForReady(),Es(r.transactionMutex,async()=>await e(this.database))}async readTransaction(e,t=mc){return await this.waitForReady(),this.database.readTransaction(async n=>{let s=await e({...n});return await n.rollback(),s},{timeoutMs:t})}async writeTransaction(e,t=mc){return await this.waitForReady(),this.database.writeTransaction(async n=>{let s=await e(n);return await n.commit(),s},{timeoutMs:t})}watch(e,t,n,s){if(n&&typeof n=="object"&&"onResult"in n){let l=n,d=s;return this.watchWithCallback(e,t,l,d)}let o=n;return this.watchWithAsyncGenerator(e,t,o)}watchWithCallback(e,t,n,s){let{onResult:o,onError:l=d=>this.options.logger?.error(d)}=n??{};if(!o)throw new Error("onResult is required");(async()=>{try{let d=await this.resolveTables(e,t,s),f=await this.executeReadOnly(e,t);o(f),this.onChangeWithCallback({onChange:async()=>{try{let u=await this.executeReadOnly(e,t);o(u)}catch(u){l?.(u)}},onError:l},{...s??{},tables:d})}catch(d){l?.(d)}})()}watchWithAsyncGenerator(e,t,n){return new Ts.EventIterator(s=>{(async()=>{let o=await this.resolveTables(e,t,n);s.push(await this.executeReadOnly(e,t));for await(let l of this.onChangeWithAsyncGenerator({...n??{},tables:o}))s.push(await this.executeReadOnly(e,t))})()})}async resolveTables(e,t,n){let s=n?.tables?[...n.tables]:[];if(!n?.tables){let l=(await this.getAll(`EXPLAIN ${e}`,t)).filter(f=>f.opcode=="OpenRead"&&f.p3==0&&typeof f.p2=="number").map(f=>f.p2),d=await this.getAll("SELECT DISTINCT tbl_name FROM sqlite_master WHERE rootpage IN (SELECT json_each.value FROM json_each(?))",[JSON.stringify(l)]);for(let f of d)s.push(f.tbl_name.replace(Ss,""))}return s}onChange(e,t){if(e&&typeof e=="object"&&"onChange"in e){let s=e,o=t;return this.onChangeWithCallback(s,o)}let n=e;return this.onChangeWithAsyncGenerator(n)}onChangeWithCallback(e,t){let{onChange:n,onError:s=I=>this.options.logger?.error(I)}=e??{};if(!n)throw new Error("onChange is required");let o=t??{},l=new Set(o.tables??[]),d=new Set,f=o.throttleMs??ep,u=new ai(async I=>{await n(I)}),p=(0,Ec.default)(()=>this.handleTableChanges(d,l,I=>{o?.signal?.aborted||u.schedule({changedTables:I})}),f,{leading:!1,trailing:!0}),_=this.database.registerListener({tablesUpdated:async I=>{try{let{rawTableNames:R}=o;this.processTableUpdates(I,R,d),p()}catch(R){s?.(R)}}});return o.signal?.addEventListener("abort",()=>{u.dispose(),_()}),()=>_()}onChangeWithAsyncGenerator(e){let t=e??{};return new Ts.EventIterator(n=>{let s=this.onChangeWithCallback({onChange:o=>{n.push(o)},onError:o=>{n.fail(o)}},e);return t.signal?.addEventListener("abort",()=>{n.stop()}),()=>s()})}handleTableChanges(e,t,n){if(e.size>0){let s=Array.from(e.values()).filter(o=>t.has(o));s.length&&n(s)}e.clear()}processTableUpdates(e,t,n){let s=ys(e)?e.tables:[e.table],o=t?s:s.filter(d=>!!d.match(Ss));if(!o.length)return;let l=t?o:o.map(d=>d.replace(Ss,""));for(let d of l)n.add(d)}async executeReadOnly(e,t){return await this.waitForReady(),this.database.readLock(n=>n.execute(e,t))}};var rp=Ie(at());var wc=Ie(at());var bs=1e3,li=class r extends Me{db;mutex;logger;static MAX_OP_ID="9223372036854775807";tableNames;pendingBucketDeletes;_hasCompletedSync;updateListener;compactCounter=bs;constructor(e,t,n=wc.default.get("SqliteBucketStorage")){super(),this.db=e,this.mutex=t,this.logger=n,this._hasCompletedSync=!1,this.pendingBucketDeletes=!0,this.tableNames=new Set,this.updateListener=e.registerListener({tablesUpdated:s=>{oc(s).includes(Le.CRUD)&&this.iterateListeners(l=>l.crudUpdate?.())}})}async init(){this._hasCompletedSync=!1;let e=await this.db.execute("SELECT name FROM sqlite_master WHERE type='table' AND name GLOB 'ps_data_*'");for(let t of e.rows?._array??[])this.tableNames.add(t.name)}async dispose(){this.updateListener?.()}getMaxOpId(){return r.MAX_OP_ID}startSession(){}async getBucketStates(){return(await this.db.execute("SELECT name as bucket, cast(last_op as TEXT) as op_id FROM ps_buckets WHERE pending_delete = 0")).rows?._array??[]}async saveSyncData(e){await this.writeTransaction(async t=>{let n=0;for(let s of e.buckets){let o=await t.execute("INSERT INTO powersync_operations(op, data) VALUES(?, ?)",["save",JSON.stringify({buckets:[s.toJSON()]})]);this.logger.debug("saveSyncData",JSON.stringify(o)),n+=s.data.length}this.compactCounter+=n})}async removeBuckets(e){for(let t of e)await this.deleteBucket(t)}async deleteBucket(e){await this.writeTransaction(async t=>{let{uuid:n}=await t.get("select uuid() as uuid"),s=`$delete_${e}_${n}`;this.logger.debug("Deleting bucket",e),await t.execute(`UPDATE ps_oplog SET op=${ur.REMOVE}, data=NULL WHERE op=${ur.PUT} AND superseded=0 AND bucket=?`,[e]),await t.execute("UPDATE ps_oplog SET bucket=? WHERE bucket=?",[s,e]),await t.execute("DELETE FROM ps_buckets WHERE name = ?",[e]),await t.execute("INSERT INTO ps_buckets(name, pending_delete, last_op) SELECT ?, 1, IFNULL(MAX(op_id), 0) FROM ps_oplog WHERE bucket = ?",[s,s])}),this.logger.debug("done deleting bucket"),this.pendingBucketDeletes=!0}async hasCompletedSync(){if(this._hasCompletedSync)return!0;let t=!!(await this.db.execute("SELECT name, last_applied_op FROM ps_buckets WHERE last_applied_op > 0 LIMIT 1")).rows?.length;return t&&(this._hasCompletedSync=!0),t}async syncLocalDatabase(e){let t=await this.validateChecksums(e);if(!t.checkpointValid){this.logger.error("Checksums failed for",t.checkpointFailures);for(let o of t.checkpointFailures??[])await this.deleteBucket(o);return{ready:!1,checkpointValid:!1,checkpointFailures:t.checkpointFailures}}let n=e.buckets.map(o=>o.bucket);return await this.writeTransaction(async o=>{await o.execute("UPDATE ps_buckets SET last_op = ? WHERE name IN (SELECT json_each.value FROM json_each(?))",[e.last_op_id,JSON.stringify(n)]),e.write_checkpoint&&await o.execute("UPDATE ps_buckets SET last_op = ? WHERE name = '$local'",[e.write_checkpoint])}),await this.updateObjectsFromBuckets(e)?(await this.forceCompact(),{ready:!0,checkpointValid:!0}):(this.logger.debug("Not at a consistent checkpoint - cannot update local db"),{ready:!1,checkpointValid:!0})}async updateObjectsFromBuckets(e){return this.writeTransaction(async t=>{let{insertId:n}=await t.execute("INSERT INTO powersync_operations(op, data) VALUES(?, ?)",["sync_local",""]);return n==1})}async validateChecksums(e){let n=(await this.db.execute("SELECT powersync_validate_checkpoint(?) as result",[JSON.stringify(e)])).rows?.item(0);if(this.logger.debug("validateChecksums result item",n),!n)return{checkpointValid:!1,ready:!1,checkpointFailures:[]};let s=JSON.parse(n.result);return s.valid?{ready:!0,checkpointValid:!0}:{checkpointValid:!1,ready:!1,checkpointFailures:s.failed_buckets}}async forceCompact(){this.compactCounter=bs,this.pendingBucketDeletes=!0,await this.autoCompact()}async autoCompact(){await this.deletePendingBuckets(),await this.clearRemoveOps()}async deletePendingBuckets(){this.pendingBucketDeletes!==!1&&(await this.writeTransaction(async e=>{await e.execute("DELETE FROM ps_oplog WHERE bucket IN (SELECT name FROM ps_buckets WHERE pending_delete = 1 AND last_applied_op = last_op AND last_op >= target_op)"),await e.execute("DELETE FROM ps_buckets WHERE pending_delete = 1 AND last_applied_op = last_op AND last_op >= target_op")}),this.pendingBucketDeletes=!1)}async clearRemoveOps(){this.compactCounter<bs||(await this.writeTransaction(async e=>{await e.execute("INSERT INTO powersync_operations(op, data) VALUES (?, ?)",["clear_remove_ops",""])}),this.compactCounter=0)}async updateLocalTarget(e){if(!(await this.db.execute("SELECT target_op FROM ps_buckets WHERE name = '$local' AND target_op = ?",[r.MAX_OP_ID])).rows?.length)return!1;let n=await this.db.execute("SELECT seq FROM sqlite_sequence WHERE name = 'ps_crud'");if(!n.rows?.length)return!1;let s=n.rows?.item(0).seq,o=await e();return this.logger.debug(`[updateLocalTarget] Updating target to checkpoint ${o}`),this.writeTransaction(async l=>{if((await l.execute("SELECT 1 FROM ps_crud LIMIT 1")).rows?.length)return this.logger.debug("updateLocalTarget","ps crud is not empty"),!1;let f=await l.execute("SELECT seq FROM sqlite_sequence WHERE name = 'ps_crud'");if(!f.rows?.length)throw new Error("SQlite Sequence should not be empty");let u=f.rows?.item(0).seq;if(this.logger.debug("seqAfter",JSON.stringify(f.rows?.item(0))),u!=s)return this.logger.debug("seqAfter != seqBefore",u,s),!1;let p=await l.execute("UPDATE ps_buckets SET target_op = ? WHERE name='$local'",[o]);return this.logger.debug(["[updateLocalTarget] Response from updating target_op ",JSON.stringify(p)]),!0})}async hasCrud(){return!!(await this.db.execute("SELECT 1 FROM ps_crud LIMIT 1")).rows?.length}async getCrudBatch(e=100){if(!await this.hasCrud())return null;let t=await this.db.execute("SELECT * FROM ps_crud ORDER BY id ASC LIMIT ?",[e]),n=[];for(let o of t.rows?._array??[])n.push(Qt.fromRow(o));if(n.length===0)return null;let s=n[n.length-1];return{crud:n,haveMore:!0,complete:async o=>this.writeTransaction(async l=>{await l.execute("DELETE FROM ps_crud WHERE id <= ?",[s.clientId]),o?(await l.execute("SELECT 1 FROM ps_crud LIMIT 1")).rows?.length&&await l.execute("UPDATE ps_buckets SET target_op = ? WHERE name='$local'",[o]):await l.execute("UPDATE ps_buckets SET target_op = ? WHERE name='$local'",[this.getMaxOpId()])})}}async writeTransaction(e,t){return this.db.writeTransaction(e,t)}async setTargetCheckpoint(e){}};var Qu=Ie(at()),js=Ie(Tc());var Ic=Ie(at());var bc={highWater:10,lowWater:0},_n=class r extends Me{options;dataQueue;isClosed;processingPromise;logger;constructor(e){if(super(),this.options=e,this.processingPromise=null,this.isClosed=!1,this.dataQueue=[],this.logger=e?.logger??Ic.default.get("DataStream"),e?.closeOnError){let t=this.registerListener({error:n=>{t?.(),this.close()}})}}get highWatermark(){return this.options?.pressure?.highWaterMark??bc.highWater}get lowWatermark(){return this.options?.pressure?.lowWaterMark??bc.lowWater}get closed(){return this.isClosed}async close(){this.isClosed=!0,await this.processingPromise,this.iterateListeners(e=>e.closed?.()),this.dataQueue=[],this.listeners.clear()}enqueueData(e){if(this.isClosed)throw new Error("Cannot enqueue data into closed stream.");this.dataQueue.push(e),this.processQueue()}async read(){return this.dataQueue.length<=this.lowWatermark&&await this.iterateAsyncErrored(async e=>e.lowWater?.()),this.closed?null:new Promise((e,t)=>{let n=this.registerListener({data:async s=>{e(s),n?.()},closed:()=>{e(null),n?.()},error:s=>{t(s),n?.()}});this.processQueue()})}forEach(e){return this.dataQueue.length<=this.lowWatermark&&this.iterateAsyncErrored(async t=>t.lowWater?.()),this.registerListener({data:e})}async processQueue(){if(!this.processingPromise)return this.dataQueue.length>=this.highWatermark&&await this.iterateAsyncErrored(async e=>e.highWater?.()),this.processingPromise=this._processQueue()}map(e){let t=new r(this.options),n=this.registerListener({data:async s=>{t.enqueueData(e(s))},closed:()=>{t.close(),n?.()}});return t}hasDataReader(){return Array.from(this.listeners.values()).some(e=>!!e.data)}async _processQueue(){if(!this.dataQueue.length||this.isClosed||!this.hasDataReader()){Promise.resolve().then(()=>this.processingPromise=null);return}let e=this.dataQueue.shift();await this.iterateAsyncErrored(async t=>t.data?.(e)),this.dataQueue.length<=this.lowWatermark&&await this.iterateAsyncErrored(async t=>t.lowWater?.()),this.processingPromise=null,this.dataQueue.length&&setTimeout(()=>this.processQueue())}async iterateAsyncErrored(e){for(let t of Array.from(this.listeners.values()))try{await e(t)}catch(n){this.logger.error(n),this.iterateListeners(s=>s.error?.(n))}}};var $u=Ie(Oc()),zu=Ie(Ur()),ju=Ie(wu());var Ri=Ie(zs()),xm=3e4,In=10,Am=5,Nm=2e4,Fm=3e4,Cm=Qu.default.get("PowerSyncRemote"),Bm={socketUrlTransformer:r=>r.replace(/^https?:\/\//,function(e){return e==="https://"?"wss://":"ws://"}),fetchImplementation:js.fetch.bind(globalThis)},vi=class{connector;logger;credentials=null;options;constructor(e,t=Cm,n){this.connector=e,this.logger=t,this.options={...Bm,...n??{}}}get fetch(){return this.options.fetchImplementation}async getCredentials(){let{expiresAt:e}=this.credentials??{};return e&&e>new Date(new Date().valueOf()+xm)?this.credentials:(this.credentials=await this.connector.fetchCredentials(),this.credentials)}async buildRequest(e){let t=await this.getCredentials();if(t!=null&&(t.endpoint==null||t.endpoint==""))throw new Error("PowerSync endpoint not configured");if(t?.token==null||t?.token==""){let n=new Error("Not signed in");throw n.status=401,n}return{url:t.endpoint+e,headers:{"content-type":"application/json",Authorization:`Token ${t.token}`}}}async post(e,t,n={}){let s=await this.buildRequest(e),o=await(0,js.fetch)(s.url,{method:"POST",headers:{...n,...s.headers},body:JSON.stringify(t)});if(!o.ok)throw new Error(`Received ${o.status} - ${o.statusText} when posting to ${e}: ${await o.text()}}`);return o.json()}async get(e,t){let n=await this.buildRequest(e),s=await this.fetch(n.url,{method:"GET",headers:{...t,...n.headers}});if(!s.ok)throw new Error(`Received ${s.status} - ${s.statusText} when getting from ${e}: ${await s.text()}}`);return s.json()}async postStreaming(e,t,n={},s){let o=await this.buildRequest(e),l=await this.fetch(o.url,{method:"POST",headers:{...n,...o.headers},body:JSON.stringify(t),signal:s,cache:"no-store"}).catch(d=>{throw this.logger.error(`Caught ex when POST streaming to ${e}`,d),d});if(!l.ok){let d=await l.text();this.logger.error(`Could not POST streaming to ${e} - ${l.status} - ${l.statusText}: ${d}`);let f=new Error(`HTTP ${l.statusText}: ${d}`);throw f.status=l.status,f}return l}async socketStream(e){let{path:t}=e,n=await this.buildRequest(t),s=await this.getBSON(),o=new zu.RSocketConnector({transport:new ju.WebsocketClientTransport({url:this.options.socketUrlTransformer(n.url)}),setup:{keepAlive:Nm,lifetime:Fm,dataMimeType:"application/bson",metadataMimeType:"application/bson",payload:{data:null,metadata:Ri.Buffer.from(s.serialize({token:n.headers.Authorization}))}}}),l;try{l=await o.connect()}catch(R){throw new Error(`Could not connect to PowerSync instance: ${JSON.stringify(R)}`)}let d=new _n({logger:this.logger,pressure:{lowWaterMark:Am}}),f=!1,u=()=>{f||(f=!0,l.close())},p=In,_=await new Promise((R,L)=>{let g=!1,w=l.requestStream({data:Ri.Buffer.from(s.serialize(e.data)),metadata:Ri.Buffer.from(s.serialize({path:t}))},In,{onError:y=>{y.message!=="Closed. "&&this.logger.error(y),f=!0,d.close(),g||L(y)},onNext:y=>{g||(g=!0,R(w));let{data:b}=y;if(p--,!b)return;let A=s.deserialize(b);d.enqueueData(A)},onComplete:()=>{d.close()},onExtension:()=>{}})}),I=d.registerListener({lowWater:async()=>{In-p>0&&(_.request(In-p),p=In)},closed:()=>{u(),I?.()}});return e.abortSignal?.aborted?d.close():e.abortSignal?.addEventListener("abort",()=>{d.close()}),d}async postStream(e){let{data:t,path:n,headers:s,abortSignal:o}=e,l=await this.buildRequest(n),d=new AbortController,f=!1;o?.addEventListener("abort",()=>{f||d.abort(o.reason??new tt("Cancelling network request before it resolves. Abort signal has been received."))});let u=await this.fetch(l.url,{method:"POST",headers:{...s,...l.headers},body:JSON.stringify(t),signal:d.signal,cache:"no-store",...e.fetchOptions}).catch(y=>{throw y.name=="AbortError"?new tt(`Pending fetch request to ${l.url} has been aborted.`):y});if(!u)throw new Error("Fetch request was aborted");if(f=!0,!u.ok||!u.body){let y=await u.text();this.logger.error(`Could not POST streaming to ${n} - ${u.status} - ${u.statusText}: ${y}`);let b=new Error(`HTTP ${u.statusText}: ${y}`);throw b.status=u.status,b}let p=u.body.getReader(),_=async()=>{try{await p.cancel()}catch{}p.releaseLock()};o?.addEventListener("abort",()=>{_()});let I=new ReadableStream({start:y=>{(async()=>{for(;!o?.aborted;)try{let{done:A,value:v}=await p.read();if(A)break;y.enqueue(v)}catch(A){this.logger.error("Caught exception when reading sync stream",A);break}o?.aborted||await _(),y.close()})()}}),R=(0,$u.default)(new Response(I).body),L=new _n({logger:this.logger}),g=R.getReader(),w=L.registerListener({lowWater:async()=>{try{let{done:y,value:b}=await g.read();if(y){L.close(),w?.();return}L.enqueueData(b)}catch(y){throw L.close(),y}},closed:()=>{_(),w?.()}});return L}};var pr;(function(r){r.TEXT="TEXT",r.INTEGER="INTEGER",r.REAL="REAL"})(pr||(pr={}));var cE={type:pr.TEXT},uE={type:pr.INTEGER},fE={type:pr.REAL};var Li=class extends oi{constructor(e){super(e)}get webOptions(){return this.options}obtainLock(e){let t=`streaming-sync-${e.type}-${this.webOptions.identifier}`;return e.type==Cr.SYNC&&console.debug("requesting lock for ",t),navigator.locks.request(t,{signal:e.signal},e.callback)}};var Ig=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},Ci=class extends vi{getBSON(){return Ig(this,void 0,void 0,function*(){if(this._bson)return this._bson;let{BSON:e}=yield $f().then(()=>Qf);return this._bson=e,this._bson})}};var hh=Ie(at());Fn();Fn();typeof BigInt.prototype.toJSON>"u"&&(BigInt.prototype.toJSON=function(){return this.toString()});var Gf=0x7fffffffffffffffn,Xf=-0x8000000000000000n,ct=class extends Error{constructor(e,t){super(e),this.code=t}},nn=!0,Jf={};globalThis.__onTablesChanged=function(r,e,t,n){setTimeout(()=>Jf[r]?.(e,t,n),0)};function Yf(r){let e={},t=r._getSqliteFree(),n=r._malloc(8),s=[n,n+4];function o(g){if(typeof g!="string")return 0;let w=r.lengthBytesUTF8(g),y=r._sqlite3_malloc(w+1);return r.stringToUTF8(g,y,w+1),y}function l(g,w){return BigInt(w)<<32n|BigInt(g)&0xffffffffn}let d=function(){let g=BigInt(Number.MAX_SAFE_INTEGER)>>32n,w=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(y,b){return b>g||b<w?l(y,b):b*4294967296+(y&2147483647)-(y&2147483648)}}(),f=new Set;function u(g){if(!f.has(g))throw new ct("not a database",21)}let p=new Map;function _(g){if(!p.has(g))throw new ct("not a statement",21)}e.bind_collection=function(g,w){_(g);let y=Array.isArray(w),b=e.bind_parameter_count(g);for(let A=1;A<=b;++A){let v=y?A-1:e.bind_parameter_name(g,A),k=w[v];k!==void 0&&e.bind(g,A,k)}return 0},e.bind=function(g,w,y){switch(_(g),typeof y){case"number":return y===(y|0)?e.bind_int(g,w,y):e.bind_double(g,w,y);case"string":return e.bind_text(g,w,y);default:return y instanceof Uint8Array||Array.isArray(y)?e.bind_blob(g,w,y):y===null?e.bind_null(g,w):typeof y=="bigint"?e.bind_int64(g,w,y):y===void 0?27:(console.warn("unknown binding converted to null",y),e.bind_null(g,w))}},e.bind_blob=function(){let g="sqlite3_bind_blob",w=r.cwrap(g,...oe("nnnnn:n"));return function(y,b,A){_(y);let v=A.byteLength??A.length,k=r._sqlite3_malloc(v);r.HEAPU8.subarray(k).set(A);let Q=w(y,b,k,v,t);return L(g,Q,p.get(y))}}(),e.bind_parameter_count=function(){let w=r.cwrap("sqlite3_bind_parameter_count",...oe("n:n"));return function(y){return _(y),w(y)}}(),e.bind_double=function(){let g="sqlite3_bind_double",w=r.cwrap(g,...oe("nnn:n"));return function(y,b,A){_(y);let v=w(y,b,A);return L(g,v,p.get(y))}}(),e.bind_int=function(){let g="sqlite3_bind_int",w=r.cwrap(g,...oe("nnn:n"));return function(y,b,A){if(_(y),A>2147483647||A<-2147483648)return 25;let v=w(y,b,A);return L(g,v,p.get(y))}}(),e.bind_int64=function(){let g="sqlite3_bind_int64",w=r.cwrap(g,...oe("nnnn:n"));return function(y,b,A){if(_(y),A>Gf||A<Xf)return 25;let v=A&0xffffffffn,k=A>>32n,Q=w(y,b,Number(v),Number(k));return L(g,Q,p.get(y))}}(),e.bind_null=function(){let g="sqlite3_bind_null",w=r.cwrap(g,...oe("nn:n"));return function(y,b){_(y);let A=w(y,b);return L(g,A,p.get(y))}}(),e.bind_parameter_name=function(){let w=r.cwrap("sqlite3_bind_parameter_name",...oe("n:s"));return function(y,b){return _(y),w(y,b)}}(),e.bind_text=function(){let g="sqlite3_bind_text",w=r.cwrap(g,...oe("nnnnn:n"));return function(y,b,A){_(y);let v=o(A),k=w(y,b,v,-1,t);return L(g,k,p.get(y))}}(),e.changes=function(){let w=r.cwrap("sqlite3_changes",...oe("n:n"));return function(y){return u(y),w(y)}}(),e.last_insert_id=function(){let w=r.cwrap("sqlite3_last_insert_rowid",...oe("n:n"));return function(y){return u(y),w(y)}}(),e.close=function(){let g="sqlite3_close",w=r.cwrap(g,...oe("n:n"),{async:nn});return async function(y){u(y);let b=await w(y);return f.delete(y),L(g,b,y)}}(),e.column=function(g,w){_(g);let y=e.column_type(g,w);switch(y){case 4:return e.column_blob(g,w);case 2:return e.column_double(g,w);case 1:let b=e.column_int(g,w),A=r.getTempRet0();return d(b,A);case 5:return null;case 3:return e.column_text(g,w);default:throw new ct("unknown type",y)}},e.column_blob=function(){let w=r.cwrap("sqlite3_column_blob",...oe("nn:n"));return function(y,b){_(y);let A=e.column_bytes(y,b),v=w(y,b);return r.HEAPU8.subarray(v,v+A)}}(),e.column_bytes=function(){let w=r.cwrap("sqlite3_column_bytes",...oe("nn:n"));return function(y,b){return _(y),w(y,b)}}(),e.column_count=function(){let w=r.cwrap("sqlite3_column_count",...oe("n:n"));return function(y){return _(y),w(y)}}(),e.column_double=function(){let w=r.cwrap("sqlite3_column_double",...oe("nn:n"));return function(y,b){return _(y),w(y,b)}}(),e.column_int=function(){let w=r.cwrap("sqlite3_column_int64",...oe("nn:n"));return function(y,b){return _(y),w(y,b)}}(),e.column_int64=function(){let w=r.cwrap("sqlite3_column_int64",...oe("nn:n"));return function(y,b){_(y);let A=w(y,b),v=r.getTempRet0();return l(A,v)}}(),e.column_name=function(){let w=r.cwrap("sqlite3_column_name",...oe("nn:s"));return function(y,b){return _(y),w(y,b)}}(),e.column_names=function(g){let w=[],y=e.column_count(g);for(let b=0;b<y;++b)w.push(e.column_name(g,b));return w},e.column_text=function(){let w=r.cwrap("sqlite3_column_text",...oe("nn:s"));return function(y,b){return _(y),w(y,b)}}(),e.column_type=function(){let w=r.cwrap("sqlite3_column_type",...oe("nn:n"));return function(y,b){return _(y),w(y,b)}}(),e.create_function=function(g,w,y,b,A,v,k,Q){if(u(g),v&&!k&&!Q){let N=r.createFunction(g,w,y,b,A,v);return L("sqlite3_create_function",N,g)}if(!v&&k&&Q){let N=r.createAggregate(g,w,y,b,A,k,Q);return L("sqlite3_create_function",N,g)}throw new ct("invalid function combination",21)},e.create_module=function(g,w,y,b){u(g);let A=r.createModule(g,w,y,b);return L("sqlite3_create_module",A,g)},e.data_count=function(){let w=r.cwrap("sqlite3_data_count",...oe("n:n"));return function(y){return _(y),w(y)}}(),e.declare_vtab=function(){let w=r.cwrap("sqlite3_declare_vtab",...oe("ns:n"));return function(y,b){let A=w(y,b);return L("sqlite3_declare_vtab",A)}}(),e.exec=async function(g,w,y){for await(let b of e.statements(g,w)){let A;for(;await e.step(b)===100;)if(y){A=A??e.column_names(b);let v=e.row(b);await y(v,A)}}return 0},e.finalize=function(){let w=r.cwrap("sqlite3_finalize",...oe("n:n"),{async:nn});return async function(y){if(!p.has(y))return 21;let b=await w(y),A=p.get(y);return p.delete(y),b}}(),e.get_autocommit=function(){let w=r.cwrap("sqlite3_get_autocommit",...oe("n:n"));return function(y){return w(y)}}(),e.libversion=function(){let w=r.cwrap("sqlite3_libversion",...oe(":s"));return function(){return w()}}(),e.libversion_number=function(){let w=r.cwrap("sqlite3_libversion_number",...oe(":n"));return function(){return w()}}(),e.limit=function(){let w=r.cwrap("sqlite3_limit",...oe("nnn:n"));return function(y,b,A){return w(y,b,A)}}(),e.open_v2=function(){let g="sqlite3_open_v2",w=r.cwrap(g,...oe("snnn:n"),{async:nn});return async function(y,b,A){b=b||6,A=o(A),r.ccall("setup_powersync","int",[]);let v=await w(y,s[0],b,A),k=r.getValue(s[0],"*");return f.add(k),r._sqlite3_free(A),r.ccall("RegisterExtensionFunctions","void",["number"],[k]),L(g,v),k}}(),e.register_table_onchange_hook=function(g,w){r.ccall("register_table_update_hook","int",["number"],[g]),Jf[g]=function(y,b,A){let v=new DataView(r.HEAPU8.buffer),k=0;for(;v.getUint8(b+k)!==0;)k++;let Q=new Uint8Array(r.HEAPU8.buffer,b,k),N=new TextDecoder().decode(Q);return w(y,N,A)}},e.prepare_v2=function(){let g="sqlite3_prepare_v2",w=r.cwrap(g,...oe("nnnnn:n"),{async:nn});return async function(y,b){let A=await w(y,b,-1,s[0],s[1]);L(g,A,y);let v=r.getValue(s[0],"*");return v?(p.set(v,y),{stmt:v,sql:r.getValue(s[1],"*")}):null}}(),e.progress_handler=function(g,w,y,b){u(g),r.progressHandler(g,w,y,b)},e.reset=function(){let g="sqlite3_reset",w=r.cwrap(g,...oe("n:n"),{async:nn});return async function(y){_(y);let b=await w(y);return L(g,b,p.get(y))}}(),e.result=function(g,w){switch(typeof w){case"number":w===(w|0)?e.result_int(g,w):e.result_double(g,w);break;case"string":e.result_text(g,w);break;default:if(w instanceof Uint8Array||Array.isArray(w))e.result_blob(g,w);else if(w===null)e.result_null(g);else{if(typeof w=="bigint")return e.result_int64(g,w);console.warn("unknown result converted to null",w),e.result_null(g)}break}},e.result_blob=function(){let w=r.cwrap("sqlite3_result_blob",...oe("nnnn:n"));return function(y,b){let A=b.byteLength??b.length,v=r._sqlite3_malloc(A);r.HEAPU8.subarray(v).set(b),w(y,v,A,t)}}(),e.result_double=function(){let w=r.cwrap("sqlite3_result_double",...oe("nn:n"));return function(y,b){w(y,b)}}(),e.result_int=function(){let w=r.cwrap("sqlite3_result_int",...oe("nn:n"));return function(y,b){w(y,b)}}(),e.result_int64=function(){let w=r.cwrap("sqlite3_result_int64",...oe("nnn:n"));return function(y,b){if(b>Gf||b<Xf)return 25;let A=b&0xffffffffn,v=b>>32n;w(y,Number(A),Number(v))}}(),e.result_null=function(){let w=r.cwrap("sqlite3_result_null",...oe("n:n"));return function(y){w(y)}}(),e.result_text=function(){let w=r.cwrap("sqlite3_result_text",...oe("nnnn:n"));return function(y,b){let A=o(b);w(y,A,-1,t)}}(),e.row=function(g){let w=[],y=e.data_count(g);for(let b=0;b<y;++b){let A=e.column(g,b);w.push(A?.buffer===r.HEAPU8.buffer?A.slice():A)}return w},e.set_authorizer=function(g,w,y){u(g);let b=r.setAuthorizer(g,w,y);return L("sqlite3_set_authorizer",b,g)},e.sql=function(){let w=r.cwrap("sqlite3_sql",...oe("n:s"));return function(y){return _(y),w(y)}}(),e.statements=function(g,w){return async function*(){let y=e.str_new(g,w),b={stmt:null,sql:e.str_value(y)};try{for(;b=await e.prepare_v2(g,b.sql);)yield b.stmt,e.finalize(b.stmt),b.stmt=null}finally{b?.stmt&&e.finalize(b.stmt),e.str_finish(y)}}()},e.step=function(){let g="sqlite3_step",w=r.cwrap(g,...oe("n:n"),{async:nn});return async function(y){_(y);let b=await w(y);return L(g,b,p.get(y),[100,101])}}();let I=0,R=new Map;e.str_new=function(g,w=""){let y=r.lengthBytesUTF8(w),b=I++&4294967295,A={offset:r._sqlite3_malloc(y+1),bytes:y};return R.set(b,A),r.stringToUTF8(w,A.offset,A.bytes+1),b},e.str_appendall=function(g,w){if(!R.has(g))throw new ct("not a string",21);let y=R.get(g),b=r.lengthBytesUTF8(w),A=y.bytes+b,v=r._sqlite3_malloc(A+1);r.HEAPU8.subarray(v,v+A+1).set(r.HEAPU8.subarray(y.offset,y.offset+y.bytes)),r.stringToUTF8(w,v+y.bytes,b+1),r._sqlite3_free(y.offset),y.offset=v,y.bytes=A,R.set(g,y)},e.str_finish=function(g){if(!R.has(g))throw new ct("not a string",21);let w=R.get(g);R.delete(g),r._sqlite3_free(w.offset)},e.str_value=function(g){if(!R.has(g))throw new ct("not a string",21);return R.get(g).offset},e.user_data=function(g){return r.getFunctionUserData(g)},e.value=function(g){let w=e.value_type(g);switch(w){case 4:return e.value_blob(g);case 2:return e.value_double(g);case 1:let y=e.value_int(g),b=r.getTempRet0();return d(y,b);case 5:return null;case 3:return e.value_text(g);default:throw new ct("unknown type",w)}},e.value_blob=function(){let w=r.cwrap("sqlite3_value_blob",...oe("n:n"));return function(y){let b=e.value_bytes(y),A=w(y);return r.HEAPU8.subarray(A,A+b)}}(),e.value_bytes=function(){let w=r.cwrap("sqlite3_value_bytes",...oe("n:n"));return function(y){return w(y)}}(),e.value_double=function(){let w=r.cwrap("sqlite3_value_double",...oe("n:n"));return function(y){return w(y)}}(),e.value_int=function(){let w=r.cwrap("sqlite3_value_int64",...oe("n:n"));return function(y){return w(y)}}(),e.value_int64=function(){let w=r.cwrap("sqlite3_value_int64",...oe("n:n"));return function(y){let b=w(y),A=r.getTempRet0();return l(b,A)}}(),e.value_text=function(){let w=r.cwrap("sqlite3_value_text",...oe("n:s"));return function(y){return w(y)}}(),e.value_type=function(){let w=r.cwrap("sqlite3_value_type",...oe("n:n"));return function(y){return w(y)}}(),e.vfs_register=function(g,w){let y=r.registerVFS(g,w);return L("sqlite3_vfs_register",y)};function L(g,w,y=null,b=[0]){if(b.includes(w))return w;let A=y?r.ccall("sqlite3_errmsg","string",["number"],[y]):g;throw new ct(A,w)}return e}function oe(r){let e=[],t=r.match(/([ns@]*):([nsv@])/);switch(t[2]){case"n":e.push("number");break;case"s":e.push("string");break;case"v":e.push(null);break}let n=[];for(let s of t[1])switch(s){case"n":n.push("number");break;case"s":n.push("string");break}return e.push(n),e}var on=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},Xg=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(l){return new Promise(function(d,f){l=r[o](l),s(d,f,l.done,l.value)})}}function s(o,l,d,f){Promise.resolve(f).then(function(u){o({value:u,done:d})},l)}},ch=1;function uh(r){return on(this,arguments,void 0,function*(e,t={useWebWorker:!0}){let{default:n}=yield Promise.resolve().then(()=>(eh(),Zf)),s=yield n(),o=Yf(s),{IDBBatchAtomicVFS:l}=yield Promise.resolve().then(()=>(lh(),ah)),d=new l(e);o.vfs_register(d,!0);let f=yield o.open_v2(e),u=new Map;o.register_table_onchange_hook(f,(g,w,y)=>{Array.from(u.values()).forEach(b=>b(g,w,y))});let p=(g,w)=>on(this,void 0,void 0,function*(){return _(()=>on(this,void 0,void 0,function*(){return I(g,w)}))}),_=g=>navigator.locks.request(`db-execute-${e}`,g),I=(g,w)=>on(this,void 0,void 0,function*(){var y,b,A,v;let k=[];try{for(var Q=!0,N=Xg(o.statements(f,g)),K;K=yield N.next(),y=K.done,!y;Q=!0){v=K.value,Q=!1;let S=v,O,$=w?[w]:[[]];for(let Y of $){Y.forEach((ie,Ce,ft)=>{typeof ie=="boolean"&&(ft[Ce]=ie?1:0)}),o.reset(S),w&&o.bind_collection(S,Y);let ae=[];for(;(yield o.step(S))===100;){let ie=o.row(S);ae.push(ie)}O=O??o.column_names(S),O.length&&k.push({columns:O,rows:ae})}if(w)break}}catch(S){b={error:S}}finally{try{!Q&&!y&&(A=N.return)&&(yield A.call(N))}finally{if(b)throw b.error}}let G=[];for(let S of k)for(let O of S.rows){let $={};S.columns.forEach((Y,ae)=>{$[Y]=O[ae]}),G.push($)}return{insertId:o.last_insert_id(f),rowsAffected:o.changes(f),rows:{_array:G,length:G.length}}}),R=(g,w)=>on(this,void 0,void 0,function*(){return _(()=>on(this,void 0,void 0,function*(){let y=0,b=o.str_new(f,g),A=o.str_value(b);try{yield I("BEGIN TRANSACTION");let k=yield o.prepare_v2(f,A);if(k===null)return{rowsAffected:0};let Q=w||[];for(let N of Q){for(let G=0;G<N.length;G++){let W=N[G];typeof W=="boolean"&&(N[G]=W?1:0)}o.reset(k.stmt),w&&o.bind_collection(k.stmt,N),(yield o.step(k.stmt))===101&&(y+=o.changes(f))}yield o.finalize(k.stmt),yield I("COMMIT")}catch{return yield I("ROLLBACK"),{rowsAffected:0}}finally{o.str_finish(b)}return{rowsAffected:y}}))});if(t.useWebWorker){let g=w=>{let y=ch++;return u.set(y,w),Rt(()=>{u.delete(y)})};return{execute:Rt(p),executeBatch:Rt(R),registerOnTableChange:Rt(g),close:Rt(()=>{o.close(f)})}}return{execute:p,executeBatch:R,registerOnTableChange:g=>{let w=ch++;return u.set(w,g),()=>{u.delete(w)}},close:()=>o.close(f)}})}function Jg(r,e=!0){return e?new SharedWorker(new URL("./SharedWASQLiteDB.worker.js",import.meta.url),{name:`shared-DB-worker-${r}`,type:"module"}).port:new Worker(new URL("./WASQLiteDB.worker.js",import.meta.url),{name:`DB-worker-${r}`,type:"module"})}function fh(r,e=!0){return cr(Jg(r,e))}var xe=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},Mi=class extends Me{constructor(e){super(),this.options=e,this._execute=(t,n)=>xe(this,void 0,void 0,function*(){yield this.initialized;let s=yield this.methods.execute(t,n);return Object.assign(Object.assign({},s),{rows:Object.assign(Object.assign({},s.rows),{item:o=>s.rows._array[o]})})}),this._executeBatch=(t,n)=>xe(this,void 0,void 0,function*(){yield this.initialized;let s=yield this.methods.executeBatch(t,n);return Object.assign(Object.assign({},s),{rows:void 0})}),this.logger=hh.default.get("WASQLite"),this.dbGetHelpers=null,this.methods=null,this.initialized=this.init(),this.dbGetHelpers=this.generateDBHelpers({execute:this._execute.bind(this)})}get name(){return this.options.dbFilename}get flags(){var e;return(e=this.options.flags)!==null&&e!==void 0?e:{}}getWorker(){}init(){return xe(this,void 0,void 0,function*(){let{enableMultiTabs:e,useWebWorker:t}=this.flags;if(e||this.logger.warn("Multiple tabs are not enabled in this browser"),t){let n=this.options.workerPort?cr(this.options.workerPort):fh(this.options.dbFilename,e);this.methods=yield n(this.options.dbFilename),this.methods.registerOnTableChange(Rt((s,o,l)=>{this.iterateListeners(d=>{var f;return(f=d.tablesUpdated)===null||f===void 0?void 0:f.call(d,{opType:s,table:o,rowId:l})})}));return}this.methods=yield uh(this.options.dbFilename,{useWebWorker:!1}),this.methods.registerOnTableChange((n,s,o)=>{this.iterateListeners(l=>{var d;return(d=l.tablesUpdated)===null||d===void 0?void 0:d.call(l,{opType:n,table:s,rowId:o})})})})}execute(e,t){return xe(this,void 0,void 0,function*(){return this.writeLock(n=>n.execute(e,t))})}executeBatch(e,t){return xe(this,void 0,void 0,function*(){return this.writeLock(n=>this._executeBatch(e,t))})}close(){var e,t;(t=(e=this.methods)===null||e===void 0?void 0:e.close)===null||t===void 0||t.call(e)}getAll(e,t){return xe(this,void 0,void 0,function*(){return yield this.initialized,this.dbGetHelpers.getAll(e,t)})}getOptional(e,t){return xe(this,void 0,void 0,function*(){return yield this.initialized,this.dbGetHelpers.getOptional(e,t)})}get(e,t){return xe(this,void 0,void 0,function*(){return yield this.initialized,this.dbGetHelpers.get(e,t)})}readLock(e,t){return xe(this,void 0,void 0,function*(){return yield this.initialized,this.acquireLock(()=>xe(this,void 0,void 0,function*(){return e(this.generateDBHelpers({execute:this._execute}))}))})}writeLock(e,t){return xe(this,void 0,void 0,function*(){return yield this.initialized,this.acquireLock(()=>xe(this,void 0,void 0,function*(){return e(this.generateDBHelpers({execute:this._execute}))}))})}acquireLock(e){return navigator.locks.request(`db-lock-${this.options.dbFilename}`,e)}readTransaction(e,t){return xe(this,void 0,void 0,function*(){return this.readLock(this.wrapTransaction(e))})}writeTransaction(e,t){return this.writeLock(this.wrapTransaction(e))}wrapTransaction(e){return t=>xe(this,void 0,void 0,function*(){yield this._execute("BEGIN TRANSACTION");let n=!1,s=()=>xe(this,void 0,void 0,function*(){return n?{rowsAffected:0}:(n=!0,this._execute("COMMIT"))}),o=()=>(n=!0,this._execute("ROLLBACK"));try{let l=yield e(Object.assign(Object.assign({},t),{commit:s,rollback:o}));return n||(yield s()),l}catch(l){throw this.logger.debug("Caught ex in transaction",l),yield o(),l}})}generateDBHelpers(e){return Object.assign(Object.assign({},e),{getAll(t,n){return xe(this,void 0,void 0,function*(){var s,o;return(o=(s=(yield e.execute(t,n)).rows)===null||s===void 0?void 0:s._array)!==null&&o!==void 0?o:[]})},getOptional(t,n){return xe(this,void 0,void 0,function*(){var s,o;return(o=(s=(yield e.execute(t,n)).rows)===null||s===void 0?void 0:s.item(0))!==null&&o!==void 0?o:null})},get(t,n){return xe(this,void 0,void 0,function*(){var s;let l=(s=(yield e.execute(t,n)).rows)===null||s===void 0?void 0:s.item(0);if(!l)throw new Error("Result set is empty");return l})}})}};var Ut=Ie(at()),Yg=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},Qi=class{constructor(e){this.clients=e,this.TRACE=Ut.default.TRACE,this.DEBUG=Ut.default.DEBUG,this.INFO=Ut.default.INFO,this.TIME=Ut.default.TIME,this.WARN=Ut.default.WARN,this.ERROR=Ut.default.ERROR,this.OFF=Ut.default.OFF}trace(...e){console.trace(...e);let t=this.sanitizeArgs(e);this.iterateClients(n=>n.clientProvider.trace(...t))}debug(...e){console.debug(...e);let t=this.sanitizeArgs(e);this.iterateClients(n=>n.clientProvider.debug(...t))}info(...e){console.info(...e);let t=this.sanitizeArgs(e);this.iterateClients(n=>n.clientProvider.info(...t))}log(...e){console.log(...e);let t=this.sanitizeArgs(e);this.iterateClients(n=>n.clientProvider.log(...t))}warn(...e){console.warn(...e);let t=this.sanitizeArgs(e);this.iterateClients(n=>n.clientProvider.warn(...t))}error(...e){console.error(...e);let t=this.sanitizeArgs(e);this.iterateClients(n=>n.clientProvider.error(...t))}time(e){console.time(e),this.iterateClients(t=>t.clientProvider.time(e))}timeEnd(e){console.timeEnd(e),this.iterateClients(t=>t.clientProvider.timeEnd(e))}setLevel(e){}getLevel(){return Ut.default.INFO}enabledFor(e){return!0}iterateClients(e){return Yg(this,void 0,void 0,function*(){for(let t of this.clients)try{yield e(t)}catch(n){console.error("Caught exception when iterating client",n)}})}sanitizeArgs(e){return e.map(n=>{try{return structuredClone(n)}catch(s){return console.error(s),"Could not serialize log params. Check shared worker logs for more details."}})}};var et=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function d(p){try{u(n.next(p))}catch(_){l(_)}}function f(p){try{u(n.throw(p))}catch(_){l(_)}}function u(p){p.done?o(p.value):s(p.value).then(d,f)}u((n=n.apply(r,e||[])).next())})},$i;(function(r){r.CLOSE_CLIENT="close-client"})($i||($i={}));var zi=class extends Me{constructor(){super(),this.ports=[],this.isInitialized=new Promise(e=>{let t=this.registerListener({initialized:()=>{e(),t?.()}})}),this.syncStatus=new Je({}),this.broadCastLogger=new Qi(this.ports)}waitForStatus(e){return et(this,void 0,void 0,function*(){return yield this.waitForReady(),this.syncStreamClient.waitForStatus(e)})}get lastSyncedAt(){var e;return(e=this.syncStreamClient)===null||e===void 0?void 0:e.lastSyncedAt}get isConnected(){var e,t;return(t=(e=this.syncStreamClient)===null||e===void 0?void 0:e.isConnected)!==null&&t!==void 0?t:!1}waitForReady(){return et(this,void 0,void 0,function*(){return this.isInitialized})}init(e,t){return et(this,void 0,void 0,function*(){var n,s;if(this.syncStreamClient)return;let o=!((s=(n=t.streamOptions)===null||n===void 0?void 0:n.flags)===null||s===void 0)&&s.broadcastLogs?this.broadCastLogger:dh.default.get("shared-sync");self.onerror=l=>{o.error("Uncaught exception in PowerSync shared sync worker",l)},this.syncStreamClient=new Li(Object.assign(Object.assign({adapter:new li(new Mi({dbFilename:t.dbName,workerPort:e,flags:{enableMultiTabs:!0,useWebWorker:!0},logger:o}),new Nr,o),remote:new Ci({fetchCredentials:()=>et(this,void 0,void 0,function*(){let l=this.ports[this.ports.length-1];return new Promise((d,f)=>et(this,void 0,void 0,function*(){let u=new AbortController;this.fetchCredentialsController={controller:u,activePort:l},u.signal.onabort=f;try{d(yield l.clientProvider.fetchCredentials())}catch(p){f(p)}finally{this.fetchCredentialsController=void 0}}))})}),uploadCrud:()=>et(this,void 0,void 0,function*(){let l=this.ports[this.ports.length-1];return new Promise((d,f)=>et(this,void 0,void 0,function*(){let u=new AbortController;this.uploadDataController={controller:u,activePort:l},u.signal.onabort=()=>d();try{d(yield l.clientProvider.uploadCrud())}catch(p){f(p)}finally{this.uploadDataController=void 0}}))})},t.streamOptions),{logger:o})),this.syncStreamClient.registerListener({statusChanged:l=>{this.updateAllStatuses(l.toJSON())}}),this.iterateListeners(l=>{var d;return(d=l.initialized)===null||d===void 0?void 0:d.call(l)})})}dispose(){return et(this,void 0,void 0,function*(){var e,t;return yield this.waitForReady(),(e=this.statusListener)===null||e===void 0||e.call(this),(t=this.syncStreamClient)===null||t===void 0?void 0:t.dispose()})}connect(e){return et(this,void 0,void 0,function*(){return yield this.waitForReady(),navigator.locks.request("shared-sync-connect",()=>{var t;return(t=this.syncStreamClient)===null||t===void 0?void 0:t.connect(e)})})}disconnect(){return et(this,void 0,void 0,function*(){return yield this.waitForReady(),navigator.locks.request("shared-sync-connect",()=>{var e;return(e=this.syncStreamClient)===null||e===void 0?void 0:e.disconnect()})})}addPort(e){var t;let n={port:e,clientProvider:cr(e)};this.ports.push(n);let s=(t=this.syncStreamClient)===null||t===void 0?void 0:t.syncStatus;s&&n.clientProvider.statusChanged(s.toJSON())}removePort(e){let t=this.ports.findIndex(s=>s.port==e);if(t<0){console.warn(`Could not remove port ${e} since it is not present in active ports.`);return}this.ports[t].clientProvider[us](),this.ports.splice(t,1),[this.fetchCredentialsController,this.uploadDataController].forEach(s=>{s?.activePort.port==e&&s.controller.abort(new tt("Closing pending requests after client port is removed"))})}triggerCrudUpload(){this.waitForReady().then(()=>{var e;return(e=this.syncStreamClient)===null||e===void 0?void 0:e.triggerCrudUpload()})}obtainLock(e){return et(this,void 0,void 0,function*(){return yield this.waitForReady(),this.syncStreamClient.obtainLock(e)})}hasCompletedSync(){return et(this,void 0,void 0,function*(){return yield this.waitForReady(),this.syncStreamClient.hasCompletedSync()})}getWriteCheckpoint(){return et(this,void 0,void 0,function*(){return yield this.waitForReady(),this.syncStreamClient.getWriteCheckpoint()})}updateAllStatuses(e){this.syncStatus=new Je(e),this.ports.forEach(t=>t.clientProvider.statusChanged(e))}_testUpdateAllStatuses(e){this.syncStreamClient||console.warn("no stream client has been initialized yet"),this.syncStreamClient.syncStatus=new Je(e),this.updateAllStatuses(e)}};var ph=Ie(at()),_h=Ie(zs());typeof self.Buffer>"u"&&(self.Buffer=_h.Buffer);var Zg=self;ph.default.useDefaults();var qo=new zi;Zg.onconnect=function(r){let e=r.ports[0];e.addEventListener("message",t=>{let n=t.data;n?.event==$i.CLOSE_CLIENT&&(console.log("closing shared for port",e),qo.removePort(e))}),Jn(qo,e),qo.addPort(e)};
